{"version":3,"names":["hubActivityStatsCss","HubActivityStats","render","h","Host","subtitle","value","unit","corners","shareable","icon","slot","width","viewBox","class","fill","stroke","points","units","label","seconds","timeAgo","date","time","Math","floor","Date","valueOf","interval","calculateTimeDifference","suffix","hubChangelogCss","HubChangelog","this","changeTypes","add","change","fix","componentWillLoad","getChangelog","async","data","fetch","changelog","json","releases","formatDate","timestamp","toLocaleDateString","weekday","year","month","day","scale","appearance","map","release","heading","description","changes","length","id","type","kind","appendToMap","propName","items","get","set","includes","push","debounce","fn","ms","timeoutId","args","clearTimeout","setTimeout","isConnected","maybeElement","cleanupElements","key","keys","filter","stencilSubscription","getRenderingRef","elmsToUpdate","Map","dispose","clear","elm","elements","forceUpdate","reset","forEach","elms","unwrap","val","createObservableMap","defaultState","shouldUpdate","a","b","unwrappedState","states","Object","entries","handlers","_a","cb","oldValue","state","Proxy","_","ownKeys","Array","from","getOwnPropertyDescriptor","enumerable","configurable","has","on","eventName","callback","removeFromArray","onChange","unSet","newValue","unReset","use","subscriptions","unsubs","reduce","subscription","unsub","array","item","index","indexOf","createStore","user","context","app","_currentUser","requiresFormData","params","some","toParam","constructor","name","processParams","newParams","_b","param","firstElementType","JSON","stringify","join","isArray","encodeParam","arrayElem","encodeURIComponent","encodeQueryString","browserPonyfill","FormData","globalThis","File","Blob","encodeFormData","forceFormData","useFormData","formData","filename","append","ArcGISRequestError","Error","message","code","response","url","options","super","actualProto","prototype","setPrototypeOf","originalMessage","warn","console","apply","getFetch","Promise","resolve","Headers","Response","Request","request","NODEJS_DEFAULT_REFERER_HEADER","getDefaultRequestOptions","DEFAULT_ARCGIS_REQUEST_OPTIONS","httpMethod","f","ArcGISAuthError","retry","getSession","retryLimit","tries","retryRequest","reject","then","session","newOptions","assign","authentication","internalRequest","catch","e","checkForErrors","originalAuthError","error","messageCode","errorCode","status","parse","statusMessage","requestOptions","defaults","headers","rawResponse","fetchOptions","method","signal","credentials","rawToken","portal","getToken","startsWith","suppressWarnings","ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING","originalUrl","err","token","getDomainCredentials","requestHeaders","hideToken","window","queryParams","urlWithQueryString","maxUrlLength","RegExp","test","body","document","referer","ok","statusText","text","blob","truncatedUrl","toLowerCase","split","federatedServers","expires","now","canRefresh","refreshCredentials","appendCustomParams","customOptions","baseOptions","requestOptionsKeys","cleanUrl","trim","slice","decodeParam","decodeURIComponent","decodeQueryString","query","replace","acc","entry","getPortalUrl","CONTROL_CHAR_MATCHER","scrubControlChars","str","getItem","getItemBaseUrl","portalUrlOrRequestOptions","portalUrl","getItemData","file","emptyResponseErr","getItemGroups","getItemInfo","fileName","readAs","getItemFile","getItemMetadata","readMethod","justReturnResponse","searchGroupUsers","searchOptions","SearchQueryBuilder","q","termStack","rangeStack","openGroups","match","terms","concat","in","field","hasRange","hasTerms","commit","startGroup","endGroup","and","addModifier","or","not","term","to","boost","num","cleanup","clone","modifier","currentModifer","toUpperCase","hasWhiteSpace","s","formatTerm","getTime","undefined","oldQ","genericSearch","search","searchType","path","groupId","r","nextStart","nextPage","start","searchItems","searchGroups","searchGroupContent","getUser","username","getUserNotifications","searchUsers","getPortal","idOrSelf","__assign","t","i","n","arguments","p","hasOwnProperty","call","__rest","getOwnPropertySymbols","propertyIsEnumerable","getProp","obj","prev","curr","cloneObject","createId","prefix","random","toString","substr","unique","ary","deepSet","target","parts","worker","lastIdx","idx","getWithDefault","prop","def","res","setProp","OperationError","operation","rootCause","stack","createOperationPipeline","fns","input","chain","func","msg","opErr","operationStack","serialize","mapBy","arr","fetchToken","access_token","expires_in","ssl","refresh_token","refreshToken","generateToken","location","host","arcgisOnlineUrlRegex","isOnline","normalizeOnlinePortalUrl","getOnlineEnvironment","subdomain","pop","isFederated","owningSystemUrl","normalizedPortalUrl","normalizedOwningSystemUrl","canUseOnlineToken","requestUrl","portalIsOnline","requestIsOnline","portalEnv","requestEnv","validateAppAccess","clientId","ro","client_id","defer","deferred","promise","UserSession","_refreshToken","_refreshTokenExpires","refreshTokenExpires","password","_token","_tokenExpires","tokenExpires","provider","tokenDuration","redirectUri","refreshTokenTTL","server","trustedDomains","root","getServerRootUrl","_pendingTokenRequests","defineProperty","log","beginOAuth2","win","duration","expiration","popup","popupWindowFeatures","locale","href","errorString","oauthInfoString","errorMessage","oauthInfo","open","completeOAuth2","completeSignIn","handlerFn","handlerFnName","opener","parent","close","hash","error_description","parseInt","fromParent","parentOrigin","handler","event","source","parentMessageHandler","addEventListener","postMessage","removeEventListener","authorize","writeHead","Location","end","exchangeAuthorizationCode","authorizationCode","grant_type","redirect_uri","deserialize","fromCredential","credential","userId","toCredential","_this","_pendingUserRequest","_user","_pendingPortalRequest","_portalInfo","getUsername","getFreshToken","getTokenForServer","toJSON","enablePostMessageAuth","validChildOrigins","_hostHandler","createPostMessageHandler","disablePostMessageAuth","refreshSession","refreshWithUsernameAndPassword","refreshWithRefreshToken","protocol","domainAndPath","domain","domainWithProtocol","validOrigins","isValidOrigin","origin","isValidType","isTokenValid","existingToken","fetchAuthorizedDomains","authInfo","tokenServicesUrl","serverUrl","client","refreshRefreshToken","portalInfo","authorizedCrossOriginDomains","d","buildUrl","baseUrl","endsWith","URL","buildQueryString","URLSearchParams","urlOrObject","portalSelf","portalHostname","urlKey","customBaseUrl","isPortal","getPortalApiUrl","getItemHomeUrl","itemId","portalUrlOrObject","getItemApiUrl","access","getPortalBaseFromOrgUrl","orgUrl","result","getGroupHomeUrl","getUserHomeUrl","dataset","feedback","initiative","solution","template","other","site","getCollection","lowerCaseType","toLocaleLowerCase","collections","find","collectionTypes","queryFeatures","queryOptions","where","outFields","serviceRegex","parseServiceUrl","stripQueryString","stripped","getAllLayersAndTables","layersUrl","getService","defaultValue","o","mapValues","newObject","currentKey","isDate","v","isFunction","isObject","isRegExp","deepMapValues","object","propertyPath","deepMapValuesIteratee","output","valuePath","isObject$1","arborist","arrResults","iteratee","pruneArray","pruneObject","getPropertyValue","maxLevel","isString","hasDelete","lvl","getLevel","objResults","startVal","reduction","getDeleteValue","level","optionalTransform","settings","HANDLEBARS","isString$1","_swap","parameter","transforms","transformCheck","_propertyPathExists","cleanPath","_isValue","adlib","optional","templateValue","templatePath","settingsValue","hbsEntries","values","isStaticValue","paths","numberOfPaths","pathOption","exists","isNaN","swap","parseFloat","HubError","getItemThumbnailUrl","optionsOrToken","thumbnail","itemApiUrl","searchParams","delete","newSearch","parseInclude","include","reverse","enrichment","spec","OperationStack","operations","startOperation","op","startedAt","inputs","getOperation","getOperations","finish","merge","getCompleted","getWorking","allOps","sort","getOperationMessage","fetchOrg","orgId","orgPortalUrl","basePortalUrl","parseMetadataXml","metadataXml","import","opts","ignoreAttributes","attributeNamePrefix","textNodeName","fetchContentMetadata","enrichGroupIds","opId","admin","member","groupIds","group","handleEnrichmentError","enrichMetadata","metadata","enrichOwnerUser","owner","ownerUser","enrichOrg","getItemOrgId","orgPromise","org","enrichData","itemData","enrichServer","enrichLayers","merged","layers","tables","layer","errors","getEnrichmentErrors","enrichmentOperations","fetchItemEnrichments","enrichments","ops","pipeline","collectionToFamily","collection","overrides","getFamily","family","enrichProjectSearchResult","title","typeKeywords","tags","categories","summary","snippet","createdDate","created","createdDateSource","updatedDate","modified","updatedDateSource","links","self","siteRelative","DEFAULTS","specs","enriched","getHubRelativeUrl","enrichSiteSearchResult","identifier","contentUrl","getSolutionUrl","getInitiativeTemplateUrl","familiesWithPluralizedRoute","isPageType","hubUrl","DatePrecision","RemoteServerError","enrichContentSearchResult","enrichGroupContentCount","results","contentCount","total","enrichGroupMembershipSummary","membershipSummary","users","groupEnrichementOperations","fetchGroupEnrichments","SEARCH_APIS","arcgis","arcgisQA","arcgisDEV","hub","hubDEV","hubQA","expandApi","api","valueToMatchOptions","any","relativeDateToDateRange","relative","offsetMs","min","hours","days","weeks","setMonth","getMonth","setFullYear","getFullYear","getNextFunction","clonedRequest","getGroupThumbnailUrl","thumbnailUrl","getUserThumbnailUrl","expandPredicate","predicate","dateProps","copyProps","nonMatchOptionsFields","dateFieldValue","serializeQueryForPortal","filterSearchOptions","filters","serializeFilter","nonEmptyOptions","removeEmptyEntries","mergeSearchOptions","predicates","predicateSearchOptions","serializePredicate","boolProps","passThroughProps","specialProps","portalAllowList","so","serializeMatchOptions","serializeDateRange","serializeStringOrArray","all","range","enrichPageSearchResult","convertPortalAggregations","searchResults","aggregations","counts","mode","fieldName","fieldValues","portalSearchItems","updatedQuery","applyWellKnownItemPredicates","props","aggFields","countFields","countSize","aggLimit","searchPortal","resp","itemToSearchResult","hasNext","next","WellKnownItemPredicates","$application","typekeywords","$dashboard","$dataset","$document","$initiative","$experience","$feedback","$page","$site","$storymap","$template","$webmap","queryClone","replacedPredicates","isWellKnownTypeFilter","replacements","lookupTypePredicates","formatOgcAggregationsResponse","ogcAgg","count","getOgcAggregationQueryParams","_query","getQueryString","_key","ogcApiRequest","_fetch","withQueryString","searchOgcAggregations","apiDefinition","getNextOgcCallback","originalQuery","originalOptions","nextLink","l","rel","nextUrl","nextOptions","searchOgcItems","ogcItemToSearchResult","ogcItem","pseudoItem","properties","formatOgcItemsResponse","formattedResults","features","numberMatched","getFilterQueryParam","formatFilterBlock","formatted","formatPredicate","section","formatSimpleComparison","formatMultiStringPredicate","isDateRange","formatDateRangePredicate","formatComplexPredicate","x","Number","isInteger","maybeAddSingleQuotes","wrappedValues","anys","formatAnys","alls","formatAlls","nots","formatNots","subsection","valueAsArray","whitespaceRegex","getQQueryParam","qFilters","qPredicate","getQPredicate","qPredicates","getOgcItemQueryParams","limit","startindex","hubSearchItems","useBeta","portalSearchGroups","groupToSearchResult","enrichGroupSearchResult","enrichUserOrg","fetchUserEnrichments","enrichUserSearchResult","fullName","portalSearchUsers","userToSearchResult","hubSearch","filterType","targetEntity","apiType","fnHash","isSharedUpdate","capabilities","membershipAccess","isOpenData","_RemoteServerError","authenticateRequest","tokenPromise","bind","apiRequest","route","cache","apiBase","hubApiUrl","searchPosts","createPost","getCreateUpdateRequestParams","mentionUrl","searchChannels","createChannel","SortOrder","PostReaction","SharingAccess","PostStatus","DiscussionType","DiscussionSource","PostRelation","ReactionRelation","ChannelFilter","CommonSort","Role","PostSort","PostType","ChannelSort","ChannelRelation","AclCategory","AclSubCategory","hubCollaborationsCss","HubCollaborations","groups","getGroups","groupsQuery","createOptions","PRIVATE","defaultPostStatus","APPROVED","debug","hubRequestOptions","onclick","requestChannel","hubDiscussionsChannelsCss","HubDiscussionsChannels","channels","getChannels","channelQuery","channel","creator","hubDiscussionsModerationCss","HubDiscussionsModeration","posts","getChannelPosts","channelId","postsQuery","post","createdAt","hubDiscussionsPostEditorCss","HubDiscussionsPostEditor","componentDidRender","postBodyInput","postSubmitted","_evt","postResult","placeholder","alignment","ref","el","getEventQueryFromType","typeWhere","orderByFields","operator","searchEvents","returnGeometry","included","buildEventResponse","siteIds","cacheBust","siteSearchQuery","attributes","geometry","imageUrl","imageAttributes","crop","OBJECTID","currentEventSiteId","siteId","searchRequestOptions","siteInfo","siteItem","getMemberEvents","events","searchUserAccess","eventGroups","teamResults","eventsConfig","publicViewId","eventServiceUrl","eventFeatures","eventResults","meta","hubEventsCss","HubEvents","getEvents","hubFeedCss","HubFeed","fetchResults","scope","sortOrder","sortField","hubStatusCss","HubStatus","statusTypes","normal","color","degraded","down","componentDidLoad","fetchStatus","statusUrl","statusData","overview","_d","_c","services","hubTextCss","HubText","hubUserNotificationsCss","HubUserNotifications","getNotifications","notifications","notification","groupTitle","received","buildCollection","hubUserWorkspaceCss","HubUserWorkspace","redirect","defaultConfig","config","updateAppState","redirectUpdate","loadConfiguration","renderWorkspace","spaceNav","spacePanels","spaces","space","_spaceIndex","selected","default","spacePanel","layout","cards","card","CardTag","cardProps","cardText","_ev","alert","renderDefaultWorkspace","favGroupId","workspaceCardCss","WorkspaceCard","renderTab","workspaceNavigationCss","WorkspaceNavigation","signinClick","evt","CustomEvent","dispatchEvent","signoutClick","signedinEvent","detail","signedoutEvent","renderIdentity","signinButton"],"sources":["./src/components/hub-activity-stats/hub-activity-stats.css?tag=hub-activity-stats&encapsulation=shadow","./src/components/hub-activity-stats/hub-activity-stats.tsx","./src/utils/time.ts","./src/components/hub-changelog/hub-changelog.css?tag=hub-changelog&encapsulation=shadow","./src/components/hub-changelog/hub-changelog.tsx","./node_modules/@stencil/store/dist/index.mjs","./src/utils/state.ts","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/process-params.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-query-string.js","./node_modules/@esri/arcgis-rest-form-data/browser-ponyfill.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-form-data.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/ArcGISRequestError.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/warn.js","./node_modules/@esri/arcgis-rest-fetch/browser-ponyfill.js","./node_modules/@esri/arcgis-rest-request/dist/esm/request.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/append-custom-params.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/clean-url.js","./node_modules/@esri/arcgis-rest-request/dist/esm/utils/decode-query-string.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/util/get-portal-url.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/util/scrub-control-chars.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/items/get.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/groups/get.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/util/SearchQueryBuilder.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/util/generic-search.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/items/search.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/groups/search.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/users/get-user.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/users/notification.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/users/search-users.js","./node_modules/@esri/arcgis-rest-portal/dist/esm/util/get-portal.js","./node_modules/tslib/tslib.es6.js","./node_modules/@esri/hub-common/dist/esm/objects/get-prop.js","./node_modules/@esri/hub-common/dist/esm/util.js","./node_modules/@esri/hub-common/dist/esm/objects/deep-set.js","./node_modules/@esri/hub-common/dist/esm/objects/get-with-default.js","./node_modules/@esri/hub-common/dist/esm/objects/set-prop.js","./node_modules/@esri/hub-common/dist/esm/OperationError.js","./node_modules/@esri/hub-common/dist/esm/utils/create-operation-pipeline.js","./node_modules/@esri/hub-common/dist/esm/utils/map-by.js","./node_modules/@esri/arcgis-rest-auth/dist/esm/fetch-token.js","./node_modules/@esri/arcgis-rest-auth/dist/esm/generate-token.js","./node_modules/@esri/arcgis-rest-auth/dist/esm/federation-utils.js","./node_modules/@esri/arcgis-rest-auth/dist/esm/validate-app-access.js","./node_modules/@esri/arcgis-rest-auth/dist/esm/UserSession.js","./node_modules/@esri/hub-common/dist/esm/urls/build-url.js","./node_modules/@esri/hub-common/dist/esm/urls/get-portal-url.js","./node_modules/@esri/hub-common/dist/esm/urls/get-portal-api-url.js","./node_modules/@esri/hub-common/dist/esm/urls/get-item-home-url.js","./node_modules/@esri/hub-common/dist/esm/urls/get-item-api-url.js","./node_modules/@esri/hub-common/dist/esm/urls/getPortalBaseFromOrgUrl.js","./node_modules/@esri/hub-common/dist/esm/urls/getGroupHomeUrl.js","./node_modules/@esri/hub-common/dist/esm/urls/getUserHomeUrl.js","./node_modules/@esri/hub-common/dist/esm/collections.js","./node_modules/@esri/arcgis-rest-feature-layer/dist/esm/query.js","./node_modules/@esri/arcgis-rest-feature-layer/dist/esm/helpers.js","./node_modules/@esri/arcgis-rest-feature-layer/dist/esm/getAllLayersAndTables.js","./node_modules/@esri/arcgis-rest-feature-layer/dist/esm/getService.js","./node_modules/adlib/dist/adlib.esm.js","./node_modules/@esri/hub-common/dist/esm/HubError.js","./node_modules/@esri/hub-common/dist/esm/resources/get-item-thumbnail-url.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/parseInclude.js","./node_modules/@esri/hub-common/dist/esm/OperationStack.js","./node_modules/@esri/hub-common/dist/esm/org/fetch-org.js","./node_modules/@esri/hub-common/dist/esm/items/_enrichments.js","./node_modules/@esri/hub-common/dist/esm/content/get-family.js","./node_modules/@esri/hub-common/dist/esm/projects/fetch.js","./node_modules/@esri/hub-common/dist/esm/sites/HubSites.js","./node_modules/@esri/hub-common/dist/esm/content/_internal.js","./node_modules/@esri/hub-common/dist/esm/request.js","./node_modules/@esri/hub-common/dist/esm/content/HubContent.js","./node_modules/@esri/hub-common/dist/esm/groups/_internal/enrichments.js","./node_modules/@esri/hub-common/dist/esm/search/utils.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/expandPredicate.js","./node_modules/@esri/hub-common/dist/esm/search/serializeQueryForPortal.js","./node_modules/@esri/hub-common/dist/esm/pages/HubPages.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/portalSearchUtils.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/portalSearchItems.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/formatOgcAggregationsResponse.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getOgcAggregationQueryParams.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getQueryString.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/ogcApiRequest.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/searchOgcAggregations.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getNextOgcCallback.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/ogcItemToSearchResult.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/formatOgcItemsResponse.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getFilterQueryParam.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getQQueryParam.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/getOgcItemQueryParams.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItemsHelpers/searchOgcItems.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/hubSearchItems.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/portalSearchGroups.js","./node_modules/@esri/hub-common/dist/esm/users/_internal/enrichments.js","./node_modules/@esri/hub-common/dist/esm/users/HubUsers.js","./node_modules/@esri/hub-common/dist/esm/search/_internal/portalSearchUsers.js","./node_modules/@esri/hub-common/dist/esm/search/hubSearch.js","./node_modules/@esri/hub-common/dist/esm/groups/HubGroups.js","./node_modules/@esri/hub-discussions/dist/esm/utils/request.js","./node_modules/@esri/hub-discussions/dist/esm/request.js","./node_modules/@esri/hub-discussions/dist/esm/posts/posts.js","./node_modules/@esri/hub-discussions/dist/esm/channels/channels.js","./node_modules/@esri/hub-discussions/dist/esm/types.js","./src/components/hub-collaborations/hub-collaborations.css?tag=hub-collaborations&encapsulation=shadow","./src/components/hub-collaborations/hub-collaborations.tsx","./src/components/hub-discussions-channels/hub-discussions-channels.css?tag=hub-discussions-channels&encapsulation=shadow","./src/components/hub-discussions-channels/hub-discussions-channels.tsx","./src/components/hub-discussions-moderation/hub-discussions-moderation.css?tag=hub-discussions-moderation&encapsulation=shadow","./src/components/hub-discussions-moderation/hub-discussions-moderation.tsx","./src/components/hub-discussions-post-editor/hub-discussions-post-editor.css?tag=hub-discussions-post-editor&encapsulation=shadow","./src/components/hub-discussions-post-editor/hub-discussions-post-editor.tsx","./node_modules/@esri/hub-events/dist/esm/util.js","./node_modules/@esri/hub-events/dist/esm/search.js","./src/utils/events.ts","./src/components/hub-events/hub-events.css?tag=hub-events&encapsulation=shadow","./src/components/hub-events/hub-events.tsx","./src/components/hub-feed/hub-feed.css?tag=hub-feed&encapsulation=shadow","./src/components/hub-feed/hub-feed.tsx","./src/components/hub-status/hub-status.css?tag=hub-status&encapsulation=shadow","./src/components/hub-status/hub-status.tsx","./src/components/hub-text/hub-text.css?tag=hub-text&encapsulation=shadow","./src/components/hub-text/hub-text.tsx","./src/components/hub-user-notifications/hub-user-notifications.css?tag=hub-user-notifications&encapsulation=shadow","./src/components/hub-user-notifications/hub-user-notifications.tsx","./src/utils/feeds.ts","./src/components/hub-user-workspace/hub-user-workspace.css?tag=hub-user-workspace&encapsulation=shadow","./src/components/hub-user-workspace/hub-user-workspace.tsx","./src/components/workspace-card/workspace-card.css?tag=workspace-card&encapsulation=shadow","./src/components/workspace-card/workspace-card.tsx","./src/components/workspace-navigation/workspace-navigation.css?tag=workspace-navigation&encapsulation=shadow","./src/components/workspace-navigation/workspace-navigation.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n","import { Component, Host, h } from '@stencil/core';\n\n@Component({\n  tag: 'hub-activity-stats',\n  styleUrl: 'hub-activity-stats.css',\n  shadow: true,\n})\nexport class HubActivityStats {\n\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <arcgis-stat-card\n          value-color=\"\"\n          card-title=\"Pageviews\"\n          title-tooltip=\"Every visit to this item's page.\"\n          subtitle=\"Last 30 Days\"\n          value=\"1,042\"\n          text-align=\"end\"\n          trailing-text=\"\"\n          unit=\"\"\n          unit-position=\"after\"\n          corners=\"squared\"\n          shareable=\"true\"\n          shareable-by-value=\"false\"\n          shareable-on-hover=\"true\"\n        >\n          <calcite-icon icon=\"arrow-bold-up\" slot=\"value-media\"></calcite-icon>\n          <div slot=\"footer\">\n            <svg width=\"100%\" viewBox=\"0 0 440 120\" class=\"chart\">\n              <polyline\n                fill=\"none\"\n                stroke=\"#0074d9\"\n                stroke-width=\"2\"\n                points=\"00,120 20,60 40,80 60,20 80,80 100,80 120,60 140,100 160,90 180,80 200, 110 220, 10 240, 70 260, 100 280, 100 300, 40 320, 0 340, 100 360, 100 380, 120 400, 60 420, 70 440, 80\"\n              />\n            </svg>\n          </div>\n        </arcgis-stat-card> \n      </Host>\n    );\n  }\n\n}\n","// Simple methods for showing relative date\n\nconst units = [\n    { label: 'year', seconds: 31536000 },\n    { label: 'month', seconds: 2592000 },\n    { label: 'week', seconds: 604800 },\n    { label: 'day', seconds: 86400 },\n    { label: 'hour', seconds: 3600 },\n    { label: 'minute', seconds: 60 },\n    { label: 'second', seconds: 1 }\n  ];\n\nexport const timeAgo = (date: string | number | Date) => {\n    const time = Math.floor(\n      (new Date().valueOf() - new Date(date).valueOf()) / 1000\n    );\n    const { interval, unit } = calculateTimeDifference(time);\n    const suffix = interval === 1 ? '' : 's';\n    return `${interval} ${unit}${suffix} ago`;\n  };\n  const calculateTimeDifference = (time: number) => {\n    for (let { label, seconds } of units) {\n      const interval = Math.floor(time / seconds);\n      if (interval >= 1) {\n        return {\n          interval: interval,\n          unit: label\n        };\n      }\n    }\n    return {\n      interval: 0,\n      unit: ''\n    };\n  };",":host {\n  display: block;\n}\n","import { Component, Host, State, h } from '@stencil/core';\nimport { timeAgo } from '../../utils/time';\n\n@Component({\n  tag: 'hub-changelog',\n  styleUrl: 'hub-changelog.css',\n  shadow: true,\n})\nexport class HubChangelog {\n\n  @State() releases:Array<any> = [];\n\n  changeTypes = {\n    'add': {icon: 'plus'},\n    'change': {icon: 'fork-right'},\n    'fix': {icon: 'debug'}\n  }\n  componentWillLoad() {\n    this.getChangelog();\n  }\n\n  /**\n   * {\n    \"releases\": [\n        {\n            \"timestamp\": \"2023-02-22T00:00:00Z\",\n            \"changes\": [\n                {\"type\": \"add\", \"description\": \"Added active state border around map when adding location to posts in Hub Discussions\"},\n                {\"type\": \"add\", \"description\": \"Added Advanced Mapping links that allow users to select ArcGIS MapViewer Classic\"},\n                {\"type\": \"change\", \"description\": \"Changed theme color mapping for buttons\"},\n                {\"type\": \"fix\", \"description\": \"The Mentions list is now themed\"},\n                {\"type\": \"fix\", \"description\": \"The on-map controls and widgets now have matching shadows\"},\n                {\"type\": \"fix\", \"description\": \"Fixed intermittent New content button alignment issue\"}\n            ]\n        }\n      ]}\n   */\n  async getChangelog() {\n    const data = await fetch('./data/changelog.json');\n    const changelog = await data.json();\n    this.releases = changelog.releases;\n  } \n\n  private formatDate(timestamp: string) {\n    return new Date(timestamp).toLocaleDateString('en-us', { weekday:\"long\", year:\"numeric\", month:\"short\", day:\"numeric\"})     \n  }\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-accordion scale=\"m\" appearance=\"solid\" selection-mode=\"multiple\">\n\n        {this.releases.map((release) => {\n          return (\n            <calcite-accordion-item\n              heading={this.formatDate(release.timestamp)}\n              description={`${release.changes.length} changes ${timeAgo(release.timestamp)}`}\n              icon-start=\"\"\n              icon-end=\"\"\n            >\n              <calcite-list id=\"changes\">\n              {release.changes.map((change) => {\n                return (\n                  <calcite-list-item description={change.description}>\n                    <calcite-chip\n                      class=\"list-chip\"\n                      icon={this.changeTypes[change.type].icon}\n                      scale=\"s\"\n                      appearance=\"solid\"\n                      kind=\"neutral\"\n                      slot=\"content-start\"\n                    >\n                      {change.type}\n                    </calcite-chip>\n                  </calcite-list-item>\n                )\n              })}\n              </calcite-list>\n            </calcite-accordion-item>\n          )\n\n        })}\n        </calcite-accordion>\n      </Host>\n    );\n  }\n\n}\n","import { getRenderingRef, forceUpdate } from '@stencil/core';\n\nconst appendToMap = (map, propName, value) => {\n    const items = map.get(propName);\n    if (!items) {\n        map.set(propName, [value]);\n    }\n    else if (!items.includes(value)) {\n        items.push(value);\n    }\n};\nconst debounce = (fn, ms) => {\n    let timeoutId;\n    return (...args) => {\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n        }\n        timeoutId = setTimeout(() => {\n            timeoutId = 0;\n            fn(...args);\n        }, ms);\n    };\n};\n\n/**\n * Check if a possible element isConnected.\n * The property might not be there, so we check for it.\n *\n * We want it to return true if isConnected is not a property,\n * otherwise we would remove these elements and would not update.\n *\n * Better leak in Edge than to be useless.\n */\nconst isConnected = (maybeElement) => !('isConnected' in maybeElement) || maybeElement.isConnected;\nconst cleanupElements = debounce((map) => {\n    for (let key of map.keys()) {\n        map.set(key, map.get(key).filter(isConnected));\n    }\n}, 2000);\nconst stencilSubscription = () => {\n    if (typeof getRenderingRef !== 'function') {\n        // If we are not in a stencil project, we do nothing.\n        // This function is not really exported by @stencil/core.\n        return {};\n    }\n    const elmsToUpdate = new Map();\n    return {\n        dispose: () => elmsToUpdate.clear(),\n        get: (propName) => {\n            const elm = getRenderingRef();\n            if (elm) {\n                appendToMap(elmsToUpdate, propName, elm);\n            }\n        },\n        set: (propName) => {\n            const elements = elmsToUpdate.get(propName);\n            if (elements) {\n                elmsToUpdate.set(propName, elements.filter(forceUpdate));\n            }\n            cleanupElements(elmsToUpdate);\n        },\n        reset: () => {\n            elmsToUpdate.forEach((elms) => elms.forEach(forceUpdate));\n            cleanupElements(elmsToUpdate);\n        },\n    };\n};\n\nconst unwrap = (val) => (typeof val === 'function' ? val() : val);\nconst createObservableMap = (defaultState, shouldUpdate = (a, b) => a !== b) => {\n    const unwrappedState = unwrap(defaultState);\n    let states = new Map(Object.entries(unwrappedState !== null && unwrappedState !== void 0 ? unwrappedState : {}));\n    const handlers = {\n        dispose: [],\n        get: [],\n        set: [],\n        reset: [],\n    };\n    const reset = () => {\n        var _a;\n        // When resetting the state, the default state may be a function - unwrap it to invoke it.\n        // otherwise, the state won't be properly reset\n        states = new Map(Object.entries((_a = unwrap(defaultState)) !== null && _a !== void 0 ? _a : {}));\n        handlers.reset.forEach((cb) => cb());\n    };\n    const dispose = () => {\n        // Call first dispose as resetting the state would\n        // cause less updates ;)\n        handlers.dispose.forEach((cb) => cb());\n        reset();\n    };\n    const get = (propName) => {\n        handlers.get.forEach((cb) => cb(propName));\n        return states.get(propName);\n    };\n    const set = (propName, value) => {\n        const oldValue = states.get(propName);\n        if (shouldUpdate(value, oldValue, propName)) {\n            states.set(propName, value);\n            handlers.set.forEach((cb) => cb(propName, value, oldValue));\n        }\n    };\n    const state = (typeof Proxy === 'undefined'\n        ? {}\n        : new Proxy(unwrappedState, {\n            get(_, propName) {\n                return get(propName);\n            },\n            ownKeys(_) {\n                return Array.from(states.keys());\n            },\n            getOwnPropertyDescriptor() {\n                return {\n                    enumerable: true,\n                    configurable: true,\n                };\n            },\n            has(_, propName) {\n                return states.has(propName);\n            },\n            set(_, propName, value) {\n                set(propName, value);\n                return true;\n            },\n        }));\n    const on = (eventName, callback) => {\n        handlers[eventName].push(callback);\n        return () => {\n            removeFromArray(handlers[eventName], callback);\n        };\n    };\n    const onChange = (propName, cb) => {\n        const unSet = on('set', (key, newValue) => {\n            if (key === propName) {\n                cb(newValue);\n            }\n        });\n        // We need to unwrap the defaultState because it might be a function.\n        // Otherwise we might not be sending the right reset value.\n        const unReset = on('reset', () => cb(unwrap(defaultState)[propName]));\n        return () => {\n            unSet();\n            unReset();\n        };\n    };\n    const use = (...subscriptions) => {\n        const unsubs = subscriptions.reduce((unsubs, subscription) => {\n            if (subscription.set) {\n                unsubs.push(on('set', subscription.set));\n            }\n            if (subscription.get) {\n                unsubs.push(on('get', subscription.get));\n            }\n            if (subscription.reset) {\n                unsubs.push(on('reset', subscription.reset));\n            }\n            if (subscription.dispose) {\n                unsubs.push(on('dispose', subscription.dispose));\n            }\n            return unsubs;\n        }, []);\n        return () => unsubs.forEach((unsub) => unsub());\n    };\n    const forceUpdate = (key) => {\n        const oldValue = states.get(key);\n        handlers.set.forEach((cb) => cb(key, oldValue, oldValue));\n    };\n    return {\n        state,\n        get,\n        set,\n        on,\n        onChange,\n        use,\n        dispose,\n        reset,\n        forceUpdate,\n    };\n};\nconst removeFromArray = (array, item) => {\n    const index = array.indexOf(item);\n    if (index >= 0) {\n        array[index] = array[array.length - 1];\n        array.length--;\n    }\n};\n\nconst createStore = (defaultState, shouldUpdate) => {\n    const map = createObservableMap(defaultState, shouldUpdate);\n    map.use(stencilSubscription());\n    return map;\n};\n\nexport { createObservableMap, createStore };\n","// Shared state\n\nimport { createStore } from \"@stencil/store\";\n\nconst { state, onChange } = createStore({\n    user: null,\n    context: null,\n    app: null\n});\n\nonChange('user', value => {\n    state.user = value;\n});\n\n// Convenience copy to state.user for later reference\nonChange('context', value => {\n    state.context = value;\n    state.user = value?._currentUser;\n});\n\nexport default state;\n","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Checks parameters to see if we should use FormData to send the request\n * @param params The object whose keys will be encoded.\n * @return A boolean indicating if FormData will be required.\n */\nexport function requiresFormData(params) {\n    return Object.keys(params).some((key) => {\n        let value = params[key];\n        if (!value) {\n            return false;\n        }\n        if (value && value.toParam) {\n            value = value.toParam();\n        }\n        const type = value.constructor.name;\n        switch (type) {\n            case \"Array\":\n                return false;\n            case \"Object\":\n                return false;\n            case \"Date\":\n                return false;\n            case \"Function\":\n                return false;\n            case \"Boolean\":\n                return false;\n            case \"String\":\n                return false;\n            case \"Number\":\n                return false;\n            default:\n                return true;\n        }\n    });\n}\n/**\n * Converts parameters to the proper representation to send to the ArcGIS REST API.\n * @param params The object whose keys will be encoded.\n * @return A new object with properly encoded values.\n */\nexport function processParams(params) {\n    const newParams = {};\n    Object.keys(params).forEach((key) => {\n        var _a, _b;\n        let param = params[key];\n        if (param && param.toParam) {\n            param = param.toParam();\n        }\n        if (!param &&\n            param !== 0 &&\n            typeof param !== \"boolean\" &&\n            typeof param !== \"string\") {\n            return;\n        }\n        const type = param.constructor.name;\n        let value;\n        // properly encodes objects, arrays and dates for arcgis.com and other services.\n        // ported from https://github.com/Esri/esri-leaflet/blob/master/src/Request.js#L22-L30\n        // also see https://github.com/Esri/arcgis-rest-js/issues/18:\n        // null, undefined, function are excluded. If you want to send an empty key you need to send an empty string \"\".\n        switch (type) {\n            case \"Array\":\n                // Based on the first element of the array, classify array as an array of arrays, an array of objects\n                // to be stringified, or an array of non-objects to be comma-separated\n                // eslint-disable-next-line no-case-declarations\n                const firstElementType = (_b = (_a = param[0]) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name;\n                value =\n                    firstElementType === \"Array\"\n                        ? param // pass thru array of arrays\n                        : firstElementType === \"Object\"\n                            ? JSON.stringify(param) // stringify array of objects\n                            : param.join(\",\"); // join other types of array elements\n                break;\n            case \"Object\":\n                value = JSON.stringify(param);\n                break;\n            case \"Date\":\n                value = param.valueOf();\n                break;\n            case \"Function\":\n                value = null;\n                break;\n            case \"Boolean\":\n                value = param + \"\";\n                break;\n            default:\n                value = param;\n                break;\n        }\n        if (value ||\n            value === 0 ||\n            typeof value === \"string\" ||\n            Array.isArray(value)) {\n            newParams[key] = value;\n        }\n    });\n    return newParams;\n}\n//# sourceMappingURL=process-params.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams } from \"./process-params.js\";\n/**\n * Encodes keys and parameters for use in a URL's query string.\n *\n * @param key Parameter's key\n * @param value Parameter's value\n * @returns Query string with key and value pairs separated by \"&\"\n */\nexport function encodeParam(key, value) {\n    // For array of arrays, repeat key=value for each element of containing array\n    if (Array.isArray(value) && value[0] && Array.isArray(value[0])) {\n        return value\n            .map((arrayElem) => encodeParam(key, arrayElem))\n            .join(\"&\");\n    }\n    return encodeURIComponent(key) + \"=\" + encodeURIComponent(value);\n}\n/**\n * Encodes the passed object as a query string.\n *\n * @param params An object to be encoded.\n * @returns An encoded query string.\n */\nexport function encodeQueryString(params) {\n    const newParams = processParams(params);\n    return Object.keys(newParams)\n        .map((key) => {\n        return encodeParam(key, newParams[key]);\n    })\n        .join(\"&\");\n}\n//# sourceMappingURL=encode-query-string.js.map","module.exports = {\n  FormData: globalThis.FormData,\n  File: globalThis.File,\n  Blob: globalThis.Blob\n};\n","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams, requiresFormData } from \"./process-params.js\";\nimport { encodeQueryString } from \"./encode-query-string.js\";\nimport { FormData } from \"@esri/arcgis-rest-form-data\";\n/**\n * Encodes parameters in a [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object in browsers or in a [FormData](https://github.com/form-data/form-data) in Node.js\n *\n * @param params An object to be encoded.\n * @returns The complete [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object.\n */\nexport function encodeFormData(params, forceFormData) {\n    // see https://github.com/Esri/arcgis-rest-js/issues/499 for more info.\n    const useFormData = requiresFormData(params) || forceFormData;\n    const newParams = processParams(params);\n    if (useFormData) {\n        const formData = new FormData();\n        Object.keys(newParams).forEach((key) => {\n            if (typeof Blob !== \"undefined\" && newParams[key] instanceof Blob) {\n                /* To name the Blob:\n                 1. look to an alternate request parameter called 'fileName'\n                 2. see if 'name' has been tacked onto the Blob manually\n                 3. if all else fails, use the request parameter\n                */\n                const filename = newParams[\"fileName\"] || newParams[key].name || key;\n                formData.append(key, newParams[key], filename);\n            }\n            else {\n                formData.append(key, newParams[key]);\n            }\n        });\n        return formData;\n    }\n    else {\n        return encodeQueryString(params);\n    }\n}\n//# sourceMappingURL=encode-form-data.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * This represents a generic error from an ArcGIS endpoint. There will be details about the error in the {@linkcode ArcGISRequestError.message},  {@linkcode ArcGISRequestError.originalMessage} properties on the error. You\n * can also access the original server response at  {@linkcode ArcGISRequestError.response} which may have additional details.\n *\n * ```js\n * request(someUrl, someOptions).catch(e => {\n *   if(e.name === \"ArcGISRequestError\") {\n *     console.log(\"Something went wrong with the request:\", e);\n *     console.log(\"Full server response\", e.response);\n *   }\n * })\n * ```\n */\nexport class ArcGISRequestError extends Error {\n    /**\n     * Create a new `ArcGISRequestError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options and parameters of the request\n     */\n    constructor(message, code, response, url, options) {\n        // 'Error' breaks prototype chain here\n        super(message);\n        // restore prototype chain, see https://stackoverflow.com/questions/41102060/typescript-extending-error-class\n        // we don't need to check for Object.setPrototypeOf as in the answers because we are ES2017 now.\n        // Also see https://github.com/Microsoft/TypeScript-wiki/blob/main/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        // and https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#custom_error_types\n        const actualProto = new.target.prototype;\n        Object.setPrototypeOf(this, actualProto);\n        message = message || \"UNKNOWN_ERROR\";\n        code = code || \"UNKNOWN_ERROR_CODE\";\n        this.name = \"ArcGISRequestError\";\n        this.message =\n            code === \"UNKNOWN_ERROR_CODE\" ? message : `${code}: ${message}`;\n        this.originalMessage = message;\n        this.code = code;\n        this.response = response;\n        this.url = url;\n        this.options = options;\n    }\n}\n//# sourceMappingURL=ArcGISRequestError.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Method used internally to surface messages to developers.\n */\nexport function warn(message) {\n    if (console && console.warn) {\n        console.warn.apply(console, [message]);\n    }\n}\n//# sourceMappingURL=warn.js.map","module.exports.getFetch = function getFetch() {\n  return Promise.resolve({\n    fetch: globalThis.fetch,\n    Headers: globalThis.Headers,\n    Response: globalThis.Response,\n    Request: globalThis.request\n  });\n};\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { encodeFormData } from \"./utils/encode-form-data.js\";\nimport { encodeQueryString } from \"./utils/encode-query-string.js\";\nimport { requiresFormData } from \"./utils/process-params.js\";\nimport { ArcGISRequestError } from \"./utils/ArcGISRequestError.js\";\nimport { warn } from \"./utils/warn.js\";\nimport { getFetch } from \"@esri/arcgis-rest-fetch\";\nexport const NODEJS_DEFAULT_REFERER_HEADER = `@esri/arcgis-rest-js`;\n/**\n * Sets the default options that will be passed in **all requests across all `@esri/arcgis-rest-js` modules**.\n *\n * ```js\n * import { setDefaultRequestOptions } from \"@esri/arcgis-rest-request\";\n *\n * setDefaultRequestOptions({\n *   authentication: ArcGISIdentityManager // all requests will use this session by default\n * })\n * ```\n *\n * You should **never** set a default `authentication` when you are in a server side environment where you may be handling requests for many different authenticated users.\n *\n * @param options The default options to pass with every request. Existing default will be overwritten.\n * @param hideWarnings Silence warnings about setting default `authentication` in shared environments.\n */\nexport function setDefaultRequestOptions(options, hideWarnings) {\n    if (options.authentication && !hideWarnings) {\n        warn(\"You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning.\");\n    }\n    globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS = options;\n}\nexport function getDefaultRequestOptions() {\n    return (globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS || {\n        httpMethod: \"POST\",\n        params: {\n            f: \"json\"\n        }\n    });\n}\n/**\n * This error is thrown when a request encounters an invalid token error. Requests that use {@linkcode ArcGISIdentityManager} or\n * {@linkcode ApplicationCredentialsManager} in the `authentication` option the authentication manager will automatically try to generate\n * a fresh token using either {@linkcode ArcGISIdentityManager.refreshCredentials} or\n * {@linkcode ApplicationCredentialsManager.refreshCredentials}. If the request with the new token fails you will receive an `ArcGISAuthError`\n * if refreshing the token fails you will receive an instance of {@linkcode ArcGISTokenRequestError}.\n *\n * ```js\n * request(someUrl, {\n *   authentication: identityManager,\n *   // some additional options...\n * }).catch(e => {\n *   if(e.name === \"ArcGISAuthError\") {\n *     console.log(\"Request with a new token failed you might want to have the user authorize again.\")\n *   }\n *\n *   if(e.name === \"ArcGISTokenRequestError\") {\n *     console.log(\"There was an error refreshing the token you might want to have the user authorize again.\")\n *   }\n * })\n * ```\n */\nexport class ArcGISAuthError extends ArcGISRequestError {\n    /**\n     * Create a new `ArcGISAuthError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options of the request\n     */\n    constructor(message = \"AUTHENTICATION_ERROR\", code = \"AUTHENTICATION_ERROR_CODE\", response, url, options) {\n        super(message, code, response, url, options);\n        this.name = \"ArcGISAuthError\";\n        this.message =\n            code === \"AUTHENTICATION_ERROR_CODE\" ? message : `${code}: ${message}`;\n        // restore prototype chain, see https://stackoverflow.com/questions/41102060/typescript-extending-error-class\n        // we don't need to check for Object.setPrototypeOf as in the answers because we are ES2017 now.\n        // Also see https://github.com/Microsoft/TypeScript-wiki/blob/main/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        // and https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#custom_error_types\n        const actualProto = new.target.prototype;\n        Object.setPrototypeOf(this, actualProto);\n    }\n    retry(getSession, retryLimit = 1) {\n        let tries = 0;\n        const retryRequest = (resolve, reject) => {\n            tries = tries + 1;\n            getSession(this.url, this.options)\n                .then((session) => {\n                const newOptions = Object.assign(Object.assign({}, this.options), { authentication: session });\n                return internalRequest(this.url, newOptions);\n            })\n                .then((response) => {\n                resolve(response);\n            })\n                .catch((e) => {\n                if (e.name === \"ArcGISAuthError\" && tries < retryLimit) {\n                    retryRequest(resolve, reject);\n                }\n                else if (e.name === this.name &&\n                    e.message === this.message &&\n                    tries >= retryLimit) {\n                    reject(this);\n                }\n                else {\n                    reject(e);\n                }\n            });\n        };\n        return new Promise((resolve, reject) => {\n            retryRequest(resolve, reject);\n        });\n    }\n}\n/**\n * Checks for errors in a JSON response from the ArcGIS REST API. If there are no errors, it will return the `data` passed in. If there is an error, it will throw an `ArcGISRequestError` or `ArcGISAuthError`.\n *\n * @param data The response JSON to check for errors.\n * @param url The url of the original request\n * @param params The parameters of the original request\n * @param options The options of the original request\n * @returns The data that was passed in the `data` parameter\n */\nexport function checkForErrors(response, url, params, options, originalAuthError) {\n    // this is an error message from billing.arcgis.com backend\n    if (response.code >= 400) {\n        const { message, code } = response;\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    // error from ArcGIS Online or an ArcGIS Portal or server instance.\n    if (response.error) {\n        const { message, code, messageCode } = response.error;\n        const errorCode = messageCode || code || \"UNKNOWN_ERROR_CODE\";\n        if (code === 498 || code === 499) {\n            if (originalAuthError) {\n                throw originalAuthError;\n            }\n            else {\n                throw new ArcGISAuthError(message, errorCode, response, url, options);\n            }\n        }\n        throw new ArcGISRequestError(message, errorCode, response, url, options);\n    }\n    // error from a status check\n    if (response.status === \"failed\" || response.status === \"failure\") {\n        let message;\n        let code = \"UNKNOWN_ERROR_CODE\";\n        try {\n            message = JSON.parse(response.statusMessage).message;\n            code = JSON.parse(response.statusMessage).code;\n        }\n        catch (e) {\n            message = response.statusMessage || response.message;\n        }\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    return response;\n}\n/**\n * This is the internal implementation of `request` without the automatic retry behavior to prevent\n * infinite loops when a server continues to return invalid token errors.\n *\n * @param url - The URL of the ArcGIS REST API endpoint.\n * @param requestOptions - Options for the request, including parameters relevant to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n * @internal\n */\nexport function internalRequest(url, requestOptions) {\n    const defaults = getDefaultRequestOptions();\n    const options = Object.assign(Object.assign(Object.assign({ httpMethod: \"POST\" }, defaults), requestOptions), {\n        params: Object.assign(Object.assign({}, defaults.params), requestOptions.params),\n        headers: Object.assign(Object.assign({}, defaults.headers), requestOptions.headers)\n    });\n    const { httpMethod, rawResponse } = options;\n    const params = Object.assign({ f: \"json\" }, options.params);\n    let originalAuthError = null;\n    const fetchOptions = {\n        method: httpMethod,\n        signal: options.signal,\n        /* ensures behavior mimics XMLHttpRequest.\n        needed to support sending IWA cookies */\n        credentials: options.credentials || \"same-origin\"\n    };\n    // the /oauth2/platformSelf route will add X-Esri-Auth-Client-Id header\n    // and that request needs to send cookies cross domain\n    // so we need to set the credentials to \"include\"\n    if (options.headers &&\n        options.headers[\"X-Esri-Auth-Client-Id\"] &&\n        url.indexOf(\"/oauth2/platformSelf\") > -1) {\n        fetchOptions.credentials = \"include\";\n    }\n    let authentication;\n    // Check to see if this is a raw token as a string and create a IAuthenticationManager like object for it.\n    // Otherwise this just assumes that options.authentication is an IAuthenticationManager.\n    if (typeof options.authentication === \"string\") {\n        const rawToken = options.authentication;\n        authentication = {\n            portal: \"https://www.arcgis.com/sharing/rest\",\n            getToken: () => {\n                return Promise.resolve(rawToken);\n            }\n        };\n        /* istanbul ignore else - we don't need to test NOT warning people */\n        if (!options.authentication.startsWith(\"AAPK\") && // doesn't look like an API Key\n            !options.suppressWarnings && // user doesn't want to suppress warnings for this request\n            !globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING // we havn't shown the user this warning yet\n        ) {\n            warn(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);\n            globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING = true;\n        }\n    }\n    else {\n        authentication = options.authentication;\n    }\n    // for errors in GET requests we want the URL passed to the error to be the URL before\n    // query params are applied.\n    const originalUrl = url;\n    return (authentication\n        ? authentication.getToken(url).catch((err) => {\n            /**\n             * append original request url and requestOptions\n             * to the error thrown by getToken()\n             * to assist with retrying\n             */\n            err.url = url;\n            err.options = options;\n            /**\n             * if an attempt is made to talk to an unfederated server\n             * first try the request anonymously. if a 'token required'\n             * error is thrown, throw the UNFEDERATED error then.\n             */\n            originalAuthError = err;\n            return Promise.resolve(\"\");\n        })\n        : Promise.resolve(\"\"))\n        .then((token) => {\n        if (token.length) {\n            params.token = token;\n        }\n        if (authentication && authentication.getDomainCredentials) {\n            fetchOptions.credentials = authentication.getDomainCredentials(url);\n        }\n        // Custom headers to add to request. IRequestOptions.headers with merge over requestHeaders.\n        const requestHeaders = {};\n        if (fetchOptions.method === \"GET\") {\n            // Prevents token from being passed in query params when hideToken option is used.\n            /* istanbul ignore if - window is always defined in a browser. Test case is covered by Jasmine in node test */\n            if (params.token &&\n                options.hideToken &&\n                // Sharing API does not support preflight check required by modern browsers https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\n                typeof window === \"undefined\") {\n                requestHeaders[\"X-Esri-Authorization\"] = `Bearer ${params.token}`;\n                delete params.token;\n            }\n            // encode the parameters into the query string\n            const queryParams = encodeQueryString(params);\n            // dont append a '?' unless parameters are actually present\n            const urlWithQueryString = queryParams === \"\" ? url : url + \"?\" + encodeQueryString(params);\n            if (\n            // This would exceed the maximum length for URLs specified by the consumer and requires POST\n            (options.maxUrlLength &&\n                urlWithQueryString.length > options.maxUrlLength) ||\n                // Or if the customer requires the token to be hidden and it has not already been hidden in the header (for browsers)\n                (params.token && options.hideToken)) {\n                // the consumer specified a maximum length for URLs\n                // and this would exceed it, so use post instead\n                fetchOptions.method = \"POST\";\n                // If the token was already added as a Auth header, add the token back to body with other params instead of header\n                if (token.length && options.hideToken) {\n                    params.token = token;\n                    // Remove existing header that was added before url query length was checked\n                    delete requestHeaders[\"X-Esri-Authorization\"];\n                }\n            }\n            else {\n                // just use GET\n                url = urlWithQueryString;\n            }\n        }\n        /* updateResources currently requires FormData even when the input parameters dont warrant it.\n    https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm\n        see https://github.com/Esri/arcgis-rest-js/pull/500 for more info. */\n        const forceFormData = new RegExp(\"/items/.+/updateResources\").test(url);\n        if (fetchOptions.method === \"POST\") {\n            fetchOptions.body = encodeFormData(params, forceFormData);\n        }\n        // Mixin headers from request options\n        fetchOptions.headers = Object.assign(Object.assign({}, requestHeaders), options.headers);\n        // This should have the same conditional for Node JS as ArcGISIdentityManager.refreshWithUsernameAndPassword()\n        // to ensure that generated tokens have the same referer when used in Node with a username and password.\n        /* istanbul ignore next - karma reports coverage on browser tests only */\n        if ((typeof window === \"undefined\" ||\n            (window && typeof window.document === \"undefined\")) &&\n            !fetchOptions.headers.referer) {\n            fetchOptions.headers.referer = NODEJS_DEFAULT_REFERER_HEADER;\n        }\n        /* istanbul ignore else blob responses are difficult to make cross platform we will just have to trust the isomorphic fetch will do its job */\n        if (!requiresFormData(params) && !forceFormData) {\n            fetchOptions.headers[\"Content-Type\"] =\n                \"application/x-www-form-urlencoded\";\n        }\n        /**\n         * Check for a global fetch first and use it if available. This allows us to use the default\n         * configuration of fetch-mock in tests.\n         */\n        /* istanbul ignore next coverage is based on browser code and we don't test for the absence of global fetch so we can skip the else here. */\n        return globalThis.fetch\n            ? globalThis.fetch(url, fetchOptions)\n            : getFetch().then(({ fetch }) => {\n                return fetch(url, fetchOptions);\n            });\n    })\n        .then((response) => {\n        if (!response.ok) {\n            // server responded w/ an actual error (404, 500, etc)\n            const { status, statusText } = response;\n            throw new ArcGISRequestError(statusText, `HTTP ${status}`, response, url, options);\n        }\n        if (rawResponse) {\n            return response;\n        }\n        switch (params.f) {\n            case \"json\":\n                return response.json();\n            case \"geojson\":\n                return response.json();\n            case \"html\":\n                return response.text();\n            case \"text\":\n                return response.text();\n            /* istanbul ignore next blob responses are difficult to make cross platform we will just have to trust that isomorphic fetch will do its job */\n            default:\n                return response.blob();\n        }\n    })\n        .then((data) => {\n        if ((params.f === \"json\" || params.f === \"geojson\") && !rawResponse) {\n            const response = checkForErrors(data, originalUrl, params, options, originalAuthError);\n            if (originalAuthError) {\n                /* If the request was made to an unfederated service that\n                didn't require authentication, add the base url and a dummy token\n                to the list of trusted servers to avoid another federation check\n                in the event of a repeat request */\n                const truncatedUrl = url\n                    .toLowerCase()\n                    .split(/\\/rest(\\/admin)?\\/services\\//)[0];\n                options.authentication.federatedServers[truncatedUrl] = {\n                    token: [],\n                    // default to 24 hours\n                    expires: new Date(Date.now() + 86400 * 1000)\n                };\n                originalAuthError = null;\n            }\n            return response;\n        }\n        else {\n            return data;\n        }\n    });\n}\n/**\n * Generic method for making HTTP requests to ArcGIS REST API endpoints.\n *\n * ```js\n * import { request } from '@esri/arcgis-rest-request';\n *\n * request('https://www.arcgis.com/sharing/rest')\n *   .then(response) // response.currentVersion === 5.2\n *\n * request('https://www.arcgis.com/sharing/rest', {\n *   httpMethod: \"GET\"\n * })\n *\n * request('https://www.arcgis.com/sharing/rest/search', {\n *   params: { q: 'parks' }\n * })\n *   .then(response) // response.total => 78379\n * ```\n *\n * @param url - The URL of the ArcGIS REST API endpoint.\n * @param requestOptions - Options for the request, including parameters relevant to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function request(url, requestOptions = { params: { f: \"json\" } }) {\n    return internalRequest(url, requestOptions).catch((e) => {\n        if (e instanceof ArcGISAuthError &&\n            requestOptions.authentication &&\n            typeof requestOptions.authentication !== \"string\" &&\n            requestOptions.authentication.canRefresh &&\n            requestOptions.authentication.refreshCredentials) {\n            return e.retry(() => {\n                return requestOptions.authentication.refreshCredentials();\n            }, 1);\n        }\n        else {\n            return Promise.reject(e);\n        }\n    });\n}\n//# sourceMappingURL=request.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Helper for methods with lots of first order request options to pass through as request parameters.\n */\nexport function appendCustomParams(customOptions, keys, baseOptions) {\n    const requestOptionsKeys = [\n        \"params\",\n        \"httpMethod\",\n        \"rawResponse\",\n        \"authentication\",\n        \"portal\",\n        \"fetch\",\n        \"maxUrlLength\",\n        \"headers\"\n    ];\n    const options = Object.assign(Object.assign({ params: {} }, baseOptions), customOptions);\n    // merge all keys in customOptions into options.params\n    options.params = keys.reduce((value, key) => {\n        if (customOptions[key] ||\n            typeof customOptions[key] === \"boolean\" ||\n            (typeof customOptions[key] === \"number\" &&\n                customOptions[key] === 0)) {\n            value[key] = customOptions[key];\n        }\n        return value;\n    }, options.params);\n    // now remove all properties in options that don't exist in IRequestOptions\n    return requestOptionsKeys.reduce((value, key) => {\n        if (options[key]) {\n            value[key] = options[key];\n        }\n        return value;\n    }, {});\n}\n//# sourceMappingURL=append-custom-params.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Helper method to ensure that user supplied urls don't include whitespace or a trailing slash.\n */\nexport function cleanUrl(url) {\n    // Guard so we don't try to trim something that's not a string\n    if (typeof url !== \"string\") {\n        return url;\n    }\n    // trim leading and trailing spaces, but not spaces inside the url\n    url = url.trim();\n    // remove the trailing slash to the url if one was included\n    if (url[url.length - 1] === \"/\") {\n        url = url.slice(0, -1);\n    }\n    return url;\n}\n//# sourceMappingURL=clean-url.js.map","/* Copyright (c) 2017-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nexport function decodeParam(param) {\n    const [key, value] = param.split(\"=\");\n    return { key: decodeURIComponent(key), value: decodeURIComponent(value) };\n}\n/**\n * Decodes the passed query string as an object.\n *\n * @param query A string to be decoded.\n * @returns A decoded query param object.\n */\nexport function decodeQueryString(query) {\n    if (!query || query.length <= 0) {\n        return {};\n    }\n    return query\n        .replace(/^#/, \"\")\n        .replace(/^\\?/, \"\")\n        .split(\"&\")\n        .reduce((acc, entry) => {\n        const { key, value } = decodeParam(entry);\n        acc[key] = value;\n        return acc;\n    }, {});\n}\n//# sourceMappingURL=decode-query-string.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cleanUrl } from \"@esri/arcgis-rest-request\";\n/**\n * Helper that returns the appropriate portal url for a given request. `requestOptions.portal` is given\n * precedence over `authentication.portal`. If neither `portal` nor `authentication` is present,\n * `www.arcgis.com/sharing/rest` is returned.\n *\n * @param requestOptions - Request options that may have authentication manager\n * @returns Portal url to be used in API requests\n */\nexport function getPortalUrl(requestOptions = {}) {\n    // use portal in options if specified\n    if (requestOptions.portal) {\n        return cleanUrl(requestOptions.portal);\n    }\n    // if auth was passed, use that portal\n    if (requestOptions.authentication &&\n        typeof requestOptions.authentication !== \"string\") {\n        // the portal url is already scrubbed in the auth package\n        return requestOptions.authentication.portal;\n    }\n    // default to arcgis.com\n    return \"https://www.arcgis.com/sharing/rest\";\n}\n//# sourceMappingURL=get-portal-url.js.map","// eslint-disable-next-line no-control-regex\nconst CONTROL_CHAR_MATCHER = /[\\x00-\\x1F\\x7F-\\x9F\\xA0]/g;\n/**\n * Returns a new string with all control characters removed.\n *\n * Doesn't remove characters from input string.\n *\n * @param str - the string to scrub\n */\nexport function scrubControlChars(str) {\n    return str.replace(CONTROL_CHAR_MATCHER, \"\");\n}\n//# sourceMappingURL=scrub-control-chars.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url.js\";\nimport { scrubControlChars } from \"../util/scrub-control-chars.js\";\nimport { determineOwner } from \"./helpers.js\";\n/**\n * ```\n * import { getItem } from \"@esri/arcgis-rest-portal\";\n * //\n * getItem(\"ae7\")\n *   .then(response);\n * // or\n * getItem(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get an item by id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item.htm) for more information.\n *\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function getItem(id, requestOptions) {\n    const url = getItemBaseUrl(id, requestOptions);\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Get the fully qualified base URL to the REST end point for an item.\n * @param id Item Id\n * @param portalUrlOrRequestOptions a portal URL or request options\n * @returns URL to the item's REST end point, defaults to `https://www.arcgis.com/sharing/rest/content/items/{id}`\n */\nexport const getItemBaseUrl = (id, portalUrlOrRequestOptions) => {\n    const portalUrl = typeof portalUrlOrRequestOptions === \"string\"\n        ? portalUrlOrRequestOptions\n        : getPortalUrl(portalUrlOrRequestOptions);\n    return `${portalUrl}/content/items/${id}`;\n};\n/**\n * ```\n * import { getItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemData(\"ae7\")\n *   .then(response)\n * // or\n * getItemData(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get the /data for an item. If no data exists, returns `undefined`. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-data.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the json data for the item.\n */\nexport function getItemData(id, requestOptions) {\n    const url = `${getItemBaseUrl(id, requestOptions)}/data`;\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\", params: {} }, requestOptions);\n    if (options.file) {\n        options.params.f = null;\n    }\n    return request(url, options).catch((err) => {\n        /* if the item doesn't include data, the response will be empty\n           and the internal call to response.json() will fail */\n        const emptyResponseErr = RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i);\n        /* istanbul ignore else */\n        if (emptyResponseErr.test(err.message)) {\n            return;\n        }\n        else\n            throw err;\n    });\n}\n/**\n * ```\n * import { getRelatedItems } from \"@esri/arcgis-rest-portal\";\n * //\n * getRelatedItems({\n *   id: \"ae7\",\n *   relationshipType: \"Service2Layer\" // or several [\"Service2Layer\", \"Map2Area\"]\n * })\n *   .then(response)\n * ```\n * Get the related items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/related-items.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getRelatedItems(requestOptions) {\n    const url = `${getItemBaseUrl(requestOptions.id, requestOptions)}/relatedItems`;\n    const options = Object.assign({ httpMethod: \"GET\", params: {\n            direction: requestOptions.direction\n        } }, requestOptions);\n    if (typeof requestOptions.relationshipType === \"string\") {\n        options.params.relationshipType = requestOptions.relationshipType;\n    }\n    else {\n        options.params.relationshipTypes = requestOptions.relationshipType;\n    }\n    delete options.direction;\n    delete options.relationshipType;\n    return request(url, options);\n}\n/**\n * Get the resources associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getItemResources(id, requestOptions) {\n    const url = `${getItemBaseUrl(id, requestOptions)}/resources`;\n    // Mix in num:1000 with any user supplied params\n    // Key thing - we don't want to mutate the passed in requestOptions\n    // as that may be used in other (subsequent) calls in the course\n    // of a long promise chains\n    const options = Object.assign({}, requestOptions);\n    options.params = Object.assign({ num: 1000 }, options.params);\n    return request(url, options);\n}\n/**\n * Fetches an item resource and optionally parses it to the correct format.\n *\n * Provides JSON parse error protection by sanitizing out any unescaped control characters before parsing that would otherwise cause an error to be thrown.\n *\n * ```js\n * import { getItemResource } from \"@esri/arcgis-rest-portal\";\n *\n * // Parses contents as blob by default\n * getItemResource(\"3ef\", { fileName: \"resource.jpg\", ...})\n *  .then(resourceContents => {});\n *\n * // Can override parse method\n * getItemResource(\"3ef\", { fileName: \"resource.json\", readAs: 'json', ...})\n *  .then(resourceContents => {});\n *\n * // Get the response object instead\n * getItemResource(\"3ef\",{ rawResponse: true, fileName: \"resource.json\" })\n *  .then(response => {})\n * ```\n *\n * @param {string} itemId\n * @param {IGetItemResourceOptions} requestOptions\n */\nexport function getItemResource(itemId, requestOptions) {\n    const readAs = requestOptions.readAs || \"blob\";\n    return getItemFile(itemId, `/resources/${requestOptions.fileName}`, readAs, requestOptions);\n}\n/**\n * Lists the groups of which the item is a part, only showing the groups that the calling user can access. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/groups.htm) for more information.\n *\n * ```js\n * import { getItemGroups } from \"@esri/arcgis-rest-portal\";\n *\n * getItemGroups(\"30e5fe3149c34df1ba922e6f5bbf808f\")\n *   .then(response)\n * ```\n *\n * @param id - The Id of the item to query group association for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item groups.\n */\nexport function getItemGroups(id, requestOptions) {\n    const url = `${getItemBaseUrl(id, requestOptions)}/groups`;\n    return request(url, requestOptions);\n}\n/**\n * Inquire about status when publishing an item, adding an item in async mode, or adding with a multipart upload. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/status.htm) for more information.\n *\n * ```js\n * import { getItemStatus } from \"@esri/arcgis-rest-portal\";\n *\n * getItemStatus({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n *\n * @param id - The Id of the item to get status for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item status.\n */\nexport function getItemStatus(requestOptions) {\n    return determineOwner(requestOptions).then((owner) => {\n        const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${requestOptions.id}/status`;\n        const options = appendCustomParams(requestOptions, [\"jobId\", \"jobType\"], { params: Object.assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * Lists the part numbers of the file parts that have already been uploaded in a multipart file upload. This method can be used to verify the parts that have been received as well as those parts that were not received by the server. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/parts.htm) for more information.\n *\n * ```js\n * import { getItemParts } from \"@esri/arcgis-rest-portal\";\n *\n * getItemParts({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n *\n * @param id - The Id of the item to get part list.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item part list.\n */\nexport function getItemParts(requestOptions) {\n    return determineOwner(requestOptions).then((owner) => {\n        const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${requestOptions.id}/parts`;\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```\n * import { getItemInfo } from \"@esri/arcgis-rest-portal\";\n * // get the \"Info Card\" for the item\n * getItemInfo(\"ae7\")\n *   .then(itemInfoXml) // XML document as a string\n * // or get the contents of a specific file\n * getItemInfo(\"ae7\", { fileName: \"form.json\", readAs: \"json\", authentication })\n *   .then(formJson) // JSON document as JSON\n * ```\n * Get an info file for an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-info-file.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request, including the file name which defaults to `iteminfo.xml`.\n * If the file is not a text file (XML, HTML, etc) you will need to specify the `readAs` parameter\n * @returns A Promise that will resolve with the contents of the info file for the item.\n */\nexport function getItemInfo(id, requestOptions) {\n    const { fileName = \"iteminfo.xml\", readAs = \"text\" } = requestOptions || {};\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    return getItemFile(id, `/info/${fileName}`, readAs, options);\n}\n/**\n * ```\n * import { getItemMetadata } from \"@esri/arcgis-rest-portal\";\n * // get the metadata for the item\n * getItemMetadata(\"ae7\")\n *   .then(itemMetadataXml) // XML document as a string\n * // or with additional request options\n * getItemMetadata(\"ae7\", { authentication })\n *   .then(itemMetadataXml) // XML document as a string\n * ```\n * Get the standard formal metadata XML file for an item (`/info/metadata/metadata.xml`)\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the contents of the metadata file for the item as a string.\n */\nexport function getItemMetadata(id, requestOptions) {\n    const options = Object.assign(Object.assign({}, requestOptions), { fileName: \"metadata/metadata.xml\" });\n    return getItemInfo(id, options);\n}\n// overrides request()'s default behavior for reading the response\n// which is based on `params.f` and defaults to JSON\n// Also adds JSON parse error protection by sanitizing out any unescaped control characters before parsing\nfunction getItemFile(id, \n// NOTE: fileName should include any folder/subfolders\nfileName, readMethod, requestOptions) {\n    const url = `${getItemBaseUrl(id, requestOptions)}${fileName}`;\n    // preserve escape hatch to let the consumer read the response\n    // and ensure the f param is not appended to the query string\n    const options = Object.assign({ params: {} }, requestOptions);\n    const justReturnResponse = options.rawResponse;\n    options.rawResponse = true;\n    options.params.f = null;\n    return request(url, options).then((response) => {\n        if (justReturnResponse) {\n            return response;\n        }\n        return readMethod !== \"json\"\n            ? response[readMethod]()\n            : response\n                .text()\n                .then((text) => JSON.parse(scrubControlChars(text)));\n    });\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url.js\";\n/**\n * Fetch a group using its id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group.htm) for more information.\n *\n * ```js\n * import { getGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * getGroup(\"fxb988\") // id\n *   .then(response)\n * ```\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns  A Promise that will resolve with the data from the response.\n */\nexport function getGroup(id, requestOptions) {\n    const url = `${getPortalUrl(requestOptions)}/community/groups/${id}`;\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Gets the category schema set on a group\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns A promise that will resolve with JSON of group's category schema\n * @see https://developers.arcgis.com/rest/users-groups-and-items/group-category-schema.htm\n */\nexport function getGroupCategorySchema(id, requestOptions) {\n    const url = `${getPortalUrl(requestOptions)}/community/groups/${id}/categorySchema`;\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Returns the content of a Group. Since the group may contain 1000s of items\n * the requestParams allow for paging.\n * @param id - Group Id\n * @param requestOptions  - Options for the request, including paging parameters.\n * @returns  A Promise that will resolve with the content of the group.\n */\nexport function getGroupContent(id, requestOptions) {\n    const url = `${getPortalUrl(requestOptions)}/content/groups/${id}`;\n    // default to a GET request\n    const options = Object.assign(Object.assign({ httpMethod: \"GET\" }, { params: { start: 1, num: 100 } }), requestOptions);\n    // is this the most concise way to mixin with the defaults above?\n    if (requestOptions && requestOptions.paging) {\n        options.params = Object.assign({}, requestOptions.paging);\n    }\n    return request(url, options);\n}\n/**\n * Get the usernames of the admins and members. Does not return actual 'User' objects. Those must be\n * retrieved via separate calls to the User's API.\n * @param id - Group Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with arrays of the group admin usernames and the member usernames\n */\nexport function getGroupUsers(id, requestOptions) {\n    const url = `${getPortalUrl(requestOptions)}/community/groups/${id}/users`;\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Search the users in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-users-list.htm) for more information.\n *\n * ```js\n * import { searchGroupUsers } from \"@esri/arcgis-rest-portal\";\n *\n * searchGroupUsers('abc123')\n *   .then(response)\n * ```\n *\n * @param id - The group id\n * @param searchOptions - Options for the request, including paging parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupUsers(id, searchOptions) {\n    const url = `${getPortalUrl(searchOptions)}/community/groups/${id}/userlist`;\n    const options = appendCustomParams(searchOptions || {}, [\"name\", \"num\", \"start\", \"sortField\", \"sortOrder\", \"joined\", \"memberType\"], {\n        httpMethod: \"GET\"\n    });\n    return request(url, options);\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018-2021 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { warn } from \"@esri/arcgis-rest-request\";\n/**\n * `SearchQueryBuilder` can be used to construct the `q` param for {@linkcode searchItems} or {@linkcode searchGroups}.\n *\n * By chaining methods, it helps build complex search queries.\n *\n * ```js\n * const startDate = new Date(\"2020-01-01\");\n * const endDate = new Date(\"2020-09-01\");\n * const query = new SearchQueryBuilder()\n *  .match(\"Patrick\")\n *  .in(\"owner\")\n *  .and()\n *  .from(startDate)\n *  .to(endDate)\n *  .in(\"created\")\n *  .and()\n *  .startGroup()\n *    .match(\"Web Mapping Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Mobile Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Application\")\n *    .in(\"type\")\n *  .endGroup()\n *  .and()\n *  .match(\"Demo App\");\n *\n * searchItems(query).then((res) => {\n *   console.log(res.results);\n * });\n * ```\n *\n * Will search for items matching\n * ```\n * \"owner: Patrick AND created:[1577836800000 TO 1598918400000] AND (type:\"Web Mapping Application\" OR type:\"Mobile Application\" OR type:Application) AND Demo App\"\n * ```\n */\nexport class SearchQueryBuilder {\n    /**\n     * @param q An existing query string to start building from.\n     */\n    constructor(q = \"\") {\n        this.termStack = [];\n        this.rangeStack = [];\n        this.openGroups = 0;\n        this.q = q;\n    }\n    /**\n     * Defines strings to search for.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     * ```\n     *\n     * @param terms strings to search for.\n     */\n    match(...terms) {\n        this.termStack = this.termStack.concat(terms);\n        return this;\n    }\n    /**\n     * Defines fields to search in. You can pass `\"*\"` or call this method without arguments to search a default set of fields\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     *   .in(\"title\")\n     * ```\n     *\n     * @param field The field to search for the previous match in.\n     */\n    in(field) {\n        const fn = `\\`in(${field ? `\"${field}\"` : \"\"})\\``;\n        if (!this.hasRange && !this.hasTerms) {\n            warn(\n            // apparently-p-rettier-ignore causes some\n            `${fn} was called with no call to \\`match(...)\\` or \\`from(...)\\`/\\`to(...)\\`. Your query was not modified.`);\n            return this;\n        }\n        if (field && field !== \"*\") {\n            this.q += `${field}:`;\n        }\n        return this.commit();\n    }\n    /**\n     * Starts a new search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    startGroup() {\n        this.commit();\n        if (this.openGroups > 0) {\n            this.q += \" \";\n        }\n        this.openGroups++;\n        this.q += \"(\";\n        return this;\n    }\n    /**\n     * Ends a search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    endGroup() {\n        if (this.openGroups <= 0) {\n            warn(`\\`endGroup(...)\\` was called without calling \\`startGroup(...)\\` first. Your query was not modified.`);\n            return this;\n        }\n        this.commit();\n        this.openGroups--;\n        this.q += \")\";\n        return this;\n    }\n    /**\n     * Joins two sets of queries with an `AND` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .and()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    and() {\n        return this.addModifier(\"and\");\n    }\n    /**\n     * Joins two sets of queries with an `OR` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    or() {\n        return this.addModifier(\"or\");\n    }\n    /**\n     * Joins two sets of queries with a `NOT` clause. Another option for filtering results is the [prohibit operator '-'](https://developers.arcgis.com/rest/users-groups-and-items/search-reference.htm#ESRI_SECTION1_5C6C35DB9E4A4F4492C5B937BDA2BF67).\n     *\n     * ```js\n     * // omit results with \"Rivers\" in their title\n     * const query = new SearchQueryBuilder()\n     *   .not()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *\n     * // equivalent\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Rivers\")\n     *   .in(\"-title\")\n     * ```\n     */\n    not() {\n        return this.addModifier(\"not\");\n    }\n    /**\n     * Begins a new range query.\n     *\n     * ```js\n     *\n     * const NEWYEARS = new Date(\"2020-01-01\")\n     * const TODAY = new Date()\n     *\n     * const query = new SearchQueryBuilder()\n     *   .from(NEWYEARS)\n     *   .to(TODAY)\n     *   .in(\"created\")\n     * ```\n     */\n    from(term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            `\\`from(...)\\` is not allowed after \\`match(...)\\` try using \\`.from(...).to(...).in(...)\\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\"2020-01-01\").  Your query was not modified.`);\n            return this;\n        }\n        this.rangeStack[0] = term;\n        return this;\n    }\n    /**\n     * Ends a range query.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .from(yesterdaysDate)\n     *   .to(todaysDate)\n     *   .in(\"created\")\n     * ```\n     */\n    to(term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            `\\`to(...)\\` is not allowed after \\`match(...)\\` try using \\`.from(...).to(...).in(...)\\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\"2020-01-01\"). Your query was not modified.`);\n            return this;\n        }\n        this.rangeStack[1] = term;\n        return this;\n    }\n    /**\n     * Boosts the previous term to increase its rank in the results.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *   .boost(3)\n     * ```\n     */\n    boost(num) {\n        this.commit();\n        this.q += `^${num}`;\n        return this;\n    }\n    /**\n     * Returns the current query string. Called internally when the request is made.\n     */\n    toParam() {\n        this.commit();\n        this.cleanup();\n        return this.q;\n    }\n    /**\n     * Returns a new instance of `SearchQueryBuilder` based on the current instance.\n     */\n    clone() {\n        this.commit();\n        this.cleanup();\n        return new SearchQueryBuilder(this.q + \"\");\n    }\n    addModifier(modifier) {\n        if (this.currentModifer) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            `You have called \\`${this.currentModifer}()\\` after \\`${modifier}()\\`. Your current query was not modified.`);\n            return this;\n        }\n        this.commit();\n        if (this.q === \"\" && modifier !== \"not\") {\n            warn(`You have called \\`${modifier}()\\` without calling another method to modify your query first. Try calling \\`match()\\` first.`);\n            return this;\n        }\n        this.currentModifer = modifier;\n        this.q += this.q === \"\" ? \"\" : \" \";\n        this.q += `${modifier.toUpperCase()} `;\n        return this;\n    }\n    hasWhiteSpace(s) {\n        return /\\s/g.test(s);\n    }\n    formatTerm(term) {\n        if (term instanceof Date) {\n            return term.getTime();\n        }\n        if (typeof term === \"string\" && this.hasWhiteSpace(term)) {\n            return `\"${term}\"`;\n        }\n        return term;\n    }\n    commit() {\n        this.currentModifer = undefined;\n        if (this.hasRange) {\n            this.q += `[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(this.rangeStack[1])}]`;\n            this.rangeStack = [undefined, undefined];\n        }\n        if (this.hasTerms) {\n            this.q += this.termStack\n                .map((term) => {\n                return this.formatTerm(term);\n            })\n                .join(\" \");\n            this.termStack = [];\n        }\n        return this;\n    }\n    get hasTerms() {\n        return this.termStack.length > 0;\n    }\n    get hasRange() {\n        return this.rangeStack.length && this.rangeStack[0] && this.rangeStack[1];\n    }\n    cleanup() {\n        // end a group if we have started one\n        if (this.openGroups > 0) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            `Automatically closing ${this.openGroups} group(s). You can use \\`endGroup(...)\\` to remove this warning.`);\n            while (this.openGroups > 0) {\n                this.q += \")\";\n                this.openGroups--;\n            }\n        }\n        const oldQ = this.q;\n        this.q = oldQ.replace(/( AND ?| NOT ?| OR ?)*$/, \"\");\n        if (oldQ !== this.q) {\n            warn(`\\`startGroup(...)\\` was called without calling \\`endGroup(...)\\` first. Your query was not modified.`);\n        }\n        // clear empty groups\n        this.q = this.q.replace(/(\\(\\))*/, \"\");\n    }\n}\n//# sourceMappingURL=SearchQueryBuilder.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { SearchQueryBuilder } from \"./SearchQueryBuilder.js\";\nimport { getPortalUrl } from \"../util/get-portal-url.js\";\nexport function genericSearch(search, searchType) {\n    let options;\n    if (typeof search === \"string\" || search instanceof SearchQueryBuilder) {\n        options = {\n            httpMethod: \"GET\",\n            params: {\n                q: search\n            }\n        };\n    }\n    else {\n        // searchUserAccess has one (known) valid value: \"groupMember\"\n        options = appendCustomParams(search, [\n            \"q\",\n            \"num\",\n            \"start\",\n            \"sortField\",\n            \"sortOrder\",\n            \"searchUserAccess\",\n            \"searchUserName\",\n            \"filter\",\n            \"countFields\",\n            \"countSize\",\n            \"categories\",\n            \"categoryFilters\"\n        ], {\n            httpMethod: \"GET\"\n        });\n    }\n    let path;\n    switch (searchType) {\n        case \"item\":\n            path = \"/search\";\n            break;\n        case \"group\":\n            path = \"/community/groups\";\n            break;\n        case \"groupContent\":\n            // Need to have groupId property to do group contents search,\n            // cso filter out all but ISearchGroupContentOptions\n            if (typeof search !== \"string\" &&\n                !(search instanceof SearchQueryBuilder) &&\n                search.groupId) {\n                path = `/content/groups/${search.groupId}/search`;\n            }\n            else {\n                return Promise.reject(new Error(\"you must pass a `groupId` option to `searchGroupContent`\"));\n            }\n            break;\n        default:\n            // \"users\"\n            path = \"/portals/self/users/search\";\n            break;\n    }\n    const url = getPortalUrl(options) + path;\n    // send the request\n    return request(url, options).then((r) => {\n        if (r.nextStart && r.nextStart !== -1) {\n            r.nextPage = function () {\n                let newOptions;\n                if (typeof search === \"string\" ||\n                    search instanceof SearchQueryBuilder) {\n                    newOptions = {\n                        q: search,\n                        start: r.nextStart\n                    };\n                }\n                else {\n                    newOptions = search;\n                    newOptions.start = r.nextStart;\n                }\n                return genericSearch(newOptions, searchType);\n            };\n        }\n        return r;\n    });\n}\n//# sourceMappingURL=generic-search.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { genericSearch } from \"../util/generic-search.js\";\n/**\n * Search a portal for items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/search.htm) for more information.\n *\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n *\n * searchItems('water')\n *   .then(response) // response.total => 355\n * ```\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchItems(search) {\n    return genericSearch(search, \"item\");\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { genericSearch } from \"../util/generic-search.js\";\n/**\n * Search a portal for groups. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-search.htm) for more information.\n *\n * ```js\n * import { searchGroups } from \"@esri/arcgis-rest-portal\";\n *\n * searchGroups('water')\n *   .then(response) // response.total => 355\n * ```\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroups(search) {\n    return genericSearch(search, \"group\");\n}\n/**\n * Search a portal for items in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-content-search.htm) for more information.\n *\n * ```js\n * import { searchGroupContent } from \"@esri/arcgis-rest-portal\";\n *\n * searchGroupContent('water')\n *   .then(response) // response.total => 355\n * ```\n *\n * @param options - RequestOptions object amended with search parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupContent(options) {\n    return genericSearch(options, \"groupContent\");\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url.js\";\n/**\n * Get information about a user. This method has proven so generically useful that you can also call {@linkcode ArcGISIdentityManager.getUser}.\n *\n * ```js\n * import { getUser } from '@esri/arcgis-rest-portal';\n * //\n * getUser(\"jsmith\")\n *   .then(response)\n * // => { firstName: \"John\", lastName: \"Smith\",tags: [\"GIS Analyst\", \"City of Redlands\"] }\n * ```\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with metadata about the user\n */\nexport function getUser(requestOptions) {\n    let url;\n    let options = { httpMethod: \"GET\" };\n    // if a username is passed, assume ArcGIS Online\n    if (typeof requestOptions === \"string\") {\n        url = `https://www.arcgis.com/sharing/rest/community/users/${requestOptions}`;\n    }\n    else {\n        // if an authenticated session is passed, default to that user/portal unless another username is provided manually\n        const username = requestOptions.username || requestOptions.authentication.username;\n        url = `${getPortalUrl(requestOptions)}/community/users/${encodeURIComponent(username)}`;\n        options = Object.assign(Object.assign({}, requestOptions), options);\n    }\n    // send the request\n    return request(url, options);\n}\n//# sourceMappingURL=get-user.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url.js\";\n/**\n * Get notifications for a user.\n *\n * ```js\n * import { getUserNotifications } from '@esri/arcgis-rest-portal';\n *\n * getUserNotifications({ authentication })\n *   .then(results) // results.notifications.length) => 3\n * ```\n *\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with the user's notifications\n */\nexport function getUserNotifications(requestOptions) {\n    let options = { httpMethod: \"GET\" };\n    const username = encodeURIComponent(requestOptions.authentication.username);\n    const portalUrl = getPortalUrl(requestOptions);\n    const url = `${portalUrl}/community/users/${username}/notifications`;\n    options = Object.assign(Object.assign({}, requestOptions), options);\n    // send the request\n    return request(url, options);\n}\n/**\n * Delete a notification.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function removeNotification(requestOptions) {\n    const username = encodeURIComponent(requestOptions.authentication.username);\n    const portalUrl = getPortalUrl(requestOptions);\n    const url = `${portalUrl}/community/users/${username}/notifications/${requestOptions.id}/delete`;\n    return request(url, requestOptions);\n}\n//# sourceMappingURL=notification.js.map","import { genericSearch } from \"../util/generic-search.js\";\n/**\n * Search a portal for users.\n *\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n * //\n * searchUsers({ q: 'tommy', authentication })\n *   .then(response) // response.total => 355\n * ```\n *\n * @param search - A RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchUsers(search) {\n    return genericSearch(search, \"user\");\n}\n//# sourceMappingURL=search-users.js.map","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"./get-portal-url.js\";\n/**\n * Get the portal\n * @param requestOptions\n */\nexport function getSelf(requestOptions) {\n    // just delegate to getPortal w/o an id\n    return getPortal(null, requestOptions);\n}\n/**\n * Fetch information about the specified portal by id. If no id is passed, portals/self will be called.\n *\n * If you intend to request a portal by id and it is different from the portal specified by options.authentication, you must also pass options.portal.\n *\n *  ```js\n * import { getPortal } from \"@esri/arcgis-rest-portal\";\n * //\n * getPortal()\n * getPortal(\"fe8\")\n * getPortal(null, { portal: \"https://custom.maps.arcgis.com/sharing/rest/\" })\n * ```\n *\n * @param id\n * @param requestOptions\n */\nexport function getPortal(id, requestOptions) {\n    // construct the search url\n    const idOrSelf = id ? id : \"self\";\n    const url = `${getPortalUrl(requestOptions)}/portals/${idOrSelf}`;\n    // default to a GET request\n    const options = Object.assign({ httpMethod: \"GET\" }, requestOptions);\n    // send the request\n    return request(url, options);\n}\n//# sourceMappingURL=get-portal.js.map","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/**\n * Get a property out of a deeply nested object\n * Does not handle anything but nested object graph\n */\nexport function getProp(obj, path) {\n    return path.split(\".\").reduce(function (prev, curr) {\n        /* istanbul ignore next no need to test undefined scenario */\n        return prev ? prev[curr] : undefined;\n    }, obj);\n}\n//# sourceMappingURL=get-prop.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp } from \"./objects/get-prop\";\n/**\n * ```js\n * import { cloneObject } from \"@esri/hub-common\";\n * const original = { foo: \"bar\" }\n * const copy = cloneObject(original)\n * copy.foo // \"bar\"\n * copy === original // false\n * ```\n * Make a deep clone, including arrays. Does not handle functions!\n */\nexport function cloneObject(obj) {\n    let clone = {};\n    // first check array\n    if (Array.isArray(obj)) {\n        clone = obj.map(cloneObject);\n    }\n    else if (typeof obj === \"object\") {\n        for (const i in obj) {\n            if (obj.hasOwnProperty(i)) {\n                const value = obj[i];\n                if (value != null && typeof value === \"object\") {\n                    if (value instanceof Date) {\n                        clone[i] = new Date(value.getTime());\n                    }\n                    else if (typeof Blob !== \"undefined\" && value instanceof Blob) {\n                        clone[i] = new Blob([value], { type: value.type });\n                    }\n                    else {\n                        clone[i] = cloneObject(value);\n                    }\n                }\n                else {\n                    clone[i] = value;\n                }\n            }\n        }\n    }\n    else {\n        clone = obj;\n    }\n    return clone;\n}\n/**\n * Given an array of objects, convert into an object, with each\n * entry assigned the key via the keyprop\n */\nexport function arrayToObject(arr, key) {\n    return arr.reduce((hash, entry) => {\n        hash[getProp(entry, key)] = entry;\n        return hash;\n    }, {});\n}\n/**\n * Given an object, convert into an array, with each\n * something or other\n */\nexport function objectToArray(obj, keyProp = \"id\") {\n    const arr = Object.keys(obj).reduce((acc, prop) => {\n        obj[prop][keyProp] = prop;\n        acc.push(cloneObject(obj[prop]));\n        return acc;\n    }, []);\n    return arr;\n}\n/**\n * Return an entry from an array by a property name\n */\nexport function findBy(arr, prop, value) {\n    if (!arr) {\n        return null;\n    }\n    const res = arr.reduce((acc, entry) => {\n        if (getProp(entry, prop) === value) {\n            acc = entry;\n        }\n        return acc;\n    }, null);\n    return res;\n}\n/**\n * Return a new array without the specified value.\n *\n * @export\n * @param {any[]} arr\n * @param {*} val value or object to remove\n * @returns {any[]} Array without the value\n */\nexport function without(arr, value) {\n    const res = arr.filter((entry) => entry !== value);\n    return res;\n}\n/**\n * Compose\n * adapted from: https://github.com/stoeffel/compose-function/blob/master/module/index.js\n */\nexport function compose(...fns) {\n    return fns.reduce((f, g) => (...args) => f(g(...args)));\n}\n/**\n * Return a random number, prefixed with a string. Used for unique identifiers that do not require\n * the rigor of a full UUID - i.e. node id's, process ids etc.\n * @param prefix String to prefix the random number with so the result is a valid javascript property\n */\nexport function createId(prefix = \"i\") {\n    // prepend some char so it's always a valid dotable property name\n    // get a random number, convert to base 36 representation, then grab chars 2-8\n    return `${prefix}${Math.random().toString(36).substr(2, 8)}`;\n}\n/**\n * Append or replace a value on an object, using a specified key, if the value is not null.\n * This is a very useful companion to the [getProp()](../getProp/) utility.\n *\n * Note: object that is passed in is cloned before the property is appended.\n *\n * Allows for code like:\n *\n * ```js\n * let model = {\n *  item: {\n *    title: 'some example object',\n *    description: 'this is some longer text',\n *    type: 'Web Map',\n *    properties: {\n *      sourceId: '3ef'\n *    }\n *  },\n *  data: {\n *    theme: 'orange',\n *    parcelLayer: {\n *      primaryField: 'PIN'\n *    }\n *  }\n * };\n *\n * // Let's extract some details into an object.\n * const summary = [\n *  'item.title',\n *  'item.description',\n *  'item.missingProp',\n *  'data.parcelLayer.primaryField'].reduce((acc, prop) => {\n *   // create the property name... you could do this however...\n *   let propName = prop.split('.').reverse()[0];\n *   return maybeAdd(propName, getProp(model, key), acc);\n * }, {});\n *\n * // summary =>\n * // {\n * //   title: 'some example object',\n * //   description: 'this is some longer text',\n * //   primaryField: 'PIN'\n * // }\n * ```\n * @param key - key to use when appending to the object\n * @param val - the possibly null value\n * @param target - the object to update\n */\nexport function maybeAdd(key, val, target) {\n    // see if we got something...\n    if (val !== null && val !== undefined) {\n        target = cloneObject(target);\n        // attach using the key\n        target[key] = val;\n    }\n    return target;\n}\n/**\n * Append a value to an array, if the value is not null.\n * This is a very useful companion to the [getProp()](../getProp/) utility.\n *\n * Note: the array that is passed in is cloned before being appended to.\n *\n * Allows for code like:\n * ```js\n *  // example object\n * let model = {\n *  item: {\n *    id: 'c00',\n *    title: 'some example object',\n *    description: 'this is some longer text',\n *    type: 'Web Map',\n *    properties: {\n *      sourceId: '3ef'\n *    }\n *  },\n *  data: {\n *    theme: 'orange',\n *    parcelLayer: {\n *      itemId: '7ca',\n *      primaryField: 'PIN'\n *    }\n *  }\n * };\n * // lets pluck some id's into an array...\n * maybePush(getProp(model, 'item.properties.sourceId'), []);\n * // > ['3ef']\n *\n * // now try to get a value from a property that is missing...\n * maybePush(getProp(obj, 'item.properties.childId'), []);\n * // > []\n *\n * // easily pluck values via property paths\n * const summary = [\n *  'item.id',\n *  'item.properties.sourceId',\n *  'item.properties.childId',\n *  'data.parcelLayer.itemId'].reduce((acc, prop) => {\n *   return maybePush(getProp(model, key), acc);\n * }, []);\n *\n * // summary => ['c00', '3ef', '7ca']\n *\n * ```\n *\n * @param val - the possibly null value\n * @param target - the array to add the value to\n */\nexport function maybePush(val, target) {\n    if (val !== null && val !== undefined) {\n        // create a clone because mutation makes us sad...\n        target = cloneObject(target);\n        target.push(val);\n    }\n    return target;\n}\n/**\n * Convert a string to camelCase\n *\n * @export\n * @param {string} value\n * @returns {string} camelCased string\n */\nexport function camelize(value) {\n    // lower case the whole thing to start...\n    value = value.toLowerCase();\n    // strip out any/all special chars...\n    value = value.replace(/[`~!@#$%^&*()_|+\\-=?;:'\",.<>\\{\\}\\[\\]\\\\\\/]/gi, \" \");\n    // Hoisted from EmberJS (MIT License)\n    // https://github.com/emberjs/ember.js/blob/v2.0.1/packages/ember-runtime/lib/system/string.js#L23-L27\n    const STRING_CAMELIZE_REGEXP_1 = /(\\-|\\_|\\.|\\s)+(.)?/g;\n    const STRING_CAMELIZE_REGEXP_2 = /(^|\\/)([A-Z])/g;\n    return value\n        .replace(STRING_CAMELIZE_REGEXP_1, function (match, separator, chr) {\n        return chr ? chr.toUpperCase() : \"\";\n    })\n        .replace(STRING_CAMELIZE_REGEXP_2, function (match, separator, chr) {\n        return match.toLowerCase();\n    });\n}\n/**\n * Determines if a value is unique in an array\n * Allows for code like:\n *\n * ```js\n * const ary = [ 1, 2, 3, 3, 4, 5, 1 ];\n *\n * const result = ary.filter(unique);\n *\n * result => [ 1, 2, 3, 4, 5 ]\n * ```\n * @param value - the value to search for\n * @param index - the index of the searched value\n * @param ary - the array to search\n * @returns {boolean} - indicating if the value is unique in the array\n */\nexport function unique(value, index, ary) {\n    return ary.indexOf(value) === index;\n}\n/**\n * Return array of unique objects, based on a deep property value\n *  Note: Property you compare on should be a primative type\n * @export\n * @template T\n * @param {T[]} arr\n * @param {string} prop\n * @return {*}  {T[]}\n */\nexport function uniqueBy(arr, prop) {\n    return arr.reduce((acc, entry) => {\n        const nameMatches = (e) => getProp(e, prop) === getProp(entry, prop);\n        return maybePush(acc.find(nameMatches) ? null : entry, acc);\n    }, []);\n}\n/**\n * Return last element of an array\n *\n * @export\n * @template T\n * @param {T[]} arr\n * @return {*}  {T}\n */\nexport function last(arr) {\n    return arr[arr.length - 1];\n}\n/**\n * Filter an array by a deep property value\n *\n * @export\n * @template T\n * @param {T[]} arr\n * @param {string} prop\n * @param {unknown} val\n * @return {*}  {T[]}\n */\nexport function filterBy(arr, prop, val) {\n    return arr.filter((entry) => getProp(entry, prop) === val);\n}\n/**\n * Extends the target object with props from the source object, overwriting identically named\n * props in target with those from source, ignoring null and undefined values; similar to $.extend.\n * Performs a deep extend by default, unless deep = false is passed as the third arg.\n *\n * @param target - the object that will take props from source\n * @param source - the object from which to take props\n * @param deep - whether or not to perform a deep (recursive) extend of source\n */\nexport function extend(target, source, deep = true) {\n    const extended = cloneObject(target);\n    return Object.keys(source).reduce((obj, prop) => {\n        if (source[prop] !== null && source[prop] !== undefined) {\n            const value = cloneObject(source[prop]);\n            if (Array.isArray(value)) {\n                // check for arrays, since array is type object\n                obj[prop] = value;\n            }\n            else if (deep && typeof value === \"object\") {\n                obj[prop] = extend(obj[prop] || {}, value, deep);\n            }\n            else {\n                obj[prop] = value;\n            }\n        }\n        return obj;\n    }, extended);\n}\n/**\n * Add number of days to a given date\n *\n * @export\n * @param {string} date\n * @param {number} numOfDays\n * @returns {string} date string with numOfDays added to the given date\n */\nexport function addDays(date, numOfDays) {\n    try {\n        const given = new Date(date);\n        const dateString = new Date(given.setDate(given.getDate() + numOfDays)).toISOString();\n        return dateString.split(\"T\")[0];\n    }\n    catch (e) {\n        throw new Error(\"Invalid Date\");\n    }\n}\n/**\n * Returns an array with arrays of the given size.\n *\n * @param arr Array to split\n * @param size Size of every group\n */\nexport function chunkArray(arr, size) {\n    const results = [];\n    let index = 0;\n    while (index < arr.length) {\n        results.push(arr.slice(index, index + size));\n        index += size;\n    }\n    return results;\n}\n/**\n * Determine if a value is null or undefined\n * @param value anything\n * @returns\n */\nexport const isNil = (value) => value == null;\n/**\n * Upper case first letter (only) of a string\n * @param word\n * @returns Word\n */\nexport const capitalize = (word) => {\n    // upper case first letter and return as element in array for backwards compatibility\n    const chars = Array.from(word);\n    chars[0] = chars[0].toUpperCase();\n    return chars.join(\"\");\n};\n/**\n * An IE-compatible stand-in for Javascript's [array.flat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat)\n * @param arr the array\n * @returns an array\n */\nexport function flattenArray(arr) {\n    return arr.reduce((acc, val) => acc.concat(val), []);\n}\n//# sourceMappingURL=util.js.map","import { cloneObject } from \"../util\";\n/**\n * Deep set function. Like Ember.set, but smarter as it will create the path\n * @param {Object} target Object we want to set the property on\n * @param {String} path Dotted path to the property we want to set\n * @param {Any} value Value we want to assign to the property\n */\nexport function deepSet(target, path, value = {}) {\n    const parts = path.split(\".\");\n    let worker = target;\n    const lastIdx = parts.length - 1;\n    parts.forEach((p, idx) => {\n        if (!worker.hasOwnProperty(p) || worker[p] == null) {\n            if (idx === lastIdx) {\n                worker[p] = value;\n            }\n            else {\n                // keep building the path\n                worker[p] = {};\n            }\n        }\n        else if (idx === lastIdx) {\n            if (typeof worker[p] === \"object\" && !Array.isArray(worker[p])) {\n                worker[p] = Object.assign(worker[p], cloneObject(value));\n            }\n            else {\n                worker[p] = value;\n            }\n        }\n        worker = worker[p];\n    });\n}\n//# sourceMappingURL=deep-set.js.map","import { getProp } from \"./get-prop\";\n/**\n * Gets the value of a property from an object with a\n * default if that prop is undefined\n * @param obj\n * @param prop\n * @param def\n */\nexport function getWithDefault(obj, prop, def) {\n    const res = getProp(obj, prop);\n    return res !== undefined ? res : def;\n}\n//# sourceMappingURL=get-with-default.js.map","import { deepSet } from \"./deep-set\";\n/**\n * Sets a deep object property, constructing the property path as necessary\n *\n * @param path - the path to the property we want to set\n * @param val - the value we want to set it to\n * @param obj - the target object\n */\nexport function setProp(path, val, obj) {\n    if (Array.isArray(path)) {\n        path = path.join(\".\");\n    }\n    deepSet(obj, path, val);\n}\n//# sourceMappingURL=set-prop.js.map","/* Copyright (c) 2018-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getWithDefault } from \"./objects/get-with-default\";\n/**\n * Generic Solution Error with an Error stack as well\n * as an optional serialized OperationStack.\n *\n * Also accepts a `rootCause` Error object\n */\nexport default class OperationError extends Error {\n    /**\n     * Creates an instance of OperationError.\n     * @param {string} operation\n     * @param {string} [message]\n     * @param {Error} [rootCause]\n     * @memberof OperationError\n     */\n    constructor(operation, message, rootCause) {\n        message = message || \"UNKNOWN_ERROR\";\n        // if the rootCause has a .rootCause, use that so we don't deeply nest\n        rootCause = getWithDefault(rootCause, \"rootCause\", rootCause);\n        super(message);\n        this.operation = operation;\n        this.name = \"OperationError\";\n        this.rootCause = rootCause;\n        Object.setPrototypeOf(this, OperationError.prototype);\n        // using rootCause.stack ensures that the resulting error will have the original\n        // message + call stack. If that's not an option, we create a new\n        // stack... which is better than nothing, but it will look like\n        // OperationError is the source of the error\n        this.stack = getWithDefault(rootCause, \"stack\", new Error().stack);\n    }\n}\n//# sourceMappingURL=OperationError.js.map","import OperationError from \"../OperationError\";\n/**\n * Returns a function that orchestrates a pipeline of smaller functions.\n * See [Composing Workflows](../../../guides/composing-workflows) for more information.\n *\n * All the functions must adhere to the `PipelineFn<T>` signature:\n *\n * `(value: IPipeable<T>) => Promise<IPipeable<T>>`\n *\n * Given an array of OperationPipeFns, run them in sequence and return the resultant promise\n *\n * i.e. `createOperationPipeline([fn1, fn2, f3])` will return in a function that chains\n * the functions like this: `fn1(input).then(fn2).then(fn3).then(result)`\n *\n * @param fns functions to be run in sequence\n * @returns Promise<Pipable<T>>\n */\nexport const createOperationPipeline = (fns) => (input) => {\n    return fns.reduce((chain, func) => {\n        return chain.then(func).catch((err) => {\n            // if it's an OperationError we can just reject with it...\n            if (err.name === \"OperationError\") {\n                return Promise.reject(err);\n            }\n            else {\n                // otherwise, create an OperationError and reject with that\n                const msg = `IPipeableFn did not reject with an OperationError \\n Operation Stack: \\n ${input.stack.toString()}`;\n                const opErr = new OperationError(\"pipeline execution error\", msg);\n                opErr.operationStack = input.stack.serialize();\n                return Promise.reject(opErr);\n            }\n        });\n    }, Promise.resolve(input));\n};\n//# sourceMappingURL=create-operation-pipeline.js.map","/**\n * Map over an array returning the specified property for each entry\n * @param {String} prop Property to extracct\n * @param {Array} arr array of objects\n */\nexport function mapBy(prop, arr = []) {\n    return arr.map((e) => e[prop]);\n}\n//# sourceMappingURL=map-by.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nexport function fetchToken(url, requestOptions) {\n    var options = requestOptions;\n    // we generate a response, so we can't return the raw response\n    options.rawResponse = false;\n    return request(url, options).then(function (response) {\n        var r = {\n            token: response.access_token,\n            username: response.username,\n            expires: new Date(\n            // convert seconds in response to milliseconds and add the value to the current time to calculate a static expiration timestamp\n            Date.now() + (response.expires_in * 1000 - 1000)),\n            ssl: response.ssl === true\n        };\n        if (response.refresh_token) {\n            r.refreshToken = response.refresh_token;\n        }\n        return r;\n    });\n}\n//# sourceMappingURL=fetch-token.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, NODEJS_DEFAULT_REFERER_HEADER, } from \"@esri/arcgis-rest-request\";\nexport function generateToken(url, requestOptions) {\n    var options = requestOptions;\n    /* istanbul ignore else */\n    if (typeof window !== \"undefined\" &&\n        window.location &&\n        window.location.host) {\n        options.params.referer = window.location.host;\n    }\n    else {\n        options.params.referer = NODEJS_DEFAULT_REFERER_HEADER;\n    }\n    return request(url, options);\n}\n//# sourceMappingURL=generate-token.js.map","import { cleanUrl } from \"@esri/arcgis-rest-request\";\n/**\n * Used to test if a URL is an ArcGIS Online URL\n */\nvar arcgisOnlineUrlRegex = /^https?:\\/\\/(\\S+)\\.arcgis\\.com.+/;\n/**\n * Used to test if a URL is production ArcGIS Online Portal\n */\nvar arcgisOnlinePortalRegex = /^https?:\\/\\/(dev|devext|qa|qaext|www)\\.arcgis\\.com\\/sharing\\/rest+/;\n/**\n * Used to test if a URL is an ArcGIS Online Organization Portal\n */\nvar arcgisOnlineOrgPortalRegex = /^https?:\\/\\/(?:[a-z0-9-]+\\.maps(dev|devext|qa|qaext)?)?.arcgis\\.com\\/sharing\\/rest/;\nexport function isOnline(url) {\n    return arcgisOnlineUrlRegex.test(url);\n}\nexport function normalizeOnlinePortalUrl(portalUrl) {\n    if (!arcgisOnlineUrlRegex.test(portalUrl)) {\n        return portalUrl;\n    }\n    switch (getOnlineEnvironment(portalUrl)) {\n        case \"dev\":\n            return \"https://devext.arcgis.com/sharing/rest\";\n        case \"qa\":\n            return \"https://qaext.arcgis.com/sharing/rest\";\n        default:\n            return \"https://www.arcgis.com/sharing/rest\";\n    }\n}\nexport function getOnlineEnvironment(url) {\n    if (!arcgisOnlineUrlRegex.test(url)) {\n        return null;\n    }\n    var match = url.match(arcgisOnlineUrlRegex);\n    var subdomain = match[1].split(\".\").pop();\n    if (subdomain.includes(\"dev\")) {\n        return \"dev\";\n    }\n    if (subdomain.includes(\"qa\")) {\n        return \"qa\";\n    }\n    return \"production\";\n}\nexport function isFederated(owningSystemUrl, portalUrl) {\n    var normalizedPortalUrl = cleanUrl(normalizeOnlinePortalUrl(portalUrl)).replace(/https?:\\/\\//, \"\");\n    var normalizedOwningSystemUrl = cleanUrl(owningSystemUrl).replace(/https?:\\/\\//, \"\");\n    return new RegExp(normalizedOwningSystemUrl, \"i\").test(normalizedPortalUrl);\n}\nexport function canUseOnlineToken(portalUrl, requestUrl) {\n    var portalIsOnline = isOnline(portalUrl);\n    var requestIsOnline = isOnline(requestUrl);\n    var portalEnv = getOnlineEnvironment(portalUrl);\n    var requestEnv = getOnlineEnvironment(requestUrl);\n    if (portalIsOnline && requestIsOnline && portalEnv === requestEnv) {\n        return true;\n    }\n    return false;\n}\n//# sourceMappingURL=federation-utils.js.map","/* Copyright (c) 2018-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\n/**\n * Validates that the user has access to the application\n * and if they user should be presented a \"View Only\" mode\n *\n * This is only needed/valid for Esri applications that are \"licensed\"\n * and shipped in ArcGIS Online or ArcGIS Enterprise. Most custom applications\n * should not need or use this.\n *\n * ```js\n * import { validateAppAccess } from '@esri/arcgis-rest-auth';\n *\n * return validateAppAccess('your-token', 'theClientId')\n * .then((result) => {\n *    if (!result.value) {\n *      // redirect or show some other ui\n *    } else {\n *      if (result.viewOnlyUserTypeApp) {\n *        // use this to inform your app to show a \"View Only\" mode\n *      }\n *    }\n * })\n * .catch((err) => {\n *  // two possible errors\n *  // invalid clientId: {\"error\":{\"code\":400,\"messageCode\":\"GWM_0007\",\"message\":\"Invalid request\",\"details\":[]}}\n *  // invalid token: {\"error\":{\"code\":498,\"message\":\"Invalid token.\",\"details\":[]}}\n * })\n * ```\n *\n * Note: This is only usable by Esri applications hosted on *arcgis.com, *esri.com or within\n * an ArcGIS Enterprise installation. Custom applications can not use this.\n *\n * @param token platform token\n * @param clientId application client id\n * @param portal Optional\n */\nexport function validateAppAccess(token, clientId, portal) {\n    if (portal === void 0) { portal = \"https://www.arcgis.com/sharing/rest\"; }\n    var url = portal + \"/oauth2/validateAppAccess\";\n    var ro = {\n        method: \"POST\",\n        params: {\n            f: \"json\",\n            client_id: clientId,\n            token: token,\n        },\n    };\n    return request(url, ro);\n}\n//# sourceMappingURL=validate-app-access.js.map","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, ArcGISAuthError, cleanUrl, encodeQueryString, decodeQueryString, } from \"@esri/arcgis-rest-request\";\nimport { generateToken } from \"./generate-token\";\nimport { fetchToken } from \"./fetch-token\";\nimport { canUseOnlineToken, isFederated } from \"./federation-utils\";\nimport { validateAppAccess } from \"./validate-app-access\";\nfunction defer() {\n    var deferred = {\n        promise: null,\n        resolve: null,\n        reject: null,\n    };\n    deferred.promise = new Promise(function (resolve, reject) {\n        deferred.resolve = resolve;\n        deferred.reject = reject;\n    });\n    return deferred;\n}\n/**\n * ```js\n * import { UserSession } from '@esri/arcgis-rest-auth';\n * UserSession.beginOAuth2({\n *   // register an app of your own to create a unique clientId\n *   clientId: \"abc123\",\n *   redirectUri: 'https://yourapp.com/authenticate.html'\n * })\n *   .then(session)\n * // or\n * new UserSession({\n *   username: \"jsmith\",\n *   password: \"123456\"\n * })\n * // or\n * UserSession.deserialize(cache)\n * ```\n * Used to authenticate both ArcGIS Online and ArcGIS Enterprise users. `UserSession` includes helper methods for [OAuth 2.0](/arcgis-rest-js/guides/browser-authentication/) in both browser and server applications.\n */\nvar UserSession = /** @class */ (function () {\n    function UserSession(options) {\n        this.clientId = options.clientId;\n        this._refreshToken = options.refreshToken;\n        this._refreshTokenExpires = options.refreshTokenExpires;\n        this.username = options.username;\n        this.password = options.password;\n        this._token = options.token;\n        this._tokenExpires = options.tokenExpires;\n        this.portal = options.portal\n            ? cleanUrl(options.portal)\n            : \"https://www.arcgis.com/sharing/rest\";\n        this.ssl = options.ssl;\n        this.provider = options.provider || \"arcgis\";\n        this.tokenDuration = options.tokenDuration || 20160;\n        this.redirectUri = options.redirectUri;\n        this.refreshTokenTTL = options.refreshTokenTTL || 20160;\n        this.server = options.server;\n        this.federatedServers = {};\n        this.trustedDomains = [];\n        // if a non-federated server was passed explicitly, it should be trusted.\n        if (options.server) {\n            // if the url includes more than '/arcgis/', trim the rest\n            var root = this.getServerRootUrl(options.server);\n            this.federatedServers[root] = {\n                token: options.token,\n                expires: options.tokenExpires,\n            };\n        }\n        this._pendingTokenRequests = {};\n    }\n    Object.defineProperty(UserSession.prototype, \"token\", {\n        /**\n         * The current ArcGIS Online or ArcGIS Enterprise `token`.\n         */\n        get: function () {\n            return this._token;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(UserSession.prototype, \"tokenExpires\", {\n        /**\n         * The expiration time of the current `token`.\n         */\n        get: function () {\n            return this._tokenExpires;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(UserSession.prototype, \"refreshToken\", {\n        /**\n         * The current token to ArcGIS Online or ArcGIS Enterprise.\n         */\n        get: function () {\n            return this._refreshToken;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(UserSession.prototype, \"refreshTokenExpires\", {\n        /**\n         * The expiration time of the current `refreshToken`.\n         */\n        get: function () {\n            return this._refreshTokenExpires;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(UserSession.prototype, \"trustedServers\", {\n        /**\n         * Deprecated, use `federatedServers` instead.\n         *\n         * @deprecated\n         */\n        get: function () {\n            console.log(\"DEPRECATED: use federatedServers instead\");\n            return this.federatedServers;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Begins a new browser-based OAuth 2.0 sign in. If `options.popup` is `true` the\n     * authentication window will open in a new tab/window and the function will return\n     * Promise&lt;UserSession&gt;. Otherwise, the user will be redirected to the\n     * authorization page in their current tab/window and the function will return `undefined`.\n     *\n     * @browserOnly\n     */\n    /* istanbul ignore next */\n    UserSession.beginOAuth2 = function (options, win) {\n        if (win === void 0) { win = window; }\n        if (options.duration) {\n            console.log(\"DEPRECATED: 'duration' is deprecated - use 'expiration' instead\");\n        }\n        var _a = __assign({\n            portal: \"https://www.arcgis.com/sharing/rest\",\n            provider: \"arcgis\",\n            expiration: 20160,\n            popup: true,\n            popupWindowFeatures: \"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes\",\n            state: options.clientId,\n            locale: \"\",\n        }, options), portal = _a.portal, provider = _a.provider, clientId = _a.clientId, expiration = _a.expiration, redirectUri = _a.redirectUri, popup = _a.popup, popupWindowFeatures = _a.popupWindowFeatures, state = _a.state, locale = _a.locale, params = _a.params;\n        var url;\n        if (provider === \"arcgis\") {\n            url = portal + \"/oauth2/authorize?client_id=\" + clientId + \"&response_type=token&expiration=\" + (options.duration || expiration) + \"&redirect_uri=\" + encodeURIComponent(redirectUri) + \"&state=\" + state + \"&locale=\" + locale;\n        }\n        else {\n            url = portal + \"/oauth2/social/authorize?client_id=\" + clientId + \"&socialLoginProviderName=\" + provider + \"&autoAccountCreateForSocial=true&response_type=token&expiration=\" + (options.duration || expiration) + \"&redirect_uri=\" + encodeURIComponent(redirectUri) + \"&state=\" + state + \"&locale=\" + locale;\n        }\n        // append additional params\n        if (params) {\n            url = url + \"&\" + encodeQueryString(params);\n        }\n        if (!popup) {\n            win.location.href = url;\n            return undefined;\n        }\n        var session = defer();\n        win[\"__ESRI_REST_AUTH_HANDLER_\" + clientId] = function (errorString, oauthInfoString) {\n            if (errorString) {\n                var error = JSON.parse(errorString);\n                session.reject(new ArcGISAuthError(error.errorMessage, error.error));\n                return;\n            }\n            if (oauthInfoString) {\n                var oauthInfo = JSON.parse(oauthInfoString);\n                session.resolve(new UserSession({\n                    clientId: clientId,\n                    portal: portal,\n                    ssl: oauthInfo.ssl,\n                    token: oauthInfo.token,\n                    tokenExpires: new Date(oauthInfo.expires),\n                    username: oauthInfo.username,\n                }));\n            }\n        };\n        win.open(url, \"oauth-window\", popupWindowFeatures);\n        return session.promise;\n    };\n    /**\n     * Completes a browser-based OAuth 2.0 sign in. If `options.popup` is `true` the user\n     * will be returned to the previous window. Otherwise a new `UserSession`\n     * will be returned. You must pass the same values for `options.popup` and\n     * `options.portal` as you used in `beginOAuth2()`.\n     *\n     * @browserOnly\n     */\n    /* istanbul ignore next */\n    UserSession.completeOAuth2 = function (options, win) {\n        if (win === void 0) { win = window; }\n        var _a = __assign({ portal: \"https://www.arcgis.com/sharing/rest\", popup: true }, options), portal = _a.portal, clientId = _a.clientId, popup = _a.popup;\n        function completeSignIn(error, oauthInfo) {\n            try {\n                var handlerFn = void 0;\n                var handlerFnName = \"__ESRI_REST_AUTH_HANDLER_\" + clientId;\n                if (popup) {\n                    // Guard b/c IE does not support window.opener\n                    if (win.opener) {\n                        if (win.opener.parent && win.opener.parent[handlerFnName]) {\n                            handlerFn = win.opener.parent[handlerFnName];\n                        }\n                        else if (win.opener && win.opener[handlerFnName]) {\n                            // support pop-out oauth from within an iframe\n                            handlerFn = win.opener[handlerFnName];\n                        }\n                    }\n                    else {\n                        // IE\n                        if (win !== win.parent && win.parent && win.parent[handlerFnName]) {\n                            handlerFn = win.parent[handlerFnName];\n                        }\n                    }\n                    // if we have a handler fn, call it and close the window\n                    if (handlerFn) {\n                        handlerFn(error ? JSON.stringify(error) : undefined, JSON.stringify(oauthInfo));\n                        win.close();\n                        return undefined;\n                    }\n                }\n            }\n            catch (e) {\n                throw new ArcGISAuthError(\"Unable to complete authentication. It's possible you specified popup based oAuth2 but no handler from \\\"beginOAuth2()\\\" present. This generally happens because the \\\"popup\\\" option differs between \\\"beginOAuth2()\\\" and \\\"completeOAuth2()\\\".\");\n            }\n            if (error) {\n                throw new ArcGISAuthError(error.errorMessage, error.error);\n            }\n            return new UserSession({\n                clientId: clientId,\n                portal: portal,\n                ssl: oauthInfo.ssl,\n                token: oauthInfo.token,\n                tokenExpires: oauthInfo.expires,\n                username: oauthInfo.username,\n            });\n        }\n        var params = decodeQueryString(win.location.hash);\n        if (!params.access_token) {\n            var error = void 0;\n            var errorMessage = \"Unknown error\";\n            if (params.error) {\n                error = params.error;\n                errorMessage = params.error_description;\n            }\n            return completeSignIn({ error: error, errorMessage: errorMessage });\n        }\n        var token = params.access_token;\n        var expires = new Date(Date.now() + parseInt(params.expires_in, 10) * 1000 - 60 * 1000);\n        var username = params.username;\n        var ssl = params.ssl === \"true\";\n        return completeSignIn(undefined, {\n            token: token,\n            expires: expires,\n            ssl: ssl,\n            username: username,\n        });\n    };\n    /**\n     * Request session information from the parent application\n     *\n     * When an application is embedded into another application via an IFrame, the embedded app can\n     * use `window.postMessage` to request credentials from the host application. This function wraps\n     * that behavior.\n     *\n     * The ArcGIS API for Javascript has this built into the Identity Manager as of the 4.19 release.\n     *\n     * Note: The parent application will not respond if the embedded app's origin is not:\n     * - the same origin as the parent or *.arcgis.com (JSAPI)\n     * - in the list of valid child origins (REST-JS)\n     *\n     *\n     * @param parentOrigin origin of the parent frame. Passed into the embedded application as `parentOrigin` query param\n     * @browserOnly\n     */\n    UserSession.fromParent = function (parentOrigin, win) {\n        /* istanbul ignore next: must pass in a mockwindow for tests so we can't cover the other branch */\n        if (!win && window) {\n            win = window;\n        }\n        // Declare handler outside of promise scope so we can detach it\n        var handler;\n        // return a promise that will resolve when the handler receives\n        // session information from the correct origin\n        return new Promise(function (resolve, reject) {\n            // create an event handler that just wraps the parentMessageHandler\n            handler = function (event) {\n                // ensure we only listen to events from the parent\n                if (event.source === win.parent && event.data) {\n                    try {\n                        return resolve(UserSession.parentMessageHandler(event));\n                    }\n                    catch (err) {\n                        return reject(err);\n                    }\n                }\n            };\n            // add listener\n            win.addEventListener(\"message\", handler, false);\n            win.parent.postMessage({ type: \"arcgis:auth:requestCredential\" }, parentOrigin);\n        }).then(function (session) {\n            win.removeEventListener(\"message\", handler, false);\n            return session;\n        });\n    };\n    /**\n     * Begins a new server-based OAuth 2.0 sign in. This will redirect the user to\n     * the ArcGIS Online or ArcGIS Enterprise authorization page.\n     *\n     * @nodeOnly\n     */\n    UserSession.authorize = function (options, response) {\n        if (options.duration) {\n            console.log(\"DEPRECATED: 'duration' is deprecated - use 'expiration' instead\");\n        }\n        var _a = __assign({ portal: \"https://arcgis.com/sharing/rest\", expiration: 20160 }, options), portal = _a.portal, clientId = _a.clientId, expiration = _a.expiration, redirectUri = _a.redirectUri;\n        response.writeHead(301, {\n            Location: portal + \"/oauth2/authorize?client_id=\" + clientId + \"&expiration=\" + (options.duration || expiration) + \"&response_type=code&redirect_uri=\" + encodeURIComponent(redirectUri),\n        });\n        response.end();\n    };\n    /**\n     * Completes the server-based OAuth 2.0 sign in process by exchanging the `authorizationCode`\n     * for a `access_token`.\n     *\n     * @nodeOnly\n     */\n    UserSession.exchangeAuthorizationCode = function (options, authorizationCode) {\n        var _a = __assign({\n            portal: \"https://www.arcgis.com/sharing/rest\",\n            refreshTokenTTL: 20160,\n        }, options), portal = _a.portal, clientId = _a.clientId, redirectUri = _a.redirectUri, refreshTokenTTL = _a.refreshTokenTTL;\n        return fetchToken(portal + \"/oauth2/token\", {\n            params: {\n                grant_type: \"authorization_code\",\n                client_id: clientId,\n                redirect_uri: redirectUri,\n                code: authorizationCode,\n            },\n        }).then(function (response) {\n            return new UserSession({\n                clientId: clientId,\n                portal: portal,\n                ssl: response.ssl,\n                redirectUri: redirectUri,\n                refreshToken: response.refreshToken,\n                refreshTokenTTL: refreshTokenTTL,\n                refreshTokenExpires: new Date(Date.now() + (refreshTokenTTL - 1) * 60 * 1000),\n                token: response.token,\n                tokenExpires: response.expires,\n                username: response.username,\n            });\n        });\n    };\n    UserSession.deserialize = function (str) {\n        var options = JSON.parse(str);\n        return new UserSession({\n            clientId: options.clientId,\n            refreshToken: options.refreshToken,\n            refreshTokenExpires: new Date(options.refreshTokenExpires),\n            username: options.username,\n            password: options.password,\n            token: options.token,\n            tokenExpires: new Date(options.tokenExpires),\n            portal: options.portal,\n            ssl: options.ssl,\n            tokenDuration: options.tokenDuration,\n            redirectUri: options.redirectUri,\n            refreshTokenTTL: options.refreshTokenTTL,\n        });\n    };\n    /**\n     * Translates authentication from the format used in the [ArcGIS API for JavaScript](https://developers.arcgis.com/javascript/).\n     *\n     * ```js\n     * UserSession.fromCredential({\n     *   userId: \"jsmith\",\n     *   token: \"secret\"\n     * });\n     * ```\n     *\n     * @returns UserSession\n     */\n    UserSession.fromCredential = function (credential) {\n        // At ArcGIS Online 9.1, credentials no longer include the ssl and expires properties\n        // Here, we provide default values for them to cover this condition\n        var ssl = typeof credential.ssl !== \"undefined\" ? credential.ssl : true;\n        var expires = credential.expires || Date.now() + 7200000; /* 2 hours */\n        return new UserSession({\n            portal: credential.server.includes(\"sharing/rest\")\n                ? credential.server\n                : credential.server + \"/sharing/rest\",\n            ssl: ssl,\n            token: credential.token,\n            username: credential.userId,\n            tokenExpires: new Date(expires),\n        });\n    };\n    /**\n     * Handle the response from the parent\n     * @param event DOM Event\n     */\n    UserSession.parentMessageHandler = function (event) {\n        if (event.data.type === \"arcgis:auth:credential\") {\n            return UserSession.fromCredential(event.data.credential);\n        }\n        if (event.data.type === \"arcgis:auth:error\") {\n            var err = new Error(event.data.error.message);\n            err.name = event.data.error.name;\n            throw err;\n        }\n        else {\n            throw new Error(\"Unknown message type.\");\n        }\n    };\n    /**\n     * Returns authentication in a format useable in the [ArcGIS API for JavaScript](https://developers.arcgis.com/javascript/).\n     *\n     * ```js\n     * esriId.registerToken(session.toCredential());\n     * ```\n     *\n     * @returns ICredential\n     */\n    UserSession.prototype.toCredential = function () {\n        return {\n            expires: this.tokenExpires.getTime(),\n            server: this.portal,\n            ssl: this.ssl,\n            token: this.token,\n            userId: this.username,\n        };\n    };\n    /**\n     * Returns information about the currently logged in [user](https://developers.arcgis.com/rest/users-groups-and-items/user.htm). Subsequent calls will *not* result in additional web traffic.\n     *\n     * ```js\n     * session.getUser()\n     *   .then(response => {\n     *     console.log(response.role); // \"org_admin\"\n     *   })\n     * ```\n     *\n     * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n     * @returns A Promise that will resolve with the data from the response.\n     */\n    UserSession.prototype.getUser = function (requestOptions) {\n        var _this = this;\n        if (this._pendingUserRequest) {\n            return this._pendingUserRequest;\n        }\n        else if (this._user) {\n            return Promise.resolve(this._user);\n        }\n        else {\n            var url = this.portal + \"/community/self\";\n            var options = __assign(__assign({ httpMethod: \"GET\", authentication: this }, requestOptions), { rawResponse: false });\n            this._pendingUserRequest = request(url, options).then(function (response) {\n                _this._user = response;\n                _this._pendingUserRequest = null;\n                return response;\n            });\n            return this._pendingUserRequest;\n        }\n    };\n    /**\n     * Returns information about the currently logged in user's [portal](https://developers.arcgis.com/rest/users-groups-and-items/portal-self.htm). Subsequent calls will *not* result in additional web traffic.\n     *\n     * ```js\n     * session.getPortal()\n     *   .then(response => {\n     *     console.log(portal.name); // \"City of ...\"\n     *   })\n     * ```\n     *\n     * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n     * @returns A Promise that will resolve with the data from the response.\n     */\n    UserSession.prototype.getPortal = function (requestOptions) {\n        var _this = this;\n        if (this._pendingPortalRequest) {\n            return this._pendingPortalRequest;\n        }\n        else if (this._portalInfo) {\n            return Promise.resolve(this._portalInfo);\n        }\n        else {\n            var url = this.portal + \"/portals/self\";\n            var options = __assign(__assign({ httpMethod: \"GET\", authentication: this }, requestOptions), { rawResponse: false });\n            this._pendingPortalRequest = request(url, options).then(function (response) {\n                _this._portalInfo = response;\n                _this._pendingPortalRequest = null;\n                return response;\n            });\n            return this._pendingPortalRequest;\n        }\n    };\n    /**\n     * Returns the username for the currently logged in [user](https://developers.arcgis.com/rest/users-groups-and-items/user.htm). Subsequent calls will *not* result in additional web traffic. This is also used internally when a username is required for some requests but is not present in the options.\n     *\n     *    * ```js\n     * session.getUsername()\n     *   .then(response => {\n     *     console.log(response); // \"casey_jones\"\n     *   })\n     * ```\n     */\n    UserSession.prototype.getUsername = function () {\n        if (this.username) {\n            return Promise.resolve(this.username);\n        }\n        else if (this._user) {\n            return Promise.resolve(this._user.username);\n        }\n        else {\n            return this.getUser().then(function (user) {\n                return user.username;\n            });\n        }\n    };\n    /**\n     * Gets an appropriate token for the given URL. If `portal` is ArcGIS Online and\n     * the request is to an ArcGIS Online domain `token` will be used. If the request\n     * is to the current `portal` the current `token` will also be used. However if\n     * the request is to an unknown server we will validate the server with a request\n     * to our current `portal`.\n     */\n    UserSession.prototype.getToken = function (url, requestOptions) {\n        if (canUseOnlineToken(this.portal, url)) {\n            return this.getFreshToken(requestOptions);\n        }\n        else if (new RegExp(this.portal, \"i\").test(url)) {\n            return this.getFreshToken(requestOptions);\n        }\n        else {\n            return this.getTokenForServer(url, requestOptions);\n        }\n    };\n    /**\n     * Get application access information for the current user\n     * see `validateAppAccess` function for details\n     *\n     * @param clientId application client id\n     */\n    UserSession.prototype.validateAppAccess = function (clientId) {\n        return this.getToken(this.portal).then(function (token) {\n            return validateAppAccess(token, clientId);\n        });\n    };\n    UserSession.prototype.toJSON = function () {\n        return {\n            clientId: this.clientId,\n            refreshToken: this.refreshToken,\n            refreshTokenExpires: this.refreshTokenExpires,\n            username: this.username,\n            password: this.password,\n            token: this.token,\n            tokenExpires: this.tokenExpires,\n            portal: this.portal,\n            ssl: this.ssl,\n            tokenDuration: this.tokenDuration,\n            redirectUri: this.redirectUri,\n            refreshTokenTTL: this.refreshTokenTTL,\n        };\n    };\n    UserSession.prototype.serialize = function () {\n        return JSON.stringify(this);\n    };\n    /**\n     * For a \"Host\" app that embeds other platform apps via iframes, after authenticating the user\n     * and creating a UserSession, the app can then enable \"post message\" style authentication by calling\n     * this method.\n     *\n     * Internally this adds an event listener on window for the `message` event\n     *\n     * @param validChildOrigins Array of origins that are allowed to request authentication from the host app\n     */\n    UserSession.prototype.enablePostMessageAuth = function (validChildOrigins, win) {\n        /* istanbul ignore next: must pass in a mockwindow for tests so we can't cover the other branch */\n        if (!win && window) {\n            win = window;\n        }\n        this._hostHandler = this.createPostMessageHandler(validChildOrigins);\n        win.addEventListener(\"message\", this._hostHandler, false);\n    };\n    /**\n     * For a \"Host\" app that has embedded other platform apps via iframes, when the host needs\n     * to transition routes, it should call `UserSession.disablePostMessageAuth()` to remove\n     * the event listener and prevent memory leaks\n     */\n    UserSession.prototype.disablePostMessageAuth = function (win) {\n        /* istanbul ignore next: must pass in a mockwindow for tests so we can't cover the other branch */\n        if (!win && window) {\n            win = window;\n        }\n        win.removeEventListener(\"message\", this._hostHandler, false);\n    };\n    /**\n     * Manually refreshes the current `token` and `tokenExpires`.\n     */\n    UserSession.prototype.refreshSession = function (requestOptions) {\n        // make sure subsequent calls to getUser() don't returned cached metadata\n        this._user = null;\n        if (this.username && this.password) {\n            return this.refreshWithUsernameAndPassword(requestOptions);\n        }\n        if (this.clientId && this.refreshToken) {\n            return this.refreshWithRefreshToken();\n        }\n        return Promise.reject(new ArcGISAuthError(\"Unable to refresh token.\"));\n    };\n    /**\n     * Determines the root of the ArcGIS Server or Portal for a given URL.\n     *\n     * @param url the URl to determine the root url for.\n     */\n    UserSession.prototype.getServerRootUrl = function (url) {\n        var root = cleanUrl(url).split(/\\/rest(\\/admin)?\\/services(?:\\/|#|\\?|$)/)[0];\n        var _a = root.match(/(https?:\\/\\/)(.+)/), match = _a[0], protocol = _a[1], domainAndPath = _a[2];\n        var _b = domainAndPath.split(\"/\"), domain = _b[0], path = _b.slice(1);\n        // only the domain is lowercased because in some cases an org id might be\n        // in the path which cannot be lowercased.\n        return \"\" + protocol + domain.toLowerCase() + \"/\" + path.join(\"/\");\n    };\n    /**\n     * Returns the proper [`credentials`] option for `fetch` for a given domain.\n     * See [trusted server](https://enterprise.arcgis.com/en/portal/latest/administer/windows/configure-security.htm#ESRI_SECTION1_70CC159B3540440AB325BE5D89DBE94A).\n     * Used internally by underlying request methods to add support for specific security considerations.\n     *\n     * @param url The url of the request\n     * @returns \"include\" or \"same-origin\"\n     */\n    UserSession.prototype.getDomainCredentials = function (url) {\n        if (!this.trustedDomains || !this.trustedDomains.length) {\n            return \"same-origin\";\n        }\n        return this.trustedDomains.some(function (domainWithProtocol) {\n            return url.startsWith(domainWithProtocol);\n        })\n            ? \"include\"\n            : \"same-origin\";\n    };\n    /**\n     * Return a function that closes over the validOrigins array and\n     * can be used as an event handler for the `message` event\n     *\n     * @param validOrigins Array of valid origins\n     */\n    UserSession.prototype.createPostMessageHandler = function (validOrigins) {\n        var _this = this;\n        // return a function that closes over the validOrigins and\n        // has access to the credential\n        return function (event) {\n            // Verify that the origin is valid\n            // Note: do not use regex's here. validOrigins is an array so we're checking that the event's origin\n            // is in the array via exact match. More info about avoiding postMessage xss issues here\n            // https://jlajara.gitlab.io/web/2020/07/17/Dom_XSS_PostMessage_2.html#tipsbypasses-in-postmessage-vulnerabilities\n            var isValidOrigin = validOrigins.indexOf(event.origin) > -1;\n            // JSAPI handles this slightly differently - instead of checking a list, it will respond if\n            // event.origin === window.location.origin || event.origin.endsWith('.arcgis.com')\n            // For Hub, and to enable cross domain debugging with port's in urls, we are opting to\n            // use a list of valid origins\n            // Ensure the message type is something we want to handle\n            var isValidType = event.data.type === \"arcgis:auth:requestCredential\";\n            var isTokenValid = _this.tokenExpires.getTime() > Date.now();\n            if (isValidOrigin && isValidType) {\n                var msg = {};\n                if (isTokenValid) {\n                    var credential = _this.toCredential();\n                    // arcgis:auth:error with {name: \"\", message: \"\"}\n                    // the following line allows us to conform to our spec without changing other depended-on functionality\n                    // https://github.com/Esri/arcgis-rest-js/blob/master/packages/arcgis-rest-auth/post-message-auth-spec.md#arcgisauthcredential\n                    credential.server = credential.server.replace(\"/sharing/rest\", \"\");\n                    msg = { type: \"arcgis:auth:credential\", credential: credential };\n                }\n                else {\n                    // Return an error\n                    msg = {\n                        type: \"arcgis:auth:error\",\n                        error: {\n                            name: \"tokenExpiredError\",\n                            message: \"Session token was expired, and not returned to the child application\",\n                        },\n                    };\n                }\n                event.source.postMessage(msg, event.origin);\n            }\n        };\n    };\n    /**\n     * Validates that a given URL is properly federated with our current `portal`.\n     * Attempts to use the internal `federatedServers` cache first.\n     */\n    UserSession.prototype.getTokenForServer = function (url, requestOptions) {\n        var _this = this;\n        // requests to /rest/services/ and /rest/admin/services/ are both valid\n        // Federated servers may have inconsistent casing, so lowerCase it\n        var root = this.getServerRootUrl(url);\n        var existingToken = this.federatedServers[root];\n        if (existingToken &&\n            existingToken.expires &&\n            existingToken.expires.getTime() > Date.now()) {\n            return Promise.resolve(existingToken.token);\n        }\n        if (this._pendingTokenRequests[root]) {\n            return this._pendingTokenRequests[root];\n        }\n        this._pendingTokenRequests[root] = this.fetchAuthorizedDomains().then(function () {\n            return request(root + \"/rest/info\", {\n                credentials: _this.getDomainCredentials(url),\n            })\n                .then(function (response) {\n                if (response.owningSystemUrl) {\n                    /**\n                     * if this server is not owned by this portal\n                     * bail out with an error since we know we wont\n                     * be able to generate a token\n                     */\n                    if (!isFederated(response.owningSystemUrl, _this.portal)) {\n                        throw new ArcGISAuthError(url + \" is not federated with \" + _this.portal + \".\", \"NOT_FEDERATED\");\n                    }\n                    else {\n                        /**\n                         * if the server is federated, use the relevant token endpoint.\n                         */\n                        return request(response.owningSystemUrl + \"/sharing/rest/info\", requestOptions);\n                    }\n                }\n                else if (response.authInfo &&\n                    _this.federatedServers[root] !== undefined) {\n                    /**\n                     * if its a stand-alone instance of ArcGIS Server that doesn't advertise\n                     * federation, but the root server url is recognized, use its built in token endpoint.\n                     */\n                    return Promise.resolve({\n                        authInfo: response.authInfo,\n                    });\n                }\n                else {\n                    throw new ArcGISAuthError(url + \" is not federated with any portal and is not explicitly trusted.\", \"NOT_FEDERATED\");\n                }\n            })\n                .then(function (response) {\n                return response.authInfo.tokenServicesUrl;\n            })\n                .then(function (tokenServicesUrl) {\n                // an expired token cant be used to generate a new token\n                if (_this.token && _this.tokenExpires.getTime() > Date.now()) {\n                    return generateToken(tokenServicesUrl, {\n                        params: {\n                            token: _this.token,\n                            serverUrl: url,\n                            expiration: _this.tokenDuration,\n                            client: \"referer\",\n                        },\n                    });\n                    // generate an entirely fresh token if necessary\n                }\n                else {\n                    return generateToken(tokenServicesUrl, {\n                        params: {\n                            username: _this.username,\n                            password: _this.password,\n                            expiration: _this.tokenDuration,\n                            client: \"referer\",\n                        },\n                    }).then(function (response) {\n                        _this._token = response.token;\n                        _this._tokenExpires = new Date(response.expires);\n                        return response;\n                    });\n                }\n            })\n                .then(function (response) {\n                _this.federatedServers[root] = {\n                    expires: new Date(response.expires),\n                    token: response.token,\n                };\n                delete _this._pendingTokenRequests[root];\n                return response.token;\n            });\n        });\n        return this._pendingTokenRequests[root];\n    };\n    /**\n     * Returns an unexpired token for the current `portal`.\n     */\n    UserSession.prototype.getFreshToken = function (requestOptions) {\n        var _this = this;\n        if (this.token && !this.tokenExpires) {\n            return Promise.resolve(this.token);\n        }\n        if (this.token &&\n            this.tokenExpires &&\n            this.tokenExpires.getTime() > Date.now()) {\n            return Promise.resolve(this.token);\n        }\n        if (!this._pendingTokenRequests[this.portal]) {\n            this._pendingTokenRequests[this.portal] = this.refreshSession(requestOptions).then(function (session) {\n                _this._pendingTokenRequests[_this.portal] = null;\n                return session.token;\n            });\n        }\n        return this._pendingTokenRequests[this.portal];\n    };\n    /**\n     * Refreshes the current `token` and `tokenExpires` with `username` and\n     * `password`.\n     */\n    UserSession.prototype.refreshWithUsernameAndPassword = function (requestOptions) {\n        var _this = this;\n        var options = __assign({ params: {\n                username: this.username,\n                password: this.password,\n                expiration: this.tokenDuration,\n            } }, requestOptions);\n        return generateToken(this.portal + \"/generateToken\", options).then(function (response) {\n            _this._token = response.token;\n            _this._tokenExpires = new Date(response.expires);\n            return _this;\n        });\n    };\n    /**\n     * Refreshes the current `token` and `tokenExpires` with `refreshToken`.\n     */\n    UserSession.prototype.refreshWithRefreshToken = function (requestOptions) {\n        var _this = this;\n        if (this.refreshToken &&\n            this.refreshTokenExpires &&\n            this.refreshTokenExpires.getTime() < Date.now()) {\n            return this.refreshRefreshToken(requestOptions);\n        }\n        var options = __assign({ params: {\n                client_id: this.clientId,\n                refresh_token: this.refreshToken,\n                grant_type: \"refresh_token\",\n            } }, requestOptions);\n        return fetchToken(this.portal + \"/oauth2/token\", options).then(function (response) {\n            _this._token = response.token;\n            _this._tokenExpires = response.expires;\n            return _this;\n        });\n    };\n    /**\n     * Exchanges an unexpired `refreshToken` for a new one, also updates `token` and\n     * `tokenExpires`.\n     */\n    UserSession.prototype.refreshRefreshToken = function (requestOptions) {\n        var _this = this;\n        var options = __assign({ params: {\n                client_id: this.clientId,\n                refresh_token: this.refreshToken,\n                redirect_uri: this.redirectUri,\n                grant_type: \"exchange_refresh_token\",\n            } }, requestOptions);\n        return fetchToken(this.portal + \"/oauth2/token\", options).then(function (response) {\n            _this._token = response.token;\n            _this._tokenExpires = response.expires;\n            _this._refreshToken = response.refreshToken;\n            _this._refreshTokenExpires = new Date(Date.now() + (_this.refreshTokenTTL - 1) * 60 * 1000);\n            return _this;\n        });\n    };\n    /**\n     * ensures that the authorizedCrossOriginDomains are obtained from the portal and cached\n     * so we can check them later.\n     *\n     * @returns this\n     */\n    UserSession.prototype.fetchAuthorizedDomains = function () {\n        var _this = this;\n        // if this token is for a specific server or we don't have a portal\n        // don't get the portal info because we cant get the authorizedCrossOriginDomains\n        if (this.server || !this.portal) {\n            return Promise.resolve(this);\n        }\n        return this.getPortal().then(function (portalInfo) {\n            /**\n             * Specific domains can be configured as secure.esri.com or https://secure.esri.com this\n             * normalizes to https://secure.esri.com so we can use startsWith later.\n             */\n            if (portalInfo.authorizedCrossOriginDomains &&\n                portalInfo.authorizedCrossOriginDomains.length) {\n                _this.trustedDomains = portalInfo.authorizedCrossOriginDomains\n                    .filter(function (d) { return !d.startsWith(\"http://\"); })\n                    .map(function (d) {\n                    if (d.startsWith(\"https://\")) {\n                        return d;\n                    }\n                    else {\n                        return \"https://\" + d;\n                    }\n                });\n            }\n            return _this;\n        });\n    };\n    return UserSession;\n}());\nexport { UserSession };\n//# sourceMappingURL=UserSession.js.map","/**\n * @private\n */\nexport function buildUrl(params) {\n    const { host, path, query } = params;\n    const baseUrl = host.endsWith(\"/\") ? host : `${host}/`;\n    const url = new URL(path, baseUrl);\n    url.search = buildQueryString(query);\n    return url.toString();\n}\nfunction buildQueryString(params = {}) {\n    const queryParams = Object.keys(params)\n        .filter((key) => {\n        return params[key] !== undefined;\n    })\n        .reduce((acc, key) => {\n        acc[key] = params[key];\n        return acc;\n    }, {});\n    return new URLSearchParams(queryParams).toString();\n}\n//# sourceMappingURL=build-url.js.map","import { getPortalUrl as getPortalApiUrl, } from \"@esri/arcgis-rest-portal\";\n/**\n * ```js\n * import { getPortalUrl } from \"@esri/hub-common\";\n * // from a portal API URL\n * let portalUrl = getPortalUrl(\"https://org.maps.arcgis.com/sharing/rest\"); // https://org.maps.arcgis.com\n * // from an enterprise portal self response (IPortal)\n * let portalSelf = { isPortal: true, portalHostname: \"server.example.org\" };\n * portalUrl = getPortalUrl(portalSelf); // https://server.example.org\n * // from an online portal self response (IPortal)\n * portalSelf = { isPortal: false, urlKey: \"org\", customBaseUrl: \"maps.arcgis.com\" };\n * portalUrl = getPortalUrl(portalSelf); // https://org.maps.arcgis.com\n * // from hub request options (IHubRequestOptions) with a portal self (IPortal)\n * let requestOptions = { isPortal: false, portalSelf };\n * portalUrl = getPortalUrl(requestOptions); // https://org.maps.arcgis.com\n * // from request options (IRequestOptions) with a portal (string)\n * requestOptions = { portal: \"https://org.maps.arcgis.com/sharing/rest\" };\n * portalUrl = getPortalUrl(requestOptions); // https://org.maps.arcgis.com\n * ```\n * Derive a portal's base URL from the portal's API URL, a portal object, or request options\n * @param urlOrObject a portal API URL, a portal object, or request options containing either of those\n * @returns The portal base URL, defaults to `https://www.arcgis.com`\n */\nexport function getPortalUrl(urlOrObject) {\n    if (typeof urlOrObject === \"string\") {\n        // assume this is the URL of the portal API\n        // and strip the `/sharing/rest`\n        return urlOrObject.replace(/\\/sharing\\/rest\\/?$/, \"\");\n    }\n    if (typeof urlOrObject === \"object\") {\n        // build URL from portal self object, which could be\n        // either a property of the object (request options) or the object itself\n        const portalSelf = urlOrObject.portalSelf;\n        const portal = portalSelf || urlOrObject;\n        const { portalHostname, urlKey, customBaseUrl } = portal;\n        if (portalHostname || (urlKey && customBaseUrl)) {\n            // user passed in a portal object, we'll use that to build the URL\n            if (portal.isPortal) {\n                return `https://${portal.portalHostname}`;\n            }\n            else {\n                return `https://${portal.urlKey}.${portal.customBaseUrl}`;\n            }\n        }\n    }\n    // urlOrObj is either undefined, or a request options w/o portal self\n    // get portal API URL and parse portal URL from that\n    return getPortalUrl(getPortalApiUrl(urlOrObject));\n}\n//# sourceMappingURL=get-portal-url.js.map","import { getPortalUrl } from \"./get-portal-url\";\n/**\n * ```js\n * import { getPortalApiUrl } from \"@esri/hub-common\";\n * // from a portal base URL\n * let portalApiUrl = getPortalApiUrl(\"https://org.maps.arcgis.com\"); // https://org.maps.arcgis.com/sharing/rest\n * // from an enterprise portal self response (IPortal)\n * let portalSelf = { isPortal: true, portalHostname: \"server.example.org\" };\n * portalApiUrl = getPortalApiUrl(portalSelf); // https://server.example.org/sharing/rest\n * // from an online portal self response (IPortal)\n * portalSelf = { isPortal: false, urlKey: \"org\", customBaseUrl: \"maps.arcgis.com\" };\n * portalApiUrl = getPortalApiUrl(portalSelf); // https://org.maps.arcgis.com/sharing/rest\n * // from hub request options (IHubRequestOptions) with a portal self (IPortal)\n * let requestOptions = { isPortal: false, portalSelf };\n * portalApiUrl = getPortalApiUrl(requestOptions); // https://org.maps.arcgis.com/sharing/rest\n * // from request options (IRequestOptions) with a portal (string)\n * requestOptions = { portal: \"https://org.maps.arcgis.com/sharing/rest\" };\n * portalApiUrl = getPortalApiUrl(requestOptions); // https://org.maps.arcgis.com/sharing/rest\n * ```\n * Derive a portal's API URL from the portal's base URL, a portal object, or request options\n * @param urlOrObject a portal base URL, a portal object, or request options containing either of those\n * @returns The portal API URL, defaults to `https://www.arcgis.com/sharing/rest`\n */\nexport function getPortalApiUrl(urlOrObject) {\n    return `${getPortalUrl(urlOrObject)}/sharing/rest`;\n}\n//# sourceMappingURL=get-portal-api-url.js.map","import { getPortalUrl } from \"./get-portal-url\";\n/**\n * Return the URL of the item's page in the Portal Home application\n * @param itemId The item's ID\n * @param portalUrlOrObject a portal base or API URL, a portal object, or request options containing either of those\n * @returns URL to the item's data REST end point, defaults to `https://www.arcgis.com/home/item.html?id={item.id}`\n */\nexport function getItemHomeUrl(itemId, portalUrlOrObject) {\n    const portalUrl = getPortalUrl(portalUrlOrObject);\n    return `${portalUrl}/home/item.html?id=${itemId}`;\n}\n//# sourceMappingURL=get-item-home-url.js.map","import { getPortalApiUrl } from \"./get-portal-api-url\";\n// NOTE: this fn is tested via getItemDataUrl tests\n/**\n * Get the fully qualified URL to the REST end point for an item.\n * @param item w/ id and access\n * @param portalUrlOrObject a portal base or API URL, a portal object, or request options containing either of those\n * @param token token for the current user's session; will only be appended as a query parameter if the item's access is **not** `public`\n * @returns URL to the item's REST end point, defaults to `https://www.arcgis.com/sharing/rest/content/items/{item.id}?f=json`\n */\nexport const getItemApiUrl = (item, portalUrlOrObject, token) => {\n    const { id, access } = item;\n    const url = `${getPortalApiUrl(portalUrlOrObject)}/content/items/${id}`;\n    const params = new URLSearchParams({ f: \"json\" });\n    if (access !== \"public\" && token) {\n        params.append(\"token\", token);\n    }\n    return `${url}?${params.toString()}`;\n};\n//# sourceMappingURL=get-item-api-url.js.map","/**\n * Given an org url, get the portal base url\n *\n * i.e. https://myorg.maps.arcgis.com will return https://www.arcgis.com\n *\n * @param orgUrl\n * @returns\n */\nexport function getPortalBaseFromOrgUrl(orgUrl) {\n    let result = orgUrl;\n    if (orgUrl.match(/(qaext|\\.mapsqa)\\.arcgis.com/)) {\n        result = \"https://qaext.arcgis.com\";\n    }\n    else if (orgUrl.match(/(devext|\\.mapsdevext)\\.arcgis.com/)) {\n        result = \"https://devext.arcgis.com\";\n    }\n    else {\n        /* istanbul ignore else */\n        if (orgUrl.match(/(www|\\.maps)\\.arcgis.com/)) {\n            result = \"https://www.arcgis.com\";\n        }\n    }\n    return result;\n}\n//# sourceMappingURL=getPortalBaseFromOrgUrl.js.map","import { getPortalUrl } from \"./get-portal-url\";\n/**\n * Return the URL of the group's page in the Portal Home application\n * @param groupId The group's ID\n * @param portalUrlOrObject a portal base or API URL, a portal object, or request options containing either of those\n * @returns URL to the groups's url, defaults to `https://www.arcgis.com/home/group.html?id={group.id}`\n */\nexport function getGroupHomeUrl(groupId, portalUrlOrObject) {\n    const portalUrl = getPortalUrl(portalUrlOrObject);\n    return `${portalUrl}/home/group.html?id=${groupId}`;\n}\n//# sourceMappingURL=getGroupHomeUrl.js.map","import { getPortalUrl } from \"./get-portal-url\";\n/**\n * Return the URL of the user's page in the Portal Home application\n * @param username The username\n * @param portalUrlOrObject a portal base or API URL, a portal object, or request options containing either of those\n * @returns URL to the user's profile, defaults to `https://www.arcgis.com/home/user.html?user={username}`\n */\nexport function getUserHomeUrl(username, portalUrlOrObject) {\n    const portalUrl = getPortalUrl(portalUrlOrObject);\n    return `${portalUrl}/home/user.html?user=${username}`;\n}\n//# sourceMappingURL=getUserHomeUrl.js.map","const app = [\n    \"Application\",\n    \"City Engine Web Scene\",\n    \"CityEngine Web Scene\",\n    \"Dashboard\",\n    \"Insights Page\",\n    \"Insights Workbook\",\n    \"Operation View\",\n    \"Web Mapping Application\",\n    \"StoryMap\",\n    \"Web Experience\",\n    \"Urban Model\",\n];\nconst dataset = [\n    \"CSV Collection\",\n    \"CSV\",\n    \"Feature Collection Template\",\n    \"Feature Collection\",\n    \"Feature Layer\",\n    \"Feature Service\",\n    \"File Geodatabase\",\n    \"GeoJSON\",\n    \"GeoJson\",\n    \"KML Collection\",\n    \"KML\",\n    \"Microsoft Excel\",\n    \"Raster Layer\",\n    \"Shapefile\",\n    \"Stream Service\",\n    \"Table\",\n];\nconst document = [\n    \"CAD Drawing\",\n    \"Document Link\",\n    \"Hub Page\",\n    \"Site Page\",\n    \"Image\",\n    \"iWork Keynote\",\n    \"iWork Numbers\",\n    \"iWork Pages\",\n    \"Microsoft Powerpoint\",\n    \"Microsoft Visio\",\n    \"Microsoft Word\",\n    \"Notebook\",\n    \"PDF\",\n    \"Pro Map\",\n    \"Report Template\",\n];\nconst event = [\"Hub Event\"];\nconst feedback = [\"Form\", \"Quick Capture Project\"];\nconst initiative = [\"Hub Initiative\"];\nconst solution = [\"Solution\"];\nconst template = [\"Hub Initiative Template\"];\nconst map = [\n    \"Image Collection\",\n    \"Image Service\",\n    \"Map Service Layer\",\n    \"Map Service\",\n    \"Scene Service\",\n    \"Scene Layer\",\n    \"Vector Tile Service\",\n    \"Web Map Service\",\n    \"Web Map Tile Service\",\n    \"Web Map\",\n    \"Web Scene\",\n    \"WFS\",\n    \"WMS\",\n    \"WMTS\",\n];\nconst other = [\n    \"360 VR Experience\",\n    \"AppBuilder Widget Package\",\n    \"Application Configuration\",\n    \"ArcPad Package\",\n    \"Code Attachment\",\n    \"Code Sample\",\n    \"Desktop Add In\",\n    \"Desktop Application Template\",\n    \"Desktop Application\",\n    \"Desktop Style\",\n    \"Explorer Add In\",\n    \"Explorer Layer\",\n    \"Geocoding Service\",\n    \"Geometry Service\",\n    \"Geoprocessing Package\",\n    \"Geoprocessing Sample\",\n    \"Geoprocessing Service\",\n    \"Layer File\",\n    \"Layer Package\",\n    \"Layer Template\",\n    \"Layer\",\n    \"Layout\",\n    \"Locator Package\",\n    \"Map Area\",\n    \"Map Document\",\n    \"Map Package\",\n    \"Map Service Definition\",\n    \"Map Template\",\n    \"Mobile Application\",\n    \"Mobile Map Package\",\n    \"Native Application\",\n    \"Network Analysis Service\",\n    \"Operations Dashboard Add In\",\n    \"Project Package\",\n    \"Project Template\",\n    \"Raster Function Template\",\n    \"Rule Package\",\n    \"Scene Package\",\n    \"Service Definition\",\n    \"SQLite Geodatabase\",\n    \"Style\",\n    \"Tile Package\",\n    \"Vector Tile Package\",\n    \"Workflow Manager Package\",\n];\nconst site = [\"Hub Site Application\", \"Site Application\"];\n/**\n * Get the Hub collection for a given item type\n * @param itemType The ArcGIS [item type](https://developers.arcgis.com/rest/users-groups-and-items/items-and-item-types.htm).\n * @returns the Hub collection of a given item type.\n * @private\n */\nexport const getCollection = (type) => {\n    if (!type) {\n        return;\n    }\n    const lowerCaseType = type.toLocaleLowerCase();\n    return Object.keys(collections).find((key) => {\n        const collectionTypes = collections[key];\n        return collectionTypes.some((t) => t.toLocaleLowerCase() === lowerCaseType);\n    });\n};\n/**\n * The converse of getCollection, returns associated types of provided collection\n * @param collection The Hub collection\n * @returns An array of types or undefined if collection is not found\n * @private\n */\nexport const getCollectionTypes = (collection) => {\n    if (!collection) {\n        return;\n    }\n    const lowerCaseCollection = collection.toLocaleLowerCase();\n    return collections[lowerCaseCollection];\n};\n// TODO: remove this when we remove the deprecated categories\n// and then move the above arrays and getCollection() logic to get-family\nexport const collections = {\n    app,\n    dataset,\n    document,\n    event,\n    feedback,\n    initiative,\n    template,\n    solution,\n    map,\n    other,\n    site,\n};\n//# sourceMappingURL=collections.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, cleanUrl, appendCustomParams } from \"@esri/arcgis-rest-request\";\n/**\n * ```js\n * import { getFeature } from '@esri/arcgis-rest-feature-layer';\n * //\n * const url = \"https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/Landscape_Trees/FeatureServer/0\";\n * //\n * getFeature({\n *   url,\n *   id: 42\n * }).then(feature => {\n *  console.log(feature.attributes.FID); // 42\n * });\n * ```\n * Get a feature by id.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the feature or the [response](https://developer.mozilla.org/en-US/docs/Web/API/Response) itself if `rawResponse: true` was passed in.\n */\nexport function getFeature(requestOptions) {\n    var url = cleanUrl(requestOptions.url) + \"/\" + requestOptions.id;\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options).then(function (response) {\n        if (options.rawResponse) {\n            return response;\n        }\n        return response.feature;\n    });\n}\n/**\n * ```js\n * import { queryFeatures } from '@esri/arcgis-rest-feature-layer';\n * //\n * queryFeatures({\n *   url: \"http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/3\",\n *   where: \"STATE_NAME = 'Alaska'\"\n * })\n *   .then(result)\n * ```\n * Query a feature service. See [REST Documentation](https://developers.arcgis.com/rest/services-reference/query-feature-service-layer-.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the query response.\n */\nexport function queryFeatures(requestOptions) {\n    var queryOptions = appendCustomParams(requestOptions, [\n        \"where\",\n        \"objectIds\",\n        \"relationParam\",\n        \"time\",\n        \"distance\",\n        \"units\",\n        \"outFields\",\n        \"geometry\",\n        \"geometryType\",\n        \"spatialRel\",\n        \"returnGeometry\",\n        \"maxAllowableOffset\",\n        \"geometryPrecision\",\n        \"inSR\",\n        \"outSR\",\n        \"gdbVersion\",\n        \"returnDistinctValues\",\n        \"returnIdsOnly\",\n        \"returnCountOnly\",\n        \"returnExtentOnly\",\n        \"orderByFields\",\n        \"groupByFieldsForStatistics\",\n        \"outStatistics\",\n        \"returnZ\",\n        \"returnM\",\n        \"multipatchOption\",\n        \"resultOffset\",\n        \"resultRecordCount\",\n        \"quantizationParameters\",\n        \"returnCentroid\",\n        \"resultType\",\n        \"historicMoment\",\n        \"returnTrueCurves\",\n        \"sqlFormat\",\n        \"returnExceededLimitFeatures\",\n        \"f\"\n    ], {\n        httpMethod: \"GET\",\n        params: __assign({ \n            // set default query parameters\n            where: \"1=1\", outFields: \"*\" }, requestOptions.params)\n    });\n    return request(cleanUrl(requestOptions.url) + \"/query\", queryOptions);\n}\n//# sourceMappingURL=query.js.map","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cleanUrl } from \"@esri/arcgis-rest-request\";\nvar serviceRegex = new RegExp(/.+(?:map|feature|image)server/i);\n/**\n * Return the service url. If not matched, returns what was passed in\n */\nexport function parseServiceUrl(url) {\n    var match = url.match(serviceRegex);\n    if (match) {\n        return match[0];\n    }\n    else {\n        return stripQueryString(url);\n    }\n}\nfunction stripQueryString(url) {\n    var stripped = url.split('?')[0];\n    return cleanUrl(stripped);\n}\n//# sourceMappingURL=helpers.js.map","import { __rest } from \"tslib\";\nimport { parseServiceUrl } from \"./helpers\";\nimport { request } from '@esri/arcgis-rest-request';\n/**\n * ```js\n * import { getAllLayersAndTables } from '@esri/arcgis-rest-feature-layer';\n * getAllLayersAndTables({\n *   url: \"https://sampleserver6.arcgisonline.com/arcgis/rest/services/ServiceRequest/FeatureServer/0\"\n * })\n *   .then(response) // { layers: [...], tables: [...] }\n * ```\n * Fetches all the layers and tables associated with a given layer service.\n * Wrapper for https://developers.arcgis.com/rest/services-reference/all-layers-and-tables.htm\n *\n * @param options - Request options, including the url for the layer service\n * @returns A Promise that will resolve with the layers and tables for the given service\n */\n// TODO: should we expand this to support other valid params of the endpoint?\nexport function getAllLayersAndTables(options) {\n    var url = options.url, requestOptions = __rest(options, [\"url\"]);\n    var layersUrl = parseServiceUrl(url) + \"/layers\";\n    return request(layersUrl, requestOptions);\n}\n//# sourceMappingURL=getAllLayersAndTables.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, cleanUrl } from \"@esri/arcgis-rest-request\";\n/**\n * ```js\n * import { getService } from '@esri/arcgis-rest-feature-layer';\n * //\n * getService({\n *   url: \"https://sampleserver6.arcgisonline.com/arcgis/rest/services/ServiceRequest/FeatureServer\"\n * })\n *   .then(response) // { name: \"311\", id: 0, ... }\n * ```\n * Feature Service request. See the [REST Documentation](https://developers.arcgis.com/rest/services-reference/feature-service.htm) for more information.\n *\n * @param options - Options for the request.\n * @returns A Promise that will resolve with the getService response.\n */\nexport function getService(options) {\n    return request(cleanUrl(options.url), options);\n}\n//# sourceMappingURL=getService.js.map","/**\n* adlib - v3.0.7 - Tue Oct 04 2022 12:08:15 GMT-0400 (Eastern Daylight Time)\n* Copyright (c) 2017-2022 Dave Bouwman / Esri\n* Apache-2.0\n*/\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n/**\n * Return the value of a deep property, using a path.\n */\nvar getWithDefault = function (obj, path, defaultValue) {\n  if ( defaultValue === void 0 ) defaultValue = undefined;\n\n  return path\n  .split('.')\n  .reduce(function (o, p) { return o ? o[p] : defaultValue; }, obj);\n};\n\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n/**\n * Simply Map over the props of an object\n */\nfunction mapValues (obj, fn) {\n  var keys = Object.keys(obj);\n  // console.info(`keys: ${keys}`);\n  var newObject = keys.reduce(function(acc, currentKey) {\n    // console.log(`   acc: ${JSON.stringify(acc)} curKey: ${currentKey}`);\n    acc[currentKey] = fn(obj[currentKey], currentKey, obj);\n    return acc;\n  }, {});\n  // console.info(`  output: ${JSON.stringify(newObject)}`);\n  return newObject;\n}\n\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\nvar isDate = function (v) { return v instanceof Date; };\n\nvar isFunction = function (v) { return typeof v === 'function'; };\n\nvar isObject = function (v) { return typeof v === 'object'; };\n\nvar isRegExp = function (v) { return v instanceof RegExp; };\n\nfunction deepMapValues(object, callback, propertyPath) {\n  propertyPath = propertyPath || '';\n  if(Array.isArray(object)){\n    return object.map(deepMapValuesIteratee);\n  }\n  else if(object && isObject(object) && !isDate(object) && !isRegExp(object) && !isFunction(object)){\n    return Object.assign({}, object, mapValues(object, deepMapValuesIteratee));\n  }\n  else {\n    var output = callback(object, propertyPath);\n    return output;\n  }\n\n  function deepMapValuesIteratee(value, key){\n    var valuePath = propertyPath ? propertyPath + '.' + key : key;\n    return deepMapValues(value, callback, valuePath);\n  }\n}\n\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\nvar isObject$1 = function (v) { return typeof v === 'object'; };\n\n/**\n * Trim a tree decorated with `{{delete:NNN}}`\n */\nfunction arborist (object, propertyPath) {\n\n  if(Array.isArray(object)){\n    // filter out any nulls...\n    var arrResults = object.map(iteratee).filter(function (entry) {\n      // need to ensure entry is actually NULL vs just falsey\n      return entry !== null && entry !== undefined;\n    });\n    return pruneArray(arrResults);\n\n  } if(object && isObject$1(object) ) {\n\n    return pruneObject(mapValues(object, iteratee));\n\n  } else {\n\n    return getPropertyValue(object);\n  }\n\n  function iteratee(value, key){\n    return arborist(value);\n  }\n}\n\n/**\n * Prune an array\n * For all the entries in the array...\n *    if the entry is a naked string and contains `{{delete:NNN}}`\n *      get maximum NNN value\n *    then\n *      if maxN === 0\n *        return an empty array\n *      if maxN > 0\n *        return `{{delete:maxN-1}}`\n *    else\n *      return array\n */\nfunction pruneArray (arrResults) {\n  var res = arrResults;\n  // is any entry a string w/ {{delete}}?\n  var maxLevel = arrResults.reduce(function (maxLevel, e) {\n    if (isString(e) && hasDelete(e)) {\n      var lvl = getLevel(e);\n      if (lvl > maxLevel) {\n        maxLevel = lvl;\n      }\n    }\n    return maxLevel;\n  }, -1);\n\n  if (maxLevel > -1) {\n    if (maxLevel === 0) {\n      res = [];\n    } else {\n      res = \"{{delete:\" + (maxLevel - 1) + \"}}\";\n    }\n  }\n\n  return res;\n}\n\n\nfunction pruneObject (objResults) {\n  // console.log(`   pruneObject:: working on ${JSON.stringify(objResults)}`);\n  var startVal = {obj: {}, maxLevel: -1 };\n  var res;\n  // cook a new clone object, and track the maxLevel\n  var reduction = Object.keys(objResults).reduce(function (acc, key) {\n    var val = objResults[key];\n    if (isString(val) && hasDelete(val)) {\n      var lvl = getLevel(val);\n      if (lvl > acc.maxLevel) {\n        acc.maxLevel = lvl;\n      }\n    } else {\n      // only add the prop if it's not a `{{delete:NNN}}`\n      acc.obj[key] = val;\n    }\n    return acc;\n  }, startVal);\n  // if -1, we return entire object...\n  // if 0 we just remove the prop...\n  // if 1 we return undefined...\n  // if > 1 we return the deleteVal\n  if (reduction.maxLevel > 0 ) {\n    if (reduction.maxLevel === 1) {\n      res = undefined;\n    } else {\n      res = \"{{delete:\" + (reduction.maxLevel - 1) + \"}}\";\n    }\n  } else {\n    res = reduction.obj;\n  }\n\n  // console.log(`     returning ${JSON.stringify(res)}`);\n  return res;\n}\n\n/**\n * Get a value for a property, handling the `{{delete:NNN}}` syntax\n */\nfunction getPropertyValue (val){\n  var output = val;\n\n  if (typeof val === 'string') {\n    if (hasDelete(val)) {\n      output = getDeleteValue(val);\n    }\n  }\n  return output;\n}\n\n/**\n * Given a string with `{{delete:NNN}}`\n * if NNN === 0 return undefined\n * else return `{{delete:NNN - 1}}`\n */\nfunction getDeleteValue (val) {\n  var output = val;\n  var level = getLevel(val);\n  if (level === 0) {\n    output = undefined;\n  } else {\n    output = \"{{delete:\" + level + \"}}\";\n  }\n  return output;\n}\n\n/**\n * Extract the level from a `{{delete:NNN}}`\n */\nvar getLevel = function (value) { return parseInt(value.replace(/{|}/g, '').split(':')[1]); };\n\n/**\n * Simple check if a value has `{{delete` in it\n */\nfunction hasDelete (value) {\n  if (value && typeof value === 'string') {\n    return value.indexOf('{{delete') > -1;\n  } else {\n    return false;\n  }\n}\n\nvar isString = function (v) { return typeof v === 'string'; };\n\n/*   Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n/**\n * Optional Transform\n * Supports a declarative syntax for optional template properties\n *\n * {{some.object.key:optional:2}}\n *\n * In this example, if defined, the value of `some.object.key` is used.\n * If not defined, then the optional transform is utilized\n * and a post-processing step is executed which will remove two parent levels\n * from the output structure\n */\n\nfunction optionalTransform(key, value, settings, level) {\n  if ( level === void 0 ) level = 0;\n\n  // console.log(`optional: ${key}, ${value}, ${level}`);\n  var val = value;\n  if (!value) {\n    val = \"{{delete:\" + level + \"}}\";\n  }\n  return val;\n}\n\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n/**\n * ```js\n * import { cloneObject } from \"./cloneObject\";\n * const original = { foo: \"bar\" }\n * const copy = cloneObject(original)\n * copy.foo // \"bar\"\n * copy === original // false\n * ```\n * Make a deep clone, including arrays. Does not handle functions!\n *\n * Copied from @esri/hub-common to avoid bringing along that package's\n * dependencies, @esri/hub-common should be made a dependency if more\n * functions are needed from it in the future\n */\nvar cloneObject = function (obj) {\n  var clone = {};\n  // first check array\n  if (Array.isArray(obj)) {\n    clone = obj.map(cloneObject);\n  } else if (typeof obj === \"object\") {\n    for (var i in obj) {\n      if (obj[i] != null && typeof obj[i] === \"object\") {\n        clone[i] = cloneObject(obj[i]);\n      } else {\n        clone[i] = obj[i];\n      }\n    }\n  } else {\n    clone = obj;\n  }\n  return clone;\n};\n\n/*    Copyright (c) 2017-2019 Esri Inc.\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n       http://www.apache.org/licenses/LICENSE-2.0\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\nvar HANDLEBARS = /{{\\s*?[\\w].*?}}/g;\n\nvar isString$1 = function (v) { return typeof v === 'string'; };\n\nfunction _swap(parameter, settings, transforms) {\n  var value;\n  // console.info(`_swap: param: ${parameter}`);\n  // Parameters can optionally call transform functions\n  // e.g. \"{{ipsum:translateLatin}}\"\n  // so extract {{<parameter>:<transformFunction>:<key||value>}}\n  var transformCheck = parameter.split(':');\n  if (transformCheck.length > 1) {\n    // we have a request to use a transform...\n    var key = transformCheck[0];\n    var fn = transformCheck[1];\n    // we default to using the value...\n    var param;\n    if (transformCheck[2]) {\n      param = transformCheck[2];\n    }\n    if (transforms && transforms[fn] && typeof transforms[fn] === 'function') {\n      // get the value from the param\n      value = getWithDefault(settings, key);\n      // transform it...\n      value = transforms[fn](key, value, settings, param);\n    } else {\n      throw new Error((\"Attempted to apply non-existant transform \" + fn + \" on \" + key + \" with params \" + parameter));\n    }\n  } else {\n    // we just get the value\n    value = getWithDefault(settings, parameter);\n  }\n  return value;\n}\n\n/**\n * Does a propertyPath exist on a target\n */\nfunction _propertyPathExists(propertyPath, target) {\n  // remove any transforms\n  var cleanPath = propertyPath.split(':')[0];\n  var value = getWithDefault(target, cleanPath, null);\n  if (value !== null && value !== undefined) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\n/**\n * Is the value considered valid\n */\nfunction _isValue(val) {\n  return val || val === '' || val === 0;\n}\n\n// Combine a Template with Settings\nfunction adlib(template, settings, transforms) {\n  if ( transforms === void 0 ) transforms = null;\n\n  transforms = cloneObject(transforms) || {};\n  if (transforms.optional) {\n    throw new Error('Please do not pass in an `optional` transform; adlib provides that internally.');\n  } else {\n    transforms.optional = optionalTransform;\n  }\n\n  var res = deepMapValues(template, function (templateValue, templatePath) {\n    // Only string templates\n    if (!isString$1(templateValue)) {\n      return templateValue;\n    }\n\n    // When we match \"{{layer.fields..}}\"\n    var settingsValue;\n\n    var hbsEntries = templateValue.match(HANDLEBARS);\n\n    if (hbsEntries && hbsEntries.length) {\n      // console.log(`Got a ${hbsEntries.length} handlebar entries...`);\n      // iterate over the entries...\n      var values = hbsEntries.map(function (entry) {\n        var isStaticValue = false;\n        // console.info(`Matched ${entry}...`);\n        // strip off the curlies and trim any leading/trailing whitespace...\n        var path = entry.replace(/{|}/g, '').trim();\n        // check for || which indicate a hiearchy\n        if (path.indexOf('||') > -1) {\n          var paths = path.split('||').map(function (path) { return path.trim(); });\n          var numberOfPaths = paths.length;\n          // here we check each option, in order, and return the first with a value in the hash, OR the last\n          path = paths.find(function (pathOption, idx) {\n            // console.info(`Checking to see if ${pathOption} is in settings hash...`);\n            var exists = _propertyPathExists(pathOption, settings);\n            if (!exists) {\n              if ((idx + 1) === numberOfPaths) {\n                // console.info(`Got to last entry, and still did not find anything... assuming ${pathOption} is a static value...`);\n                isStaticValue = true;\n                // check if we can convert this into a number...\n                if (!isNaN(pathOption)) {\n                  pathOption = parseInt(pathOption);\n                }\n                return pathOption;\n              } else {\n                return false;\n              }\n            } else {\n              return pathOption;\n            }\n          });\n        }\n        // setup the return value...\n        var result = {\n          key: entry,\n          value: path\n        };\n        // if we have a valid object path, value comes from _swap\n        if (!isStaticValue) {\n          var swap = _swap(path, settings, transforms);\n          result.value = _isValue(swap) ? swap : entry;\n        }\n        // console.info(`Value: ${JSON.stringify(result)}`);\n        return result;\n      });\n\n      values.forEach(function (v) {\n        // console.log(`Comparing ${templateValue} with ${v.key}`)\n        if (templateValue === v.key) {\n          // console.log(`template matches key, returning ${v.value}`);\n          // if the value is a string...\n          if (typeof v.value === 'string') {\n            // and it's numeric-ish and does not have leading 0s\n            if (!isNaN(v.value) && v.value !== '') {\n              // and has a . in it...\n              if (v.value.indexOf('.') > -1) {\n                // parse as a float...\n                v.value = parseFloat(v.value);\n\n              } else {\n                // if no leading 0s, parse as an int\n                if (v.value[0] !== '0'){ \n                  v.value = parseInt(v.value);\n                }\n              }\n            }\n          }\n          settingsValue = v.value;\n        } else {\n          // a little extra regex dance to match the '||' because '|'\n          // is a Very Special Regex Character and we need to super\n          // escape them for the regex to work\n          // console.log(`KEY ${v.key}`);\n          // console.log(`TEMPLATE ${templateValue}`);\n          templateValue = templateValue.replace(v.key, v.value);\n          // console.log(`template did not match key, interpolating value ${v.value} into template to produce ${templateValue}`);\n        }\n      });\n\n      // if we have a value, let's return that...\n      if (_isValue(settingsValue)) {\n        // console.log(`We found a value so we return it ${settingsValue}`);\n        return settingsValue;\n      } else {\n        // console.log(`We did not find a value so we return the template ${templateValue}`);\n        // but if we don't, lets return the template itself\n        return templateValue;\n      }\n    } else {\n      // console.log(`We did not find a hbs match, so we return the template ${templateValue}`);\n      // no match, return the templateValue...\n      return templateValue;\n    }\n  });\n  return arborist(res);\n}\n\n// read a template and spit out unique values\nfunction listDependencies(template) {\n  if (typeof template !== 'string') {\n    template = JSON.stringify(template);\n  }\n\n  try {\n    return Array.from(\n      new Set(\n        template.match(HANDLEBARS)\n      )\n    )\n      .map(function (term) {\n        return term.replace(/^{{/g, '').replace(/}}$/g, '').replace(/:.+$/, '')\n        // Node > 10 and browsers support this w/ a lookahead\n        // won't need to use the replace\n        // /(?<={{)[\\w].*?(?=}})/g\n      })\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nexport { adlib, arborist, deepMapValues, getPropertyValue, getWithDefault, listDependencies, mapValues, optionalTransform, pruneArray, pruneObject };\n","import { getWithDefault } from \"./objects/get-with-default\";\nimport OperationError from \"./OperationError\";\n/**\n * Generic Hub Error with an Error stack as well\n * as an optional serialized OperationStack.\n *\n * Also accepts a `rootCause` Error object\n */\nexport default class HubError extends OperationError {\n    /**\n     * Creates an instance of HubError.\n     * @param {string} operation\n     * @param {string} [message]\n     * @param {Error} [rootCause]\n     * @memberof HubError\n     */\n    constructor(operation, message, rootCause) {\n        message = message || \"UNKNOWN_ERROR\";\n        // if the rootCause has a .rootCause, use that so we don't deeply nest\n        rootCause = getWithDefault(rootCause, \"rootCause\", rootCause);\n        /* Skip coverage on super(...) as per:\n           https://github.com/Microsoft/TypeScript/issues/13029\n           https://github.com/SitePen/remap-istanbul/issues/106\n        */\n        /* istanbul ignore next */\n        super(operation, message, rootCause);\n        this.name = \"HubError\";\n        // if the original error has a stack use it, otherwise create a new\n        // stack. Note: a new Stack will make it look like the error origninated\n        // in the HubError constructor. This is only an issue in tests but\n        // it can be confusing to debug\n        this.stack = getWithDefault(rootCause, \"stack\", new Error().stack);\n    }\n}\n//# sourceMappingURL=HubError.js.map","import { getItemApiUrl } from \"../urls/get-item-api-url\";\n/**\n * Get the fully qualified URL for an item's thumbnail\n * @param item w/ id, thumbnail, and access\n * @param portalUrlOrObject a portal base or API URL, a portal object, or request options containing either of those\n * @param optionsOrToken options including width and/or token for the current user's session; will only be appended as a query parameter if the item's access is **not** `public`\n * @returns URL to the item's thumbnail, defaults to `https://www.arcgis.com/sharing/rest/content/items/{item.id}/info/{item.thumbnail}`. Returns `null` if the item does not have a thumbnail assigned.\n */\nexport function getItemThumbnailUrl(item, portalUrlOrObject, optionsOrToken) {\n    if (!item || !item.thumbnail) {\n        // TODO: handle image types by returning the image (item data) itself?\n        return null;\n    }\n    // tslint:disable-next-line prefer-const\n    let { token, width } = optionsOrToken || {};\n    // TODO: at the next breaking change drop support for passing token as string\n    if (!token && typeof optionsOrToken === \"string\") {\n        token = optionsOrToken;\n    }\n    const itemApiUrl = getItemApiUrl(item, portalUrlOrObject, token);\n    const [baseUrl, search] = itemApiUrl.split(\"?\");\n    const searchParams = new URLSearchParams(search);\n    searchParams.delete(\"f\");\n    if (width) {\n        searchParams.append(\"w\", width + \"\");\n    }\n    const newSearch = searchParams.toString();\n    const url = `${baseUrl}/info/${item.thumbnail}`;\n    return newSearch ? `${url}?${newSearch}` : url;\n}\n//# sourceMappingURL=get-item-thumbnail-url.js.map","/**\n * Parse an IncludeSpec from the include string\n * Include String structure:\n * - `enrichment{.deep.path} AS propertyName`\n *\n * Examples\n * - `server.layers.0.name as layerName` -> use the `server` enrichment, extract the name of the first layer and attach that as `layerName`\n * - `server.layers` ->  use the `server` enrichment, attach the `layers` array as `layers`\n * @param include\n * @returns\n */\nexport function parseInclude(include) {\n    // TODO: Validate enrichment? Not clear how we'd do that other than a manully maintained string list\n    const parts = include.split(\" AS \");\n    const path = parts[0];\n    const prop = parts[1] || path.split(\".\").reverse()[0];\n    const enrichment = path.split(\".\")[0];\n    // We need the actual list of string values so we can verify\n    // what we get in, is infact a valid enrichment.\n    const spec = {\n        enrichment,\n        path,\n        prop,\n    };\n    return spec;\n}\n//# sourceMappingURL=parseInclude.js.map","/* Copyright (c) 2018-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cloneObject, createId } from \"./util\";\nimport { getWithDefault } from \"./objects/get-with-default\";\n/**\n * Allows an application to track a series of operations, storing information\n * about the arguments passes in and the results returned\n *\n * ```js\n * import { OperationStack } from '@esri/solution-common';\n *\n * const stack = new OperationStack();\n *\n * // start an operation by type\n * const id = stack.start('getItem');\n * //.. work happens...\n * stack.finish(id);\n *\n * // start an operation with an Operation object\n * stack.start({\n *   id: 'createItem_1',\n *   type: 'createItem',\n *   inputs: {\n *    item: {...truncated...},\n *    portal: 'https://www.arcgis.com',\n *    username: 'jsmith'\n *   },\n * });\n * // make the call\n * stack.finish('createItem_1', {newItemId: '00cf213'});\n *\n * // later you can get that information back out of the stack\n * const prevOp = stack.getOperation('createItem_1);\n *\n * // and if you need to roll back you can use the\n * // .cleanup and .output properties to help orchestrate\n *\n * ```\n *\n *\n * Can be used to implement \"atomic\" operations in an environment that does not\n * have this as a core feature\n */\nexport default class OperationStack {\n    /**\n     * Creates an instance of OperationStack.\n     * @memberof OperationStack\n     */\n    constructor() {\n        this.operations = [];\n    }\n    /**\n     * Start an Operation\n     *\n     * ```js\n     * const stack = new OperationStack();\n     * stack.startOperation({\n     *  id: 'get-bc3',\n     *  type: 'getItem',\n     *  cleanup: 'n/a',\n     *  inputs: {\n     *    id: 'bc3',\n     *    owner: 'vader'\n     *  }\n     * });\n     * // do work\n     * stack.finish('get-bc3');\n     * ```\n     *\n     *\n     * @param {IOperation} operation\n     * @memberof OperationStack\n     */\n    startOperation(operation) {\n        const op = cloneObject(operation);\n        op.startedAt = new Date().getTime();\n        op.state = \"working\";\n        this.operations.push(op);\n    }\n    /**\n     * Start an operation without requiring a full operation\n     *\n     * ```js\n     * const opId = stack.start('getItems');\n     * //...work happens\n     * stack.finish(opId);\n     * ```\n     *\n     * @param {string} type Type of the operation. i.e. getItem\n     * @param {Record<string, unknown>} [params] optionally pass in id, inputs, cleanup\n     * @returns {string} Identifier of the new stack entry\n     * @memberof OperationStack\n     */\n    start(type, params) {\n        const op = {\n            type,\n            id: getWithDefault(params, \"id\", createId(`${type}_`)),\n            inputs: getWithDefault(params, \"inputs\", {}),\n            cleanup: getWithDefault(params, \"cleanup\", \"n/a\"),\n            startedAt: new Date().getTime(),\n            state: \"working\"\n        };\n        this.operations.push(op);\n        return op.id;\n    }\n    /**\n     * Returns a reference to an Operation\n     *\n     * @param {string} id Unique Identifier\n     * @returns {Operation}\n     * @memberof OperationStack\n     */\n    getOperation(id) {\n        return this.operations.find(o => o.id === id);\n    }\n    /**\n     * Returns reference to the operations array\n     *\n     * @returns {Operation[]}\n     * @memberof OperationStack\n     */\n    getOperations() {\n        return this.operations;\n    }\n    /**\n     * Inform the stack that an operation has finished.\n     *\n     * This will append in a duration property, and mark\n     * the state as 'completed'.\n     *\n     * @param {string} id Unique identifier of the Operation\n     * @param {Record<string, unknown>} [options] outputs\n     * @memberof OperationStack\n     */\n    finish(id, options) {\n        const op = this.getOperation(id);\n        if (op) {\n            op.duration = new Date().getTime() - op.startedAt;\n            op.state = \"completed\";\n            if (options) {\n                op.output = cloneObject(options);\n            }\n        }\n        else {\n            throw new Error(`No operation with id ${id} present in stack`);\n        }\n    }\n    /**\n     * Merge a serialized operation stack into\n     * a stack instance\n     *\n     * ```js\n     *    import { OperationStack } from '@esri/solution-common';\n     *    function someFunction() {\n     *      const stack = new OperationStack();\n     *      stack.start('getItem', {id: 'get-bc3'});\n     *      // do some work...\n     *      stack.finish('get-bc3');\n     *\n     *      const itm = {title: 'Fake Item', type: 'Web Map'};\n     *      // create an entry for the function we are about to call...\n     *      stack.start('createItem', {id: 'createItem_01', inputs: {item: itm}});\n     *      // call a function that does work, and has it's own stack\n     *      // and returns a serialized version as part of it's results\n     *      return createItem(itm)\n     *      .then((result) => {\n     *        // tell the stack the last operation finished...\n     *        stack.finish('createItem_01');\n     *        // merge in the stack from the function we called\n     *        stack.merge(result.stack);\n     *        // > stack.getCompleted().length === 3\n     *      });\n     *    }\n     *\n     *    function createItem (itm) {\n     *      const otherStack = new OperationStack();\n     *      const id = otherStack.start('createItem');\n     *      // make calls to create item etc\n     *      otherStack.finish(id, {itemId: newItem.id});\n     *      otherStack.start('protectItem', {id: 'protect-00c'});\n     *      // make call to protect item...\n     *      otherStack.finish('protect-00c');\n     *      // all done... return a result with a stack\n     *      return Promise.resolve({\n     *        success:true,\n     *        stack: otherStack.serialize()\n     *      });\n     *    }\n     * ```\n     *\n     *  Typically used to create a comprehensive list of operations\n     *  when a function returns a `SerializedOperationStack` as part of\n     *  it's response\n     *\n     *\n     * @param {ISerializedOperationStack} stack\n     * @memberof OperationStack\n     */\n    merge(stack) {\n        this.operations = [...this.operations, ...stack.operations];\n    }\n    /**\n     * Get a list of the completed operations\n     *\n     * @returns {IOperation[]}\n     * @memberof OperationStack\n     */\n    getCompleted() {\n        return cloneObject(this.operations.filter(e => e.state === \"completed\"));\n    }\n    /**\n     *  Return an array of working operations\n     *\n     * @returns {IOperation[]}\n     * @memberof OperationStack\n     */\n    getWorking() {\n        return cloneObject(this.operations.filter(e => e.state === \"working\"));\n    }\n    /**\n     * Serialize the completed operations into a set of\n     * human readable messages, sorted by the startedAt timestamp\n     *\n     *\n     * @returns {string}\n     * @memberof IOperationStack\n     */\n    toString() {\n        // sort the operations by StartedAt\n        const allOps = this.operations.sort((a, b) => {\n            if (a.startedAt < b.startedAt) {\n                return -1;\n            }\n            if (b.startedAt < a.startedAt) {\n                return 1;\n            }\n            return 0;\n        });\n        return allOps.map(getOperationMessage).join(\"\\n\");\n    }\n    /**\n     * Serialize the stack into simple objects\n     *\n     * @returns {ISerializedOperationStack}\n     * @memberof OperationStack\n     */\n    serialize() {\n        return {\n            operations: cloneObject(this.getOperations())\n        };\n    }\n}\nfunction getOperationMessage(op) {\n    let msg = `${op.startedAt} : Operation ${op.id} started with inputs ${JSON.stringify(op.inputs)} but was not completed`;\n    if (op.state === \"completed\") {\n        msg = `${op.startedAt} : Operation ${op.id} took ${op.duration} ms with inputs ${JSON.stringify(op.inputs)} and output ${op.output ? JSON.stringify(op.output) : \"n/a\"}`;\n    }\n    return msg;\n}\n//# sourceMappingURL=OperationStack.js.map","import { getProp } from \"../objects/get-prop\";\nimport { getPortalBaseFromOrgUrl } from \"../urls/getPortalBaseFromOrgUrl\";\nimport { getPortal } from \"@esri/arcgis-rest-portal\";\n/**\n * Fetches the portal for a given org.\n *\n * @param orgId\n * @param options request options\n * @returns\n */\nexport function fetchOrg(orgId, options) {\n    const orgPortalUrl = getProp(options, \"portal\") ||\n        getProp(options, \"authentication.portal\") ||\n        \"www.arcgis.com\";\n    // In order to get the correct response, we must pass options.portal\n    // as a base portal url (e.g., www.arcgis.com, qaext.arcgis.com, etc)\n    // **not** an org portal (i.e. org.maps.arcgis.com).\n    const basePortalUrl = `${getPortalBaseFromOrgUrl(orgPortalUrl)}/sharing/rest`;\n    return getPortal(orgId, Object.assign(Object.assign({}, options), { portal: basePortalUrl }));\n}\n//# sourceMappingURL=fetch-org.js.map","import { getItemData, getItemGroups, getUser, } from \"@esri/arcgis-rest-portal\";\nimport { getAllLayersAndTables, getService, parseServiceUrl, } from \"@esri/arcgis-rest-feature-layer\";\nimport { createOperationPipeline } from \"../utils\";\nimport OperationStack from \"../OperationStack\";\n// TODO: move these functions here under /items\nimport { getItemMetadata } from \"@esri/arcgis-rest-portal\";\nimport { getItemOrgId } from \"../content/_internal\";\nimport { fetchOrg } from \"../org\";\n/**\n * Lazy load XML parsing library and parse metadata XML into JSON\n * @param metadataXml\n * @returns\n */\nasync function parseMetadataXml(metadataXml) {\n    // lazy load xml parsing library\n    const { parse } = await import(\"fast-xml-parser\");\n    // return XML parsed as JSON\n    const opts = {\n        // options for fastXmlParser to read tag attrs\n        ignoreAttributes: false,\n        attributeNamePrefix: \"@_\",\n        textNodeName: \"#value\",\n    };\n    return parse(metadataXml, opts);\n}\n/**\n * Fetch an [item's metadata](https://doc.arcgis.com/en/arcgis-online/manage-data/metadata.htm) from a portal\n * and parse and return it as JSON\n * @param id item id\n * @param requestOptions\n */\nasync function fetchContentMetadata(id, requestOptions) {\n    try {\n        const metadataXml = await getItemMetadata(id, requestOptions);\n        return await parseMetadataXml(metadataXml);\n    }\n    catch (_) {\n        // many items don't have metadata and the request will 404\n        // in these cases we don't want to treat it as an error\n        // content.metadata === null signals to consumers that\n        // we attempted to fetch the metadata, but it doesn't exist\n        // TODO: we should probably still throw the error if it's not a 404\n        return null;\n    }\n}\nconst enrichGroupIds = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichGroupIds\");\n    return getItemGroups(data.item.id, requestOptions)\n        .then((response) => {\n        const { admin, member, other } = response;\n        const groupIds = [...admin, ...member, ...other].map((group) => group.id);\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), { groupIds }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\nconst enrichMetadata = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichMetadata\");\n    return fetchContentMetadata(data.item.id, requestOptions).then((metadata) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), { metadata }),\n            stack,\n            requestOptions,\n        };\n    });\n    // TODO: currently fetchContentMetadata will never throw, but\n    // if we update it to throw for non-404 errors, need to uncomment this:\n    // .catch((error) => handleEnrichmentError(error, input, opId));\n};\nconst enrichOwnerUser = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichOwner\");\n    // w/o the : any here, I get a compile error about\n    // .authentication being incompatible w/ UserSession\n    const options = Object.assign({ username: data.item.owner }, requestOptions);\n    return getUser(options)\n        .then((ownerUser) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), { ownerUser }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\n// Note, this MUST be run after `enrichOwnerUser` to access the correct orgId during processing.\n// `item.orgId` is only SOMETIMES returned by Portal, so we need the ownerUser's orgId as a backup.\n//\n// If an orgId isn't present on either the item or the ownerUser, this operation will be skipped.\nconst enrichOrg = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichOrg\");\n    const orgId = getItemOrgId(data.item, data.ownerUser);\n    // Only fetch the org if an explicit orgId is present\n    const orgPromise = orgId\n        ? fetchOrg(orgId, requestOptions)\n        : Promise.resolve(undefined);\n    return orgPromise\n        .then((org) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), { org }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\nconst enrichData = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichData\");\n    return getItemData(data.item.id, requestOptions)\n        .then((itemData) => {\n        stack.finish(opId);\n        return { data: Object.assign(Object.assign({}, data), { data: itemData }), stack, requestOptions };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\nconst enrichServer = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichServer\");\n    const url = parseServiceUrl(data.item.url);\n    const options = Object.assign(Object.assign({}, requestOptions), { url });\n    return getService(options)\n        .then((server) => {\n        stack.finish(opId);\n        return { data: Object.assign(Object.assign({}, data), { server }), stack, requestOptions };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\nconst enrichLayers = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichLayers\");\n    const url = data.item.url;\n    const options = Object.assign(Object.assign({}, requestOptions), { url });\n    return (getAllLayersAndTables(options)\n        // merge layers and tables into a single array\n        // and filter out any group layers\n        .then((response) => {\n        const merged = [...response.layers, ...response.tables];\n        return merged.filter((layer) => layer.type !== \"Group Layer\");\n    })\n        .then((layers) => {\n        stack.finish(opId);\n        return { data: Object.assign(Object.assign({}, data), { layers }), stack, requestOptions };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId)));\n};\n// add the error to the content.errors,\n// log current stack operation as finished with an error\n// and return output that can be piped into the next operation\nconst handleEnrichmentError = (error, input, opId) => {\n    const { data, stack, requestOptions } = input;\n    stack.finish(opId, { error });\n    return {\n        data: Object.assign(Object.assign({}, data), { errors: getEnrichmentErrors(error, data.errors) }),\n        stack,\n        requestOptions,\n    };\n};\nconst enrichmentOperations = {\n    groupIds: enrichGroupIds,\n    metadata: enrichMetadata,\n    ownerUser: enrichOwnerUser,\n    org: enrichOrg,\n    data: enrichData,\n    server: enrichServer,\n    layers: enrichLayers,\n};\n/**\n * convert an error to an enrichment error info format\n * and optionally append it to an existing array of those\n * @param error\n * @param errors an array of existing enrichment error info\n * @returns a new array of enrichment error info\n * @private\n */\nexport const getEnrichmentErrors = (error, errors = []) => {\n    const message = typeof error === \"string\"\n        ? /* istanbul ignore next our tests only throw Error objects */\n            error\n        : error.message;\n    return [\n        ...errors,\n        {\n            // NOTE: for now we just return the message and type \"Other\"\n            // but we could later introspect for HTTP or AGO errors\n            // and/or return the status code if available\n            type: \"Other\",\n            message,\n        },\n    ];\n};\n/**\n * Fetch enrichments for an item\n * @param item\n * @param enrichments the list of enrichments to fetch\n * @param requestOptions\n * @returns an object with the item and enrichments\n * @private\n */\nexport const fetchItemEnrichments = (item, enrichments, requestOptions) => {\n    // create a pipeline of enrichment operations\n    const operations = enrichments.reduce((ops, enrichment) => {\n        const operation = enrichmentOperations[enrichment];\n        // only include the enrichments that we know how to fetch\n        operation && ops.push(operation);\n        return ops;\n    }, []);\n    const pipeline = createOperationPipeline(operations);\n    // execute pipeline and return the item and enrichments\n    return pipeline({\n        data: { item },\n        stack: new OperationStack(),\n        requestOptions,\n    }).then((output) => {\n        // TODO: send telemetry so we have info on what enrichments are requested and possible errors\n        return output.data;\n    });\n};\n//# sourceMappingURL=_enrichments.js.map","import { getCollection, getCollectionTypes } from \"../collections\";\n// private helper functions\nfunction collectionToFamily(collection) {\n    const overrides = {\n        other: \"content\",\n        solution: \"template\",\n    };\n    return overrides[collection] || collection;\n}\n/**\n * return the Hub family given an item's type\n * @param type item type\n * @returns Hub family\n */\nexport function getFamily(type) {\n    let family;\n    // override default behavior for the rows that are highlighted in yellow here:\n    // https://esriis.sharepoint.com/:x:/r/sites/ArcGISHub/_layouts/15/Doc.aspx?sourcedoc=%7BADA1C9DC-4F6C-4DE4-92C6-693EF9571CFA%7D&file=Hub%20Routes.xlsx&nav=MTBfe0VENEREQzI4LUZFMDctNEI0Ri04NjcyLThCQUE2MTA0MEZGRn1fezIwMTIwMEJFLTA4MEQtNEExRC05QzA4LTE5MTAzOUQwMEE1RH0&action=default&mobileredirect=true&cid=df1c874b-c367-4cea-bc13-7bebfad3f2ac\n    switch (type.toLowerCase()) {\n        // NOTE: we really want to put tiled image services in the maps family\n        // but we would need the typekeywords to differentiate them\n        // for now send them to the maps route here:\n        // https://github.com/ArcGIS/opendata-ui/blob/cdc0dac6b7e8c43afaa60ae219393a7d3aaa7433/packages/ember-arcgis-hub-components/addon/utils/content-routes.js#L39-L44\n        case \"image service\":\n            family = \"dataset\";\n            break;\n        case \"feature service\":\n        case \"raster layer\":\n            // TODO: check if feature service has > 1 layer first?\n            family = \"map\";\n            break;\n        case \"microsoft excel\":\n            family = \"document\";\n            break;\n        case \"cad drawing\":\n        case \"feature collection template\":\n        case \"report template\":\n            family = \"content\";\n            break;\n        case \"hub project\":\n            family = \"project\";\n            break;\n        default:\n            // by default derive from collection\n            family = collectionToFamily(getCollection(type));\n    }\n    return family;\n}\n/**\n * return the types associated with a provided Hub Family\n * Overrides are provided to match getFamily implementation\n * @param type item type\n * @returns Hub family\n */\nexport function getFamilyTypes(family) {\n    let types;\n    // override default behavior for the rows that are highlighted in yellow here:\n    // https://esriis.sharepoint.com/:x:/r/sites/ArcGISHub/_layouts/15/Doc.aspx?sourcedoc=%7BADA1C9DC-4F6C-4DE4-92C6-693EF9571CFA%7D&file=Hub%20Routes.xlsx&nav=MTBfe0VENEREQzI4LUZFMDctNEI0Ri04NjcyLThCQUE2MTA0MEZGRn1fezIwMTIwMEJFLTA4MEQtNEExRC05QzA4LTE5MTAzOUQwMEE1RH0&action=default&mobileredirect=true&cid=df1c874b-c367-4cea-bc13-7bebfad3f2ac\n    switch (family.toLowerCase()) {\n        case \"content\":\n            types = getCollectionTypes(\"other\");\n            types = types.concat([\n                \"CAD Drawing\",\n                \"Feature Collection Template\",\n                \"Report Template\",\n            ]);\n            break;\n        case \"template\":\n            types = [\n                ...getCollectionTypes(\"template\"),\n                ...getCollectionTypes(\"solution\"),\n            ];\n            break;\n        case \"dataset\":\n            types = getCollectionTypes(family.toLowerCase()).filter((type) => type !== \"Feature Collection Template\" &&\n                // Changed as part of https://confluencewikidev.esri.com/x/KYJuDg\n                // Remove when reclassification has been completed\n                // type !== \"Feature Service\" &&\n                type !== \"Raster Layer\" &&\n                type !== \"Microsoft Excel\");\n            types = types.concat(\"Image Service\");\n            break;\n        case \"map\":\n            types = getCollectionTypes(family.toLowerCase()).filter((type) => type !== \"Image Service\");\n            types = types.concat([\n                // Changed as part of https://confluencewikidev.esri.com/x/KYJuDg\n                // Remove when reclassification has been completed\n                // \"Feature Service\",\n                \"Raster Layer\",\n            ]);\n            break;\n        case \"document\":\n            types = getCollectionTypes(family.toLowerCase()).filter((type) => type !== \"CAD Drawing\" && type !== \"Report Template\");\n            types = types.concat(\"Microsoft Excel\");\n            break;\n        case \"project\":\n            types = [\"Hub Project\"];\n            break;\n        default:\n            types = getCollectionTypes(family.toLowerCase());\n    }\n    return types;\n}\n//# sourceMappingURL=get-family.js.map","import { getItem } from \"@esri/arcgis-rest-portal\";\nimport { getFamily } from \"../content/get-family\";\nimport { getHubRelativeUrl } from \"../content/_internal\";\nimport { EntityResourceMap } from \"../core/types\";\nimport { PropertyMapper } from \"../core/_internal/PropertyMapper\";\nimport { getItemBySlug } from \"../items/slugs\";\nimport { fetchItemEnrichments } from \"../items/_enrichments\";\nimport { fetchModelFromItem, fetchModelResources } from \"../models\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { isGuid, mapBy } from \"../utils\";\nimport { computeProps } from \"./_internal/computeProps\";\nimport { getPropertyMap } from \"./_internal/getPropertyMap\";\nimport { unique } from \"../util\";\nimport { getProp } from \"../objects/get-prop\";\nimport { getItemThumbnailUrl } from \"../resources/get-item-thumbnail-url\";\nimport { getItemHomeUrl } from \"../urls/get-item-home-url\";\n/**\n * @private\n * Get a Hub Project by id or slug\n * @param identifier item id or slug\n * @param requestOptions\n */\nexport async function fetchProject(identifier, requestOptions) {\n    let getPrms;\n    if (isGuid(identifier)) {\n        // get item by id\n        getPrms = getItem(identifier, requestOptions);\n    }\n    else {\n        getPrms = getItemBySlug(identifier, requestOptions);\n    }\n    return getPrms.then((item) => {\n        if (!item)\n            return null;\n        return convertItemToProject(item, requestOptions);\n    });\n}\n/**\n * @private\n * Convert an Hub Project Item into a Hub Project, fetching any additional\n * information that may be required\n * @param item\n * @param auth\n * @returns\n */\nexport async function convertItemToProject(item, requestOptions) {\n    const model = await fetchModelFromItem(item, requestOptions);\n    // Fetch resources based on above obj\n    model.resources = await fetchModelResources(item, EntityResourceMap, requestOptions);\n    // TODO: In the future we will handle the boundary fetching from resource\n    const mapper = new PropertyMapper(getPropertyMap());\n    const prj = mapper.modelToObject(model, {});\n    return computeProps(model, prj, requestOptions);\n}\n/**\n * @private\n * Fetch project specific enrichments\n * @param item\n * @param include\n * @param requestOptions\n * @returns\n */\nexport async function enrichProjectSearchResult(item, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: item.access,\n        id: item.id,\n        type: item.type,\n        name: item.title,\n        owner: item.owner,\n        typeKeywords: item.typeKeywords,\n        tags: item.tags,\n        categories: item.categories,\n        summary: item.snippet || item.description,\n        createdDate: new Date(item.created),\n        createdDateSource: \"item.created\",\n        updatedDate: new Date(item.modified),\n        updatedDateSource: \"item.modified\",\n        family: getFamily(item.type),\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // default includes\n    const DEFAULTS = [];\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    if (enrichments.length) {\n        // TODO: Look into caching for the requests in fetchItemEnrichments\n        enriched = await fetchItemEnrichments(item, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    // Handle links\n    // TODO: Link handling should be an enrichment\n    result.links.thumbnail = getItemThumbnailUrl(item, requestOptions);\n    result.links.self = getItemHomeUrl(result.id, requestOptions);\n    result.links.siteRelative = getHubRelativeUrl(result.type, result.id, item.typeKeywords);\n    return result;\n}\n//# sourceMappingURL=fetch.js.map","import { removeItem } from \"@esri/arcgis-rest-portal\";\nimport { getFamily } from \"../content/get-family\";\nimport { fetchSiteModel } from \"./fetchSiteModel\";\nimport { PropertyMapper } from \"../core/_internal/PropertyMapper\";\nimport { handleDomainChanges } from \"./_internal\";\nimport { fetchItemEnrichments } from \"../items/_enrichments\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { getHubRelativeUrl } from \"../content/_internal\";\nimport { applyPermissionMigration } from \"./_internal/applyPermissionMigration\";\nimport { computeProps } from \"./_internal/computeProps\";\nimport { getPropertyMap } from \"./_internal/getPropertyMap\";\nimport { constructSlug, setSlugKeyword } from \"../items/slugs\";\nimport { slugify } from \"../utils/slugify\";\nimport { ensureUniqueDomainName } from \"./domains/ensure-unique-domain-name\";\nimport { stripProtocol } from \"../urls/strip-protocol\";\nimport { getHubApiUrl } from \"../api\";\nimport { getOrgDefaultTheme } from \"./themes\";\nimport { cloneObject, unique } from \"../util\";\nimport { createModel, fetchModelFromItem, getModel, updateModel, } from \"../models\";\nimport { registerSiteAsApplication } from \"./registerSiteAsApplication\";\nimport { addSiteDomains } from \"./domains/addSiteDomains\";\nimport { removeDomainsBySiteId } from \"./domains/remove-domains-by-site-id\";\nimport { mapBy } from \"../utils\";\nimport { getProp, setProp } from \"../objects\";\nimport { getItemThumbnailUrl } from \"../resources/get-item-thumbnail-url\";\nexport const HUB_SITE_ITEM_TYPE = \"Hub Site Application\";\nexport const ENTERPRISE_SITE_ITEM_TYPE = \"Site Application\";\n/**\n * Default values of a IHubSite\n */\nconst DEFAULT_SITE = {\n    name: \"No title provided\",\n    tags: [],\n    typeKeywords: [\"Hub Site\", \"hubSite\", \"DELETEMESITE\"],\n    classicCapabilities: [\n        \"api_explorer\",\n        \"pages\",\n        \"my_data\",\n        \"social_logins\",\n        \"json_chart_card\",\n        \"document_iframes\",\n        \"items_view\",\n        \"app_page\",\n        \"underlinedLinks\",\n        \"globalNav\",\n        \"socialSharing\",\n    ],\n    catalog: {\n        schemaVersion: 1,\n    },\n    subdomain: \"\",\n    defaultHostname: \"\",\n    customHostname: \"\",\n    clientId: \"\",\n    map: null,\n    feeds: {},\n    pages: [],\n    theme: null,\n    contentViews: {\n        sidePanelOpen: {\n            app: true,\n            map: true,\n            dataset: true,\n            document: true,\n            feedback: true,\n        },\n    },\n};\n/**\n * Default values for a new HubSite Model\n */\nconst DEFAULT_SITE_MODEL = {\n    item: {\n        // type: intentionally left out as we need to\n        // set that based on portal/enterprise\n        title: \"No Title Provided\",\n        description: \"No Description Provided\",\n        snippet: \"\",\n        tags: [],\n        typeKeywords: [\"Hub Site\", \"hubSite\", \"DELETEMESITE\"],\n        properties: {\n            slug: \"\",\n            orgUrlKey: \"\",\n            defaultHostname: \"\",\n            customHostname: \"\",\n            clientId: \"\",\n            subdomain: \"\",\n            schemaVersion: 1.5,\n        },\n        url: \"\",\n    },\n    data: {\n        catalog: {\n            groups: [],\n        },\n        feeds: {},\n        values: {\n            title: \"\",\n            defaultHostname: \"\",\n            customHostname: \"\",\n            subdomain: \"\",\n            faviconUrl: \"\",\n            uiVersion: \"2.4\",\n            clientId: \"\",\n            map: {\n                basemaps: {},\n            },\n            defaultExtent: {},\n            pages: [],\n            theme: {},\n            layout: {\n                sections: [],\n                header: {\n                    component: {\n                        name: \"site-header\",\n                        settings: {\n                            fullWidth: false,\n                            iframeHeight: \"150px\",\n                            iframeUrl: \"\",\n                            links: [],\n                            logoUrl: \"\",\n                            title: \"default site\",\n                            markdown: \"\",\n                            headerType: \"default\",\n                            schemaVersion: 3,\n                            showLogo: true,\n                            showTitle: true,\n                            logo: {\n                                display: {},\n                                state: \"valid\",\n                            },\n                            shortTitle: \"\",\n                            menuLinks: [],\n                            socialLinks: {\n                                facebook: {},\n                                twitter: {},\n                                instagram: {},\n                                youtube: {},\n                            },\n                        },\n                    },\n                    showEditor: false,\n                },\n                footer: {\n                    component: {\n                        name: \"site-footer\",\n                        settings: {\n                            footerType: \"none\",\n                            markdown: \"\",\n                            schemaVersion: 2.1,\n                        },\n                    },\n                    showEditor: false,\n                },\n            },\n            contentViews: {\n                sidePanelOpen: {\n                    app: true,\n                    map: true,\n                    dataset: true,\n                    document: true,\n                    feedback: true,\n                },\n            },\n        },\n    },\n};\n// TODO: Add OperationStack & Error Handling\n/**\n * Create a new Hub Site\n *\n * Minimum properties are `name` and `org`\n * @param partialSite\n * @param requestOptions\n */\nexport async function createSite(partialSite, requestOptions) {\n    const site = Object.assign(Object.assign({}, DEFAULT_SITE), partialSite);\n    const portal = requestOptions.portalSelf;\n    // Set the type based on the environment we are working in\n    site.type = requestOptions.isPortal\n        ? ENTERPRISE_SITE_ITEM_TYPE\n        : HUB_SITE_ITEM_TYPE;\n    // Create a slug from the title if one is not passed in\n    if (!site.slug) {\n        site.slug = constructSlug(site.name, site.orgUrlKey);\n    }\n    // Ensure slug is  unique\n    // site.slug = await getUniqueSlug({ slug: site.slug }, requestOptions);\n    // add slug to keywords\n    site.typeKeywords = setSlugKeyword(site.typeKeywords, site.slug);\n    if (!site.subdomain) {\n        site.subdomain = slugify(site.name);\n    }\n    site.subdomain = await ensureUniqueDomainName(site.subdomain, requestOptions);\n    // Domains\n    if (!requestOptions.isPortal) {\n        // now that we know the subdomain is available, set the defaultHostname\n        site.defaultHostname = `${site.subdomain}-${portal.urlKey}.${stripProtocol(getHubApiUrl(requestOptions))}`;\n        // set the url\n        site.url = `https://${site.customHostname ? site.customHostname : site.defaultHostname}`;\n    }\n    else {\n        // Portal Sites use subdomain in hash based router\n        site.typeKeywords.push(`hubsubdomain|${site.subdomain}`.toLowerCase());\n        site.url = `${requestOptions.authentication.portal.replace(`/sharing/rest`, `/apps/sites`)}/#/${site.subdomain}`;\n    }\n    // Note:  We used to use adlib for this, but it's much harder to\n    // use templates with typescript. i.e. you can't assign a string template\n    // to a property defined as `IExtent` without using `as unknown as ...`\n    // which basically removes typechecking\n    site.orgUrlKey = portal.urlKey;\n    // override only if not set...\n    if (!site.theme) {\n        site.theme = getOrgDefaultTheme(portal);\n    }\n    if (!site.defaultExtent) {\n        site.defaultExtent = portal.defaultExtent;\n    }\n    if (!site.culture) {\n        site.culture = portal.culture;\n    }\n    // pull the basemap from portalSelf\n    if (!getProp(site, \"map.basemaps.primary\")) {\n        setProp(\"map.basemaps.primary\", portal.defaultBasemap, site);\n    }\n    // Put the title into the header\n    if (!getProp(site, \"layout.header.component.settings.title\")) {\n        setProp(\"layout.header.component.settings.title\", site.name, site);\n    }\n    // Now convert the IHubSite into an IModel\n    const mapper = new PropertyMapper(getPropertyMap());\n    let model = mapper.objectToModel(site, cloneObject(DEFAULT_SITE_MODEL));\n    // create the backing item\n    model = await createModel(model, requestOptions);\n    // Register as an app\n    const registration = await registerSiteAsApplication(model, requestOptions);\n    model.data.values.clientId = registration.client_id;\n    // Register domains\n    await addSiteDomains(model, requestOptions);\n    // update the model\n    const updatedModel = await updateModel(model, requestOptions);\n    // convert the model into a IHubSite and return\n    return mapper.modelToObject(updatedModel, {});\n}\n/**\n * Update a Hub Site\n *\n * This checks for and applies domain changes\n * @param site\n * @param requestOptions\n * @returns\n */\nexport async function updateSite(site, requestOptions) {\n    // Most of this work is done with an IModel, so first thing it to\n    // convert IHubSite to model\n    const mapper = new PropertyMapper(getPropertyMap());\n    // applying the site onto the default model ensures that a minimum\n    // set of properties exist, regardless what may have been done to\n    // the site pojo\n    const updatedModel = mapper.objectToModel(site, cloneObject(DEFAULT_SITE_MODEL));\n    // Fetch backing model from the portal\n    const currentModel = await getModel(site.id, requestOptions);\n    // handle any domain changes\n    await handleDomainChanges(updatedModel, currentModel, requestOptions);\n    if (updatedModel.item.properties.slug !== currentModel.item.properties.slug) {\n        // ensure slug to keywords\n        updatedModel.item.typeKeywords = setSlugKeyword(updatedModel.item.typeKeywords, updatedModel.item.properties.slug);\n    }\n    // merge the updated site onto the current model\n    const modelToStore = mapper.objectToModel(site, currentModel);\n    // update the model\n    const updatedSiteModel = await updateModel(modelToStore, requestOptions);\n    // fetch updated model\n    const updatedSite = mapper.modelToObject(updatedSiteModel, site);\n    return updatedSite;\n}\n/**\n * @private\n * Remove a Hub Site\n *\n * This simply removes the Site item, and it's associated domain records.\n * This does not remove any Teams/Groups or content associated with the\n * Site\n * @param id\n * @param requestOptions\n * @returns\n */\nexport async function destroySite(id, requestOptions) {\n    // tslint:disable-next-line:no-console\n    console.warn(`destroySite is deprecated, use deleteSite instead`);\n    return deleteSite(id, requestOptions);\n}\n/**\n * Remove a Hub Site\n *\n * This simply removes the Site item, and it's associated domain records.\n * This does not remove any Teams/Groups or content associated with the\n * Site\n * @param id\n * @param requestOptions\n * @returns\n */\nexport async function deleteSite(id, requestOptions) {\n    // For AGO we need to remove the domain records for the site\n    if (!requestOptions.isPortal) {\n        await removeDomainsBySiteId(id, requestOptions);\n    }\n    // now we can remove the item\n    const ro = Object.assign(Object.assign({}, requestOptions), { id });\n    await removeItem(ro);\n    return;\n}\n/**\n * Returns site model given various kinds of identifier\n *\n * @param identifier - a site item ID, site hostname, enterprise site slug, or full site URL\n * @param requestOptions\n * @private // remove when we remove existing fetchSite function\n */\nexport async function fetchSite(identifier, requestOptions) {\n    // get the model\n    const model = await fetchSiteModel(identifier, requestOptions);\n    // convert to IHubSite\n    return convertModelToSite(model, requestOptions);\n}\n/**\n * Convert an IModel for a Hub Site Item into an IHubSite\n * @param model\n * @param requestOptions\n * @returns\n */\nexport function convertModelToSite(model, requestOptions) {\n    // Add permissions based on Groups\n    // This may get moved to a formal schema migration in the future but for now\n    // we can do it here as there is no ux for managing permissions yet.\n    const modelWithPermissions = applyPermissionMigration(model);\n    // convert to site\n    const mapper = new PropertyMapper(getPropertyMap());\n    const site = mapper.modelToObject(modelWithPermissions, {});\n    // compute additional properties\n    return computeProps(model, site, requestOptions);\n}\n/**\n * Convert a Hub Site Application item into a Hub Site, fetching any\n * additional information that may be required\n * @param item\n * @param auth\n * @returns\n */\nexport async function convertItemToSite(item, requestOptions) {\n    const model = await fetchModelFromItem(item, requestOptions);\n    return convertModelToSite(model, requestOptions);\n}\n/**\n * Fetch Site specific enrichments\n * @param item\n * @param include\n * @param requestOptions\n * @returns\n */\nexport async function enrichSiteSearchResult(item, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: item.access,\n        id: item.id,\n        type: item.type,\n        name: item.title,\n        owner: item.owner,\n        typeKeywords: item.typeKeywords,\n        tags: item.tags,\n        categories: item.categories,\n        summary: item.snippet || item.description,\n        createdDate: new Date(item.created),\n        createdDateSource: \"item.created\",\n        updatedDate: new Date(item.modified),\n        updatedDateSource: \"item.modified\",\n        family: getFamily(item.type),\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // default includes\n    const DEFAULTS = [];\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    if (enrichments.length) {\n        // TODO: Look into caching for the requests in fetchItemEnrichments\n        enriched = await fetchItemEnrichments(item, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    // Handle links\n    result.links.thumbnail = getItemThumbnailUrl(item, requestOptions);\n    result.links.self = item.url;\n    result.links.siteRelative = getHubRelativeUrl(result.type, result.id, item.typeKeywords);\n    return result;\n}\n//# sourceMappingURL=HubSites.js.map","/**\n * Use this module for functions that do not need to be used by consumers (yet),\n * but may be shared between hub.js modules, and/or need to be tested\n * to get 100% coverage w/o writing cumbersome tests of higher level functions.\n *\n * Consuming will not be able to import these functions.\n *\n * It's probably a good pattern to add functions here first and then\n * move them to index.ts only when they are needed by a consumer.\n */\nimport { parseServiceUrl } from \"@esri/arcgis-rest-feature-layer\";\nimport { PublisherSource } from \"../core\";\nimport { bBoxToExtent, extentToBBox, extentToPolygon, getExtentCenter, isBBox, } from \"../extent\";\nimport { getFamily } from \"./get-family\";\nimport { getProp } from \"../objects\";\n/**\n * Create a new content with updated boundary properties\n * @param content original content\n * @param boundary boundary provenance\n * @returns\n * @private\n */\nexport const setContentBoundary = (content, boundary) => {\n    // update content's item and boundary\n    const properties = Object.assign(Object.assign({}, (content.item.properties || {})), { boundary });\n    const item = Object.assign(Object.assign({}, content.item), { properties });\n    const updated = Object.assign(Object.assign({}, content), { item });\n    return Object.assign(Object.assign({}, updated), { boundary: getContentBoundary(item) });\n};\n/**\n * get a content's boundary based on the item's boundary property\n * @param item\n * @returns\n * @private\n */\nexport const getContentBoundary = (item) => {\n    var _a;\n    const bBox = item.extent;\n    const isValidItemExtent = isBBox(bBox);\n    // user specified provenance is stored in item.properties\n    const provenance = ((_a = item.properties) === null || _a === void 0 ? void 0 : _a.boundary) ||\n        // but we default to item if the item has an extent\n        (isValidItemExtent ? \"item\" : undefined);\n    const boundary = {\n        geometry: null,\n        provenance,\n    };\n    if (provenance === \"item\" && isValidItemExtent) {\n        const extent = bBoxToExtent(bBox);\n        const center = getExtentCenter(extent);\n        boundary.center = [center.x, center.y];\n        boundary.geometry = Object.assign(Object.assign({}, extentToPolygon(extent)), { type: \"polygon\" });\n        boundary.spatialReference = boundary.geometry.spatialReference;\n    }\n    return boundary;\n};\n/**\n * Determine if we are in an enterprise environment\n * NOTE: when no request options are provided, the underlying\n * request functions assume that we are online in production\n * so we only want use enterprise logic if isPortal is explicitly defined\n * @param requestOptions\n * @returns\n * @private\n */\nexport const isPortal = (requestOptions) => {\n    return requestOptions && requestOptions.isPortal;\n};\n/**\n * Determine if we can use the Hub API for an item, i.e.\n * the item is public and we are not in an enterprise environment\n * @param item\n * @param requestOptions\n * @returns\n * @private\n */\nexport const canUseHubApiForItem = (item, requestOptions) => {\n    return !!item && item.access === \"public\" && !isPortal(requestOptions);\n};\n/**\n * Returns whether or not an item is a proxied csv\n *\n * @param item\n * @param requestOptions Hub Request Options (including whether we're in portal)\n * @returns\n * @private\n */\nexport const isProxiedCSV = (item, requestOptions) => !isPortal(requestOptions) &&\n    item.access === \"public\" &&\n    item.type === \"CSV\" &&\n    item.size <= 5000000;\n/**\n * Get the relative URL to use for the item in a hub site\n * @param type\n * @param identifier\n * @param typeKeywords\n * @returns\n * @private\n */\nexport const getHubRelativeUrl = (type, identifier, typeKeywords) => {\n    // solution types have their own logic\n    let contentUrl = getSolutionUrl(type, identifier, typeKeywords) ||\n        getInitiativeTemplateUrl(type, identifier, typeKeywords);\n    if (!contentUrl) {\n        const family = getFamily(type);\n        const familiesWithPluralizedRoute = [\n            \"app\",\n            \"dataset\",\n            \"document\",\n            \"map\",\n            \"template\",\n            \"project\",\n        ];\n        // default to the catchall content route\n        let path = \"/content\";\n        if (family === \"feedback\") {\n            // the exception\n            path = \"/feedback/surveys\";\n        }\n        else if (isPageType(type, typeKeywords)) {\n            // pages are in the document family,\n            // but instead of showing the page's metadata on /documents/about\n            // but we render the page on the pages route\n            path = \"/pages\";\n        }\n        else if (familiesWithPluralizedRoute.indexOf(family) > -1) {\n            // the rule: route name is plural of family name\n            path = `/${family}s`;\n        }\n        contentUrl = `${path}/${identifier}`;\n    }\n    return contentUrl;\n};\n/**\n * Is this content type a page?\n * @param type\n * @returns\n * @private\n */\nexport const isPageType = (type, typeKeywords = []) => [\"Hub Page\", \"Site Page\"].includes(type) || typeKeywords.includes(\"hubPage\");\nconst getSolutionUrl = (type, identifier, typeKeywords) => {\n    let hubUrl;\n    if (type === \"Solution\") {\n        // solution types are now in the Template family\n        // we send all except the deployed solution items to the route for initiative templates\n        if ((typeKeywords === null || typeKeywords === void 0 ? void 0 : typeKeywords.indexOf(\"Deployed\")) > -1) {\n            // deployed solutions go to the generic content route\n            hubUrl = `/content/${identifier}/about`;\n        }\n        else {\n            hubUrl = `/templates/${identifier}/about`;\n        }\n    }\n    else if (type === \"Web Mapping Application\" &&\n        (typeKeywords === null || typeKeywords === void 0 ? void 0 : typeKeywords.indexOf(\"hubSolutionTemplate\")) > -1) {\n        hubUrl = `/templates/${identifier}/about`;\n    }\n    return hubUrl;\n};\nconst getInitiativeTemplateUrl = (type, identifier, typeKeywords) => {\n    if ((type === \"Hub Initiative\" &&\n        (typeKeywords === null || typeKeywords === void 0 ? void 0 : typeKeywords.indexOf(\"hubInitiativeTemplate\")) > -1) ||\n        type === \"Hub Initiative Template\") {\n        return `/initiatives/templates/${identifier}/about`;\n    }\n};\n/**\n * Get the path to a well known metadata value\n * @param identifier identifier for well known metadata value\n * @returns path to be used like get(metadata, path)\n * @private\n */\nexport function getMetadataPath(identifier) {\n    // NOTE: i have verified that this will work regardless of the \"Metadata Style\" set on the org\n    const metadataPaths = {\n        updateFrequency: \"metadata.dataIdInfo.resMaint.maintFreq.MaintFreqCd.@_value\",\n        reviseDate: \"metadata.dataIdInfo.idCitation.date.reviseDate\",\n        pubDate: \"metadata.dataIdInfo.idCitation.date.pubDate\",\n        createDate: \"metadata.dataIdInfo.idCitation.date.createDate\",\n        metadataUpdateFrequency: \"metadata.mdMaint.maintFreq.MaintFreqCd.@_value\",\n        metadataUpdatedDate: \"metadata.mdDateSt\",\n    };\n    return metadataPaths[identifier];\n}\n/**\n * Get a well known value from metadata\n * @param metadata\n * @param identifier identifier for well known metadata value\n * @returns\n * @private\n */\nexport function getValueFromMetadata(metadata, identifier) {\n    const path = getMetadataPath(identifier);\n    return path && getProp(metadata, path);\n}\n/**\n * Date precisions\n */\nexport var DatePrecision;\n(function (DatePrecision) {\n    DatePrecision[\"Year\"] = \"year\";\n    DatePrecision[\"Month\"] = \"month\";\n    DatePrecision[\"Day\"] = \"day\";\n    DatePrecision[\"Time\"] = \"time\";\n})(DatePrecision || (DatePrecision = {}));\n/**\n * Parses an ISO8601 date string into a date and a precision.\n * This is because a) if somone entered 2018, we want to respect that and not treat it as the same as 2018-01-01\n * and b) you cannot naively call new Date with an ISO 8601 string that does not include time information\n * For example, when I, here in mountain time, do new Date('2018').getFullYear() I get \"2017\".\n * This is because when you do not provide time or timezone info, UTC is assumed, so new Date('2018') is 2018-01-01T00:00:00 in UTC\n * which is actually 7 hours earlier here in mountain time.\n *\n * @param {string} isoString\n * @return { date: Date, precision: DatePrecision }\n * @private\n */\nexport function parseISODateString(isoString) {\n    isoString = `${isoString}`;\n    let date;\n    let precision;\n    if (/^\\d{4}$/.test(isoString)) {\n        // yyyy\n        date = new Date(+isoString, 0, 1);\n        precision = DatePrecision.Year;\n    }\n    else if (/^\\d{4}-\\d{1,2}$/.test(isoString)) {\n        // yyyy-mm\n        const parts = isoString.split(\"-\");\n        date = new Date(+parts[0], +parts[1] - 1, 1);\n        precision = DatePrecision.Month;\n    }\n    else if (/^\\d{4}-\\d{1,2}-\\d{1,2}$/.test(isoString)) {\n        // yyyy-mm-dd\n        const parts = isoString.split(\"-\");\n        date = new Date(+parts[0], +parts[1] - 1, +parts[2]);\n        precision = DatePrecision.Day;\n    }\n    else if (!Number.isNaN(Date.parse(isoString))) {\n        // any other string parsable to a valid date\n        date = new Date(isoString);\n        precision = isoString.includes(\"T\")\n            ? DatePrecision.Time\n            : DatePrecision.Day;\n    }\n    return date && precision && { date, precision };\n}\n// NOTE: IItem has spatialRefernce: ISpatialReference, but\n// the portal REST API returns spatialReference as as string\n// that is always either WKID like \"102100\" or the name of a\n// WKT like \"NAD_1983_HARN_StatePlane_Hawaii_3_FIPS_5103_Feet\".\n// We only coerce WKIDs into a ISpatialReference objects since we\n// can't easily lookup a complete WKT.\n/**\n * Get the spatial reference as an object for an item\n * @param item\n * @returns spatial reference object\n * @private\n */\nexport const getItemSpatialReference = (item) => {\n    const spatialReference = item.spatialReference;\n    if (!spatialReference || typeof spatialReference === \"object\") {\n        // no need to try and transform this into an ISpatialReference\n        return spatialReference;\n    }\n    // otherwise it _should_ be a string (if coming form the REST API)\n    // but we force it in case it was set to a number somewhere outside of TS\n    const spatialReferenceString = spatialReference + \"\";\n    const wkid = parseInt(spatialReferenceString, 10);\n    return isNaN(wkid)\n        ? // It looks like the portal api returns the name of a WKT, but we'd\n            // need to perform a lookup to get the full WKT. Return null for now.\n            null\n        : //\n            { wkid };\n};\n/**\n * Extracts additional resources from the provided metadata\n * and transforms them into a hub-friendly format.\n *\n * Returns null if no resources are available\n *\n * @param item\n * @param metadata formal metadata\n * @returns\n * @private\n */\nexport const getAdditionalResources = (item, metadata, requestOptions) => {\n    const rawResources = extractRawResources(metadata);\n    return (rawResources &&\n        rawResources.map((resource) => ({\n            name: resource.orName,\n            url: getAdditionalResourceUrl(resource, item, requestOptions),\n            isDataSource: isDataSourceOfItem(resource, item),\n        })));\n};\n/**\n * @private\n *\n * Extracts additional resources from formal item metadata.\n * If none are available, null is returned.\n *\n * @param metadata the formal item metadata\n * @returns an array of all additional resources, or null\n */\nexport const extractRawResources = (metadata) => {\n    const rawResources = [];\n    // The property path to additional resources should be fairly simple.\n    // In many cases, it's just `metadata.metadata.distInfo.distTranOps.onLineSrc`.\n    // However, since `distInfo`, `distTranOps` and `onLineSrc` can be either\n    // Objects OR Arrays, we have to do all this looping.\n    castToArray(getProp(metadata, \"metadata.distInfo\") || []).forEach((distInfo) => {\n        castToArray(distInfo.distTranOps || []).forEach((distTranOps) => {\n            castToArray(distTranOps.onLineSrc || []).forEach((onLineSrc) => {\n                rawResources.push(onLineSrc);\n            });\n        });\n    });\n    return rawResources.length ? rawResources : null;\n};\n/**\n * @private\n *\n * Arrays are returned as-is.\n * Objects are wrapped into a 1 element array.\n *\n * @param objectOrArray\n * @returns the casted array\n */\nconst castToArray = (objectOrArray) => {\n    return Array.isArray(objectOrArray) ? objectOrArray : [objectOrArray];\n};\n/**\n * Determines whether a raw additional resource (i.e. extracted out of formal\n * metadata with no transformation) references the underlying service that backs\n * the item.\n *\n * @param resource raw additional resource of an item\n * @param item\n * @returns\n * @private\n */\nexport const isDataSourceOfItem = (resource, item) => {\n    const serviceUrl = item.url && parseServiceUrl(item.url);\n    return (serviceUrl && resource.linkage && resource.linkage.includes(serviceUrl));\n};\n/**\n * Returns the url for an additional resource.\n *\n * Automatically appends auth token if token is available\n * and resource points to the backing service of an item.\n *\n * @param resource raw additional resource of an item\n * @param item\n * @param requestOptions IHubRequestOptions, including authentication\n * @returns\n * @private\n */\nexport const getAdditionalResourceUrl = (resource, item, requestOptions) => {\n    let result = resource.linkage;\n    const token = getProp(requestOptions, \"authentication.token\");\n    if (token && isDataSourceOfItem(resource, item)) {\n        const resUrl = new URL(resource.linkage);\n        const params = new URLSearchParams(resUrl.search);\n        params.set(\"token\", token);\n        resUrl.search = params.toString();\n        result = resUrl.toString();\n    }\n    return result;\n};\n/**\n * @private\n *\n * Contains fallback logic for determining a content's extent.\n *\n * The fallback priority is as follows:\n * 1) item's extent (if valid bbox)\n * 2) extent enrichment from the hub api (if coordinates are valid bbox)\n * 3) layer's extent (if spatial reference is 4326)\n *\n * If none of these conditions are met, undefined is returned.\n *\n * @param item\n * @param layer\n * @param extentEnrichment\n * @returns the correct extent in a bbox format, or undefined\n */\nexport const determineExtent = (item, extentEnrichment, layer) => {\n    const itemExtent = isBBox(item.extent) ? item.extent : undefined;\n    const extentEnrichmentCoordinates = isBBox(extentEnrichment === null || extentEnrichment === void 0 ? void 0 : extentEnrichment.coordinates)\n        ? extentEnrichment.coordinates\n        : undefined;\n    const layerExtent = getProp(layer, \"extent.spatialReference.wkid\") === 4326\n        ? extentToBBox(layer.extent)\n        : undefined;\n    return itemExtent || extentEnrichmentCoordinates || layerExtent;\n};\n/**\n * @private\n *\n * Extracts the first contact from a given formal item metadata path.\n * This is particularly helpful if the contact path is either an object or an array.\n *\n * Note: the raw contact object must have the following properties:\n * - `rpIndName`: name of the individual\n * - `rpOrgName`: name of the individual's organization\n *\n * @param metadata formal item metadata\n * @param path path to the contact object/array\n * @returns\n */\nexport const extractFirstContact = (metadata, path) => {\n    const rawContacts = getProp(metadata, path) || {};\n    const { rpIndName, rpOrgName } = Array.isArray(rawContacts)\n        ? rawContacts[0]\n        : rawContacts;\n    return { individualName: rpIndName, organizationName: rpOrgName };\n};\n/**\n * Determines the correct orgId for an item.\n * Note: it's undocumented, but the portal API will return orgId for items... sometimes.\n *\n * @param item\n * @param ownerUser item owner's hydrated user object\n */\nexport const getItemOrgId = (item, ownerUser) => item.orgId || (ownerUser === null || ownerUser === void 0 ? void 0 : ownerUser.orgId);\n/**\n * Calculates the Publisher display info for the given item.\n * Utilizes this fallback pattern:\n * 1) Formal Item Metadata > Resource > Citation > Contact\n * 2) Formal Item Metadata > Resource > Contact\n * 3) Items Owner and Org Name\n * 4) Undefined (Item Owner / Org are private and we can't access additional info)\n *\n * @param item\n * @param metadata\n * @param org portal info of the item's organization\n * @param ownerUser the item owner's hydrated user\n * @returns\n */\nexport const getPublisherInfo = (item, metadata, org, ownerUser) => {\n    const result = {\n        nameSource: PublisherSource.None,\n        organizationSource: PublisherSource.None,\n    };\n    const citationContact = extractFirstContact(metadata, \"metadata.dataIdInfo.idCitation.citRespParty\");\n    const resourceContact = extractFirstContact(metadata, \"metadata.dataIdInfo.idPoC\");\n    const metadataContact = extractFirstContact(metadata, \"metadata.mdContact\");\n    // Determine publisher name properties\n    const ownerFullName = getProp(ownerUser, \"fullName\");\n    if (citationContact.individualName) {\n        result.name = citationContact.individualName;\n        result.nameSource = PublisherSource.CitationContact;\n    }\n    else if (resourceContact.individualName) {\n        result.name = resourceContact.individualName;\n        result.nameSource = PublisherSource.ResourceContact;\n    }\n    else if (metadataContact.individualName) {\n        result.name = metadataContact.individualName;\n        result.nameSource = PublisherSource.MetadataContact;\n    }\n    else if (ownerFullName) {\n        result.name = ownerFullName;\n        result.username = ownerUser.username;\n        result.nameSource = PublisherSource.ItemOwner;\n    }\n    // Determine publisher org properties\n    const orgName = getProp(org, \"name\");\n    if (citationContact.organizationName) {\n        result.organization = citationContact.organizationName;\n        result.organizationSource = PublisherSource.CitationContact;\n    }\n    else if (resourceContact.organizationName) {\n        result.organization = resourceContact.organizationName;\n        result.organizationSource = PublisherSource.ResourceContact;\n    }\n    else if (metadataContact.organizationName) {\n        result.organization = metadataContact.organizationName;\n        result.organizationSource = PublisherSource.MetadataContact;\n    }\n    else if (orgName) {\n        result.organization = orgName;\n        result.orgId = getItemOrgId(item, ownerUser);\n        result.organizationSource = PublisherSource.ItemOwner;\n    }\n    // We assume the item belongs to external org if no org info is available and the item is private\n    result.isExternal =\n        result.organizationSource === PublisherSource.None &&\n            item.access !== \"public\";\n    return result;\n};\n//# sourceMappingURL=_internal.js.map","import { getHubApiUrl } from \"./api\";\nimport { buildUrl } from \"./urls/build-url\";\n/**\n * remote server error\n */\nexport class RemoteServerError extends Error {\n    constructor(message, url, status) {\n        super(message);\n        this.status = status;\n        this.url = url;\n    }\n}\n/**\n * ```js\n * import { hubApiRequest } from \"@esri/hub-common\";\n * //\n * hubApiRequest(\n *   \"/datasets\",\n *   requestOptions\n * })\n *   .then(response);\n * ```\n * make a request to the Hub API\n * @param route API route\n * @param requestOptions request options\n */\nexport function hubApiRequest(route, requestOptions) {\n    // merge in default request options\n    const options = Object.assign({ \n        // why do we default to GET w/ our API?\n        httpMethod: \"GET\" }, requestOptions);\n    // use fetch override if any\n    const _fetch = options.fetch || fetch;\n    // merge in default headers\n    const headers = Object.assign({ \"Content-Type\": \"application/json\" }, options.headers);\n    // build query params/body based on requestOptions.params\n    let query;\n    let body;\n    if (options.httpMethod === \"GET\") {\n        // pass params in query string\n        query = options.params;\n    }\n    else {\n        // pass params in request body\n        body = JSON.stringify(options.params);\n    }\n    // build Hub API URL\n    const url = buildUrl({\n        host: getHubApiUrl(options),\n        path: `/api/v3/${route}`.replace(/\\/\\//g, \"/\"),\n        query,\n    });\n    return _fetch(url, {\n        method: options.httpMethod,\n        headers,\n        body,\n    }).then((resp) => {\n        if (resp.ok) {\n            return resp.json();\n        }\n        else {\n            throw new RemoteServerError(resp.statusText, url, resp.status);\n        }\n    });\n}\n//# sourceMappingURL=request.js.map","import { fetchItemEnrichments } from \"../items/_enrichments\";\nimport { getProp } from \"../objects\";\nimport { getItemThumbnailUrl } from \"../resources\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { getItemHomeUrl } from \"../urls\";\nimport { unique } from \"../util\";\nimport { mapBy } from \"../utils\";\nimport { getFamily } from \"./get-family\";\nimport { getHubRelativeUrl } from \"./_internal\";\n/**\n * Enrich a generic search result\n * @param item\n * @param includes\n * @param requestOptions\n * @returns\n */\nexport async function enrichContentSearchResult(item, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: item.access,\n        id: item.id,\n        type: item.type,\n        name: item.title,\n        owner: item.owner,\n        tags: item.tags,\n        typeKeywords: item.typeKeywords,\n        categories: item.categories,\n        summary: item.snippet || item.description,\n        createdDate: new Date(item.created),\n        createdDateSource: \"item.created\",\n        updatedDate: new Date(item.modified),\n        updatedDateSource: \"item.modified\",\n        family: getFamily(item.type),\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // default includes\n    const DEFAULTS = [];\n    // Add any type-specific defaults here\n    // if ([\"Map Service\", \"Feature Service\"].includes(item.type)) {\n    //   DEFAULTS = [\"server.layers.length AS layerCount\"];\n    // }\n    // if (item.type === \"Web Map\") {\n    //   DEFAULTS = [\"data.operationalLayers.length AS layerCount\"];\n    // }\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    if (enrichments.length) {\n        enriched = await fetchItemEnrichments(item, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    // Handle links\n    // TODO: Link handling should be an enrichment\n    result.links.thumbnail = getItemThumbnailUrl(item, requestOptions);\n    result.links.self = getItemHomeUrl(result.id, requestOptions);\n    result.links.siteRelative = getHubRelativeUrl(result.type, result.id, item.typeKeywords);\n    return result;\n}\n//# sourceMappingURL=HubContent.js.map","import { searchGroupContent, searchGroupUsers, } from \"@esri/arcgis-rest-portal\";\nimport { getEnrichmentErrors } from \"../../items/_enrichments\";\nimport OperationStack from \"../../OperationStack\";\nimport { createOperationPipeline } from \"../../utils\";\n/**\n * Fetch the count of items shared to the group.\n * This is done by searching for content in the group\n * and using the returned `total` value\n * @param input\n * @returns\n */\nconst enrichGroupContentCount = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichGroupContentCount\");\n    // w/o the : any here, I get a compile error about\n    // .authentication being incompatible w/ UserSession\n    const options = Object.assign({ groupId: data.group.id, num: 1 }, requestOptions);\n    return searchGroupContent(options)\n        .then((results) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), { contentCount: results.total }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\n/**\n * Create a summary of the Group membership by searching for members,\n * limiting to three for a sample, and using the `total`.\n * @param input\n * @returns\n */\nconst enrichGroupMembershipSummary = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichGroupContentCount\");\n    // w/o the `: any` here, I get a compile error about\n    // .authentication being incompatible w/ UserSession\n    const options = Object.assign({ num: 3 }, requestOptions);\n    return searchGroupUsers(data.group.id, options)\n        .then((results) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), {\n                membershipSummary: { total: results.total, users: results.users },\n            }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\n// add the error to the content.errors,\n// log current stack operation as finished with an error\n// and return output that can be piped into the next operation\nconst handleEnrichmentError = (error, input, opId) => {\n    const { data, stack, requestOptions } = input;\n    stack.finish(opId, { error });\n    return {\n        data: Object.assign(Object.assign({}, data), { errors: getEnrichmentErrors(error, data.errors) }),\n        stack,\n        requestOptions,\n    };\n};\n/**\n * Available enrichments for Groups\n */\nconst groupEnrichementOperations = {\n    membershipSummary: enrichGroupMembershipSummary,\n    contentCount: enrichGroupContentCount,\n};\n/**\n * Fetch enrichments for Groups\n * @param group\n * @param enrichments\n * @param requestOptions\n * @returns\n */\nexport function fetchGroupEnrichments(group, enrichments, requestOptions) {\n    // create a pipeline of enrichment operations\n    const operations = enrichments.reduce((ops, enrichment) => {\n        const operation = groupEnrichementOperations[enrichment];\n        // only include the enrichments that we know how to fetch\n        operation && ops.push(operation);\n        return ops;\n    }, []);\n    const pipeline = createOperationPipeline(operations);\n    // execute pipeline and return the item and enrichments\n    return pipeline({\n        data: { group },\n        stack: new OperationStack(),\n        requestOptions,\n    }).then((output) => {\n        // TODO: send telemetry so we have info on what enrichments are requested and possible errors\n        return output.data;\n    });\n}\n//# sourceMappingURL=enrichments.js.map","/* Copyright (c) 2018-2021 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { UserSession } from \"@esri/arcgis-rest-auth\";\nimport { cloneObject } from \"../util\";\n/**\n * Well known APIs\n * Short-forms for specifying common APIs\n * We will likely deprecate this\n */\nexport const SEARCH_APIS = {\n    arcgis: {\n        label: \"ArcGIS Online\",\n        url: \"https://www.arcgis.com\",\n        type: \"arcgis\",\n    },\n    arcgisQA: {\n        label: \"ArcGIS Online QAEXT\",\n        url: \"https://qaext.arcgis.com\",\n        type: \"arcgis\",\n    },\n    arcgisDEV: {\n        label: \"ArcGIS Online DEVEXT\",\n        url: \"https://devext.arcgis.com\",\n        type: \"arcgis\",\n    },\n    hub: {\n        label: \"ArcGIS Hub\",\n        url: \"https://hub.arcgis.com/api\",\n        type: \"arcgis-hub\",\n    },\n    hubDEV: {\n        label: \"ArcGIS Hub DEV\",\n        url: \"https://hubdev.arcgis.com/api\",\n        type: \"arcgis-hub\",\n    },\n    hubQA: {\n        label: \"ArcGIS Hub QA\",\n        url: \"https://hubqa.arcgis.com/api\",\n        type: \"arcgis-hub\",\n    },\n};\n/**\n * @private\n * Convert array of api \"names\" into full ApiDefinitions\n * @param apis\n * @returns\n */\nexport function expandApis(apis) {\n    return apis.map(expandApi);\n}\n/**\n * @private\n * Convert an api \"name\" into a full ApiDefinition\n * @param api\n * @returns\n */\nexport function expandApi(api) {\n    if (typeof api === \"string\" && api in SEARCH_APIS) {\n        return SEARCH_APIS[api];\n    }\n    else {\n        // it's an object, so we trust that it's well formed\n        return api;\n    }\n}\n/**\n * @private\n * Convert a field value into a MatchOptions if it's not already one\n * @param value\n * @returns\n */\nexport function valueToMatchOptions(value) {\n    let result = {};\n    if (Array.isArray(value)) {\n        result = {\n            any: value,\n        };\n    }\n    else {\n        if (typeof value === \"string\") {\n            result = {\n                any: [value],\n            };\n        }\n        if (typeof value === \"object\") {\n            result = value;\n        }\n    }\n    return result;\n}\n/**\n * @private\n * Convert a RelativeDate to a DateRange<number>\n * @param relative\n * @returns\n */\nexport function relativeDateToDateRange(relative) {\n    // hash of offsets\n    const offsetMs = {\n        min: 1000 * 60,\n        hours: 1000 * 60 * 60,\n        days: 1000 * 60 * 60 * 24,\n        weeks: 1000 * 60 * 60 * 24 * 7,\n    };\n    const now = new Date();\n    // default\n    const result = {\n        type: \"date-range\",\n        from: now.getTime(),\n        to: now.getTime(),\n    };\n    //\n    switch (relative.unit) {\n        case \"hours\":\n        case \"days\":\n        case \"weeks\":\n            result.from = result.to - offsetMs[relative.unit] * relative.num;\n            break;\n        case \"months\":\n            // get the current month and subtract num\n            // NOTE: when the previous month has fewer days than this month\n            // setMonth() will return a date w/in the current month\n            // example: 3/30 -> 3/2 b/c there is no 2/28\n            now.setMonth(now.getMonth() - relative.num);\n            result.from = now.getTime();\n            break;\n        case \"years\":\n            now.setFullYear(now.getFullYear() - relative.num);\n            result.from = now.getTime();\n            break;\n    }\n    return result;\n}\n/**\n * Create a `.next()` function for a type\n * @param request\n * @param nextStart\n * @param total\n * @param fn\n * @returns\n */\nexport function getNextFunction(request, nextStart, total, fn) {\n    const clonedRequest = cloneObject(request);\n    // clone will not handle authentication so we do it manually\n    if (request.authentication) {\n        clonedRequest.authentication = UserSession.deserialize(request.authentication.serialize());\n    }\n    // figure out the start\n    clonedRequest.start = nextStart > -1 ? nextStart : total + 1;\n    return (authentication) => {\n        if (authentication) {\n            clonedRequest.authentication = authentication;\n        }\n        return fn(clonedRequest);\n    };\n}\n/**\n * Construct a the full url to a group thumbnail\n *\n * - If the group has a thumbnail, construct the full url\n * - If the group is not public, append on the token (if passed in)\n * @param portalUrl\n * @param group\n * @param token\n * @returns\n */\nexport function getGroupThumbnailUrl(portalUrl, group, token) {\n    let thumbnailUrl = null;\n    if (group.thumbnail) {\n        thumbnailUrl = `${portalUrl}/community/groups/${group.id}/info/${group.thumbnail}`;\n        if (token && group.access !== \"public\") {\n            thumbnailUrl = `${thumbnailUrl}?token=${token}`;\n        }\n    }\n    return thumbnailUrl;\n}\n/**\n * Construct a the full url to a user thumbnail\n *\n * - If the user has a thumbnail, construct the full url\n * - If the user is not public, append on the token\n * @param portalUrl\n * @param user\n * @param token\n * @returns\n */\nexport function getUserThumbnailUrl(portalUrl, user, token) {\n    let thumbnailUrl = null;\n    if (user.thumbnail) {\n        thumbnailUrl = `${portalUrl}/community/users/${user.username}/info/${user.thumbnail}`;\n        if (token && user.access !== \"public\") {\n            thumbnailUrl = `${thumbnailUrl}?token=${token}`;\n        }\n    }\n    return thumbnailUrl;\n}\n//# sourceMappingURL=utils.js.map","import { getProp, setProp } from \"../../objects\";\nimport { cloneObject } from \"../../util\";\nimport { relativeDateToDateRange, valueToMatchOptions } from \"../utils\";\n/**\n * @private\n * Expand a predicate\n * @param predicate\n * @returns\n */\nexport function expandPredicate(predicate) {\n    const result = {};\n    const dateProps = [\"created\", \"modified\", \"lastlogin\"];\n    const copyProps = [\n        \"filterType\",\n        \"categoriesAsParam\",\n        \"categoryFilter\",\n        \"term\",\n        \"searchUserAccess\",\n        \"isopendata\",\n        \"searchUserName\",\n    ];\n    const nonMatchOptionsFields = [...dateProps, ...copyProps];\n    // Do the conversion\n    Object.entries(predicate).forEach(([key, value]) => {\n        // Handle MatchOptions fields\n        if (!nonMatchOptionsFields.includes(key)) {\n            setProp(key, valueToMatchOptions(value), result);\n        }\n        // Handle Date fields\n        if (dateProps.includes(key)) {\n            const dateFieldValue = cloneObject(getProp(predicate, key));\n            if (getProp(predicate, `${key}.type`) === \"relative-date\") {\n                setProp(key, relativeDateToDateRange(dateFieldValue), result);\n            }\n            else {\n                setProp(key, dateFieldValue, result);\n            }\n        }\n        // Handle fields that are just copied forward\n        if (copyProps.includes(key) && predicate.hasOwnProperty(key)) {\n            setProp(key, value, result);\n        }\n    });\n    return result;\n}\n//# sourceMappingURL=expandPredicate.js.map","import { expandPredicate } from \"./_internal/expandPredicate\";\n/**\n * Serialize IQuery into ISearchOptions for ArcGIS Portal\n * @param query\n * @returns\n */\nexport function serializeQueryForPortal(query) {\n    const filterSearchOptions = query.filters.map(serializeFilter);\n    // remove any empty entries\n    const nonEmptyOptions = filterSearchOptions.filter(removeEmptyEntries);\n    const result = mergeSearchOptions(nonEmptyOptions, \"AND\");\n    return result;\n}\n/**\n * Predicate to remove things from array\n * @param e\n * @returns\n */\nfunction removeEmptyEntries(e) {\n    return !(typeof e === \"undefined\" || e === null || e === \"\");\n}\nfunction mergeSearchOptions(options, operation) {\n    const result = options.reduce((acc, entry) => {\n        // walk the props\n        Object.entries(entry).forEach(([key, value]) => {\n            // if prop exists and is not empty string\n            if (acc[key] && value !== \"\") {\n                // combine via operation\n                acc[key] = `${acc[key]} ${operation} ${value}`;\n            }\n            else {\n                // just copy the value if it's not empty string\n                if (value !== \"\") {\n                    acc[key] = value;\n                }\n            }\n        });\n        return acc;\n    }, { q: \"\" });\n    return result;\n}\n/**\n * Serialize the filters in a FitlerGroup into a Portal Query\n * @param filter\n * @returns\n */\nfunction serializeFilter(filter) {\n    const operation = filter.operation || \"AND\";\n    const predicates = filter.predicates.map(expandPredicate);\n    const predicateSearchOptions = predicates\n        .map(serializePredicate)\n        .filter((e) => e !== undefined && e !== null);\n    // combine these searchOptions\n    const searchOptions = mergeSearchOptions(predicateSearchOptions, operation);\n    // wrap in parens if we have more than one predicate\n    if (predicates.length > 1) {\n        searchOptions.q = `(${searchOptions.q})`;\n    }\n    return searchOptions;\n}\n/**\n * Serialize a Filter into a Portal Query\n * @param predicate\n * @returns\n */\nfunction serializePredicate(predicate) {\n    const dateProps = [\"created\", \"modified\"];\n    const boolProps = [\"isopendata\"];\n    const passThroughProps = [\n        \"searchUserAccess\",\n        \"searchUserName\",\n        \"categoriesAsParam\",\n        \"categoryFilter\",\n    ];\n    const specialProps = [\n        \"filterType\",\n        \"term\",\n        ...dateProps,\n        ...boolProps,\n        ...passThroughProps,\n    ];\n    const portalAllowList = [\n        \"access\",\n        \"capabilities\",\n        \"created\",\n        \"categories\",\n        \"categoriesAsParam\",\n        \"categoryFilter\",\n        \"description\",\n        \"disabled\",\n        \"email\",\n        \"emailstatus\",\n        \"firstname\",\n        \"fullname\",\n        \"group\",\n        \"id\",\n        \"isInvitationOnly\",\n        \"isopendata\",\n        \"joined\",\n        \"lastlogin\",\n        \"lastname\",\n        \"memberType\",\n        \"modified\",\n        \"name\",\n        \"orgid\",\n        \"orgIds\",\n        \"owner\",\n        \"provider\",\n        \"role\",\n        \"searchUserAccess\",\n        \"searchUserName\",\n        \"snippet\",\n        \"tags\",\n        \"term\",\n        \"title\",\n        \"type\",\n        \"typekeywords\",\n        \"userlicensetype\",\n        \"username\",\n    ];\n    // TODO: Look at using reduce vs .map and remove the `.filter`\n    const opts = Object.entries(predicate)\n        .map(([key, value]) => {\n        // When serializing for portal we limit predicate properties to\n        // a list of known properties that the portal api accepts. This will\n        // not attempt to ensure the properties are used in the correct combinations\n        if (portalAllowList.includes(key)) {\n            const so = { q: \"\" };\n            if (!specialProps.includes(key) && key !== \"term\") {\n                so.q = serializeMatchOptions(key, value);\n            }\n            if (dateProps.includes(key)) {\n                so.q = serializeDateRange(key, value);\n            }\n            if (boolProps.includes(key)) {\n                so.q = `${key}:${value}`;\n            }\n            if (passThroughProps.includes(key)) {\n                so[key] = value;\n            }\n            if (key === \"term\") {\n                so.q = value;\n            }\n            return so;\n        }\n    })\n        .filter(removeEmptyEntries);\n    // merge up all the searchOptions\n    if (opts.length) {\n        const searchOptions = mergeSearchOptions(opts, \"AND\");\n        if (searchOptions.q) {\n            searchOptions.q = `(${searchOptions.q})`;\n        }\n        return searchOptions;\n    }\n    else {\n        return null;\n    }\n}\n/**\n * Serialize MatchOptions into portal syntax\n * @param key\n * @param value\n * @returns\n */\nfunction serializeMatchOptions(key, value) {\n    let result = \"\";\n    if (value.any) {\n        result = `${serializeStringOrArray(\"OR\", key, value.any)}`;\n    }\n    if (value.all) {\n        result =\n            (result ? result + \" AND \" : \"\") +\n                `${serializeStringOrArray(\"AND\", key, value.all)}`;\n    }\n    if (value.not) {\n        // negate the entries if they are not\n        result =\n            (result ? result + \" AND \" : \"\") +\n                `${serializeStringOrArray(\"OR\", `-${key}`, value.not)}`;\n    }\n    return result;\n}\n/**\n * Serialize a date-range into Portal syntax\n * @param key\n * @param range\n * @returns\n */\nfunction serializeDateRange(key, range) {\n    return `${key}:[${range.from} TO ${range.to}]`;\n}\n/**\n * Serialize a `string` or `string[]` into a string\n * @param join\n * @param key\n * @param value\n * @returns\n */\nfunction serializeStringOrArray(join, key, value) {\n    let q = \"\";\n    if (Array.isArray(value)) {\n        q = `${key}:\"${value.join(`\" ${join} ${key}:\"`)}\"`;\n        if (value.length > 1) {\n            q = `(${q})`;\n        }\n    }\n    else {\n        q = `${key}:\"${value}\"`;\n    }\n    return q;\n}\n//# sourceMappingURL=serializeQueryForPortal.js.map","import { getFamily } from \"../content\";\nimport { getHubRelativeUrl } from \"../content/_internal\";\nimport { fetchItemEnrichments } from \"../items/_enrichments\";\nimport { getProp } from \"../objects\";\nimport { getItemThumbnailUrl } from \"../resources\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { getItemHomeUrl } from \"../urls\";\nimport { unique } from \"../util\";\nimport { mapBy } from \"../utils\";\n/**\n * Fetch Page specific Enrichments\n * @param item\n * @param include\n * @param requestOptions\n * @returns\n */\nexport async function enrichPageSearchResult(item, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: item.access,\n        id: item.id,\n        type: item.type,\n        name: item.title,\n        owner: item.owner,\n        typeKeywords: item.typeKeywords,\n        tags: item.tags,\n        categories: item.categories,\n        summary: item.snippet || item.description,\n        createdDate: new Date(item.created),\n        createdDateSource: \"item.created\",\n        updatedDate: new Date(item.modified),\n        updatedDateSource: \"item.modified\",\n        family: getFamily(item.type),\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // default includes\n    const DEFAULTS = [];\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    if (enrichments.length) {\n        // TODO: Look into caching for the requests in fetchItemEnrichments\n        enriched = await fetchItemEnrichments(item, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    // Handle Links\n    result.links.thumbnail = getItemThumbnailUrl(item, requestOptions);\n    result.links.self = getItemHomeUrl(result.id, requestOptions);\n    result.links.siteRelative = getHubRelativeUrl(result.type, result.id, item.typeKeywords);\n    return result;\n}\n//# sourceMappingURL=HubPages.js.map","/**\n * @private\n * Convert a portal aggregation structure into the HubAggregations structure\n * @param searchResults\n * @returns\n */\nexport function convertPortalAggregations(searchResults) {\n    var _a;\n    if ((_a = searchResults.aggregations) === null || _a === void 0 ? void 0 : _a.counts) {\n        return searchResults.aggregations.counts.map((entry) => {\n            return {\n                mode: \"terms\",\n                field: entry.fieldName,\n                values: entry.fieldValues,\n            };\n        });\n    }\n    else {\n        return [];\n    }\n}\n//# sourceMappingURL=portalSearchUtils.js.map","import { searchItems } from \"@esri/arcgis-rest-portal\";\nimport { serializeQueryForPortal } from \"../serializeQueryForPortal\";\nimport { enrichPageSearchResult } from \"../../pages/HubPages\";\nimport { enrichProjectSearchResult } from \"../../projects\";\nimport { enrichSiteSearchResult } from \"../../sites\";\nimport { getNextFunction } from \"../utils\";\nimport { convertPortalAggregations } from \"./portalSearchUtils\";\nimport { expandPredicate } from \"./expandPredicate\";\nimport HubError from \"../../HubError\";\nimport { enrichContentSearchResult } from \"../../content\";\nimport { cloneObject } from \"../../util\";\n/**\n * @private\n * Portal Search Implementation for Items\n * @param query\n * @param options\n * @returns\n */\nexport async function portalSearchItems(query, options) {\n    var _a;\n    if (!options.requestOptions) {\n        throw new HubError(\"portalSearchItems\", \"options.requestOptions is required.\");\n    }\n    // Expand well-known filterGroups\n    const updatedQuery = applyWellKnownItemPredicates(query);\n    // Expand the individual predicates in each filter\n    updatedQuery.filters = updatedQuery.filters.map((filter) => {\n        filter.predicates = filter.predicates.map(expandPredicate);\n        return filter;\n    });\n    // Serialize the all the groups for portal\n    const so = serializeQueryForPortal(updatedQuery);\n    // Array of properties we want to copy from IHubSearchOptions to the ISearchOptions\n    const props = [\n        \"num\",\n        \"sortField\",\n        \"sortOrder\",\n        \"include\",\n        \"start\",\n        \"requestOptions\",\n    ];\n    // copy the props over\n    props.forEach((prop) => {\n        if (options.hasOwnProperty(prop)) {\n            so[prop] = options[prop];\n        }\n    });\n    if (options.requestOptions.authentication) {\n        so.authentication = options.requestOptions.authentication;\n    }\n    else {\n        so.portal = options.requestOptions.portal;\n    }\n    // Aggregations\n    if ((_a = options.aggFields) === null || _a === void 0 ? void 0 : _a.length) {\n        so.countFields = options.aggFields.join(\",\");\n        so.countSize = options.aggLimit || 10;\n    }\n    return searchPortal(so);\n}\n/**\n * Internal portal search, which then converts `IItem`s to `IHubSearchResult`s\n * handling enrichments & includes along the way\n *\n * @param searchOptions\n * @returns\n */\nasync function searchPortal(searchOptions) {\n    // Execute portal search\n    const resp = await searchItems(searchOptions);\n    // create mappable fn that will handle the includes\n    const fn = (item) => {\n        return itemToSearchResult(item, searchOptions.includes, searchOptions.requestOptions);\n    };\n    // map over results\n    const results = await Promise.all(resp.results.map(fn));\n    // convert portal  aggregations into hub aggregations\n    const aggregations = convertPortalAggregations(resp);\n    // Construct the return\n    return {\n        total: resp.total,\n        results,\n        aggregations,\n        hasNext: resp.nextStart > -1,\n        next: getNextFunction(searchOptions, resp.nextStart, resp.total, searchPortal),\n    };\n}\n/**\n * Convert an `IItem` to a `IHubSearchResult`\n * Fetches the enrichments, and attaches them as directed in the `include` list\n * @param item\n * @param includes\n * @param requestOptions\n * @returns\n */\nexport async function itemToSearchResult(item, includes = [], requestOptions) {\n    // based on the type, we delegate to type-specific functions\n    // this allows each type to apply \"default\" enrichments\n    let fn = enrichContentSearchResult;\n    switch (item.type) {\n        case \"Hub Site Application\":\n        case \"Site Application\":\n            fn = enrichSiteSearchResult;\n            break;\n        case \"Hub Page\":\n        case \"Site Page\":\n            fn = enrichPageSearchResult;\n            break;\n        case \"Hub Project\":\n            fn = enrichProjectSearchResult;\n            break;\n        // handle old hub sites\n        case \"Web Mapping Application\":\n            if (item.typeKeywords.includes(\"hubSite\")) {\n                fn = enrichSiteSearchResult;\n            }\n            break;\n    }\n    return fn(item, includes, requestOptions);\n}\nexport const WellKnownItemPredicates = {\n    $application: [\n        {\n            type: {\n                any: [\n                    \"Web Mapping Application\",\n                    \"Application\",\n                    \"Insights\",\n                    \"Web Experience\",\n                ],\n                not: [\"Insights Theme\", \"Insights Model\"],\n            },\n            typekeywords: {\n                not: [\"hubSite\", \"Story Map\"],\n            },\n        },\n        {\n            type: \"Web Mapping Experience\",\n            typekeywords: \"EXB Experience\",\n        },\n    ],\n    $dashboard: [\n        {\n            type: {\n                any: [\"Dashboard\"],\n                not: [\"Operation View\"],\n            },\n            typekeywords: {\n                not: [\"Extension\", \"ArcGIS Operation View\"],\n            },\n        },\n    ],\n    $dataset: [\n        {\n            type: {\n                any: [\n                    \"Scene Service\",\n                    \"Feature Collection\",\n                    \"Route Layer\",\n                    \"Layer\",\n                    \"Explorer Layer\",\n                    \"Tile Package\",\n                    \"Vector Tile Package\",\n                    \"Scene Package\",\n                    \"Layer Package\",\n                    \"Feature Service\",\n                    \"Stream Service\",\n                    \"Map Service\",\n                    \"Vector Tile Service\",\n                    \"Image Service\",\n                    \"WMS\",\n                    \"WFS\",\n                    \"WMTS\",\n                    \"KML\",\n                    \"KML Collection\",\n                    \"Globe Service\",\n                    \"CSV\",\n                    \"Shapefile\",\n                    \"GeoJson\",\n                    \"Service Definition\",\n                    \"File Geodatabase\",\n                    \"CAD Drawing\",\n                    \"Relational Database Connection\",\n                ],\n                not: [\"Web Mapping Application\", \"Geodata Service\"],\n            },\n        },\n        {\n            typekeywords: [\"OGC\", \"Geodata Service\"],\n        },\n    ],\n    $document: [\n        {\n            type: [\n                \"PDF\",\n                \"Microsoft Excel\",\n                \"Microsoft Word\",\n                \"Microsoft Powerpoint\",\n                \"iWork Keynote\",\n                \"iWork Pages\",\n                \"iWork Numbers\",\n                \"Visio Document\",\n                \"Document Link\",\n            ],\n        },\n    ],\n    $initiative: [\n        {\n            type: \"Hub Initiative\",\n        },\n    ],\n    $experience: [\n        {\n            type: \"Web Experience\",\n        },\n    ],\n    $feedback: [\n        {\n            type: \"Form\",\n        },\n    ],\n    $page: [\n        {\n            typekeywords: \"hubPage\",\n        },\n    ],\n    $site: [\n        {\n            type: [\"Hub Site Application\", \"Site Application\"],\n        },\n    ],\n    $storymap: [\n        {\n            type: \"Storymap\",\n        },\n        {\n            type: \"Web Mapping Application\",\n            typekeywords: \"Story Map\",\n        },\n    ],\n    $template: [\n        {\n            type: [\n                \"Web Mapping Application\",\n                \"Hub Initiative\",\n                \"Hub Initiative Template\",\n                \"Solution\",\n            ],\n            typekeywords: {\n                any: [\"hubInitiativeTemplate\", \"hubSolutionTemplate\", \"Template\"],\n                not: \"Deployed\",\n            },\n        },\n    ],\n    $webmap: [\n        {\n            type: {\n                any: [\"Web Map\", \"Web Scene\"],\n                not: \"Web Mapping Application\",\n            },\n        },\n    ],\n};\n/**\n * @private\n * Convert a Filter Group to expand well-known type filters\n *\n * The purpose of this function is to allow for the use of short-hand\n * names for commonly used, complex queries.\n *\n * It works by looking for filters using the .type property, the value\n * of which is a key in the WellKnownItemFilters hash. If found in the\n * hash, the filters array of the active filterGroup is replaced with the\n * filters specified in the hash.\n *\n * NOTE: Any other properties specified in a filter will be removed\n *\n * Only exported to enable extensive testing\n * @param filterGroups\n */\nexport function applyWellKnownItemPredicates(query) {\n    const queryClone = cloneObject(query);\n    // iterate the filters\n    queryClone.filters = queryClone.filters.map((filter) => {\n        // replace predicates with well-known types\n        let replacedPredicates = false;\n        filter.predicates = filter.predicates.reduce((acc, predicate) => {\n            // if the predicate has a well-known type\n            // we replace it with the set of predicates defined\n            // for the well-known type\n            if (isWellKnownTypeFilter(predicate.type)) {\n                const replacements = lookupTypePredicates(predicate.type);\n                acc = [...acc, ...replacements];\n                replacedPredicates = true;\n            }\n            else {\n                // this predicate does not have a well-known type\n                // so we just keep it\n                acc.push(predicate);\n            }\n            return acc;\n        }, []);\n        if (replacedPredicates) {\n            // Any filter who's predicates were replaced with\n            // well-known predicates, needs to use \"OR\" to ensure\n            // correct query logic\n            filter.operation = \"OR\";\n        }\n        return filter;\n    });\n    return queryClone;\n}\n/**\n * Is the argument a well-known type \"key\"\n *\n * Accepts `string`, `string[]` or `IMatchOptions`\n * but only string values can possibly be keys\n * on `WellKnownItemFilters`\n * @param key\n * @returns\n */\nexport function isWellKnownTypeFilter(key) {\n    let result = false;\n    if (typeof key === \"string\") {\n        result = key in WellKnownItemPredicates;\n    }\n    return result;\n}\n/**\n * Return the predicates for a well-known type\n * @param key\n * @returns\n */\nfunction lookupTypePredicates(key) {\n    return WellKnownItemPredicates[key];\n}\n//# sourceMappingURL=portalSearchItems.js.map","export function formatOgcAggregationsResponse(response) {\n    const aggregations = response.aggregations.aggregations.map((ogcAgg) => ({\n        // What should it really be?\n        mode: \"terms\",\n        field: ogcAgg.field,\n        values: ogcAgg.aggregations.map((a) => ({\n            // Not confusing at all, right? Just some differences in terminology\n            value: a.label,\n            count: a.value,\n        })),\n    }));\n    return {\n        total: 0,\n        results: [],\n        hasNext: false,\n        next: () => null,\n        aggregations,\n    };\n}\n//# sourceMappingURL=formatOgcAggregationsResponse.js.map","import { getProp } from \"../../../objects/get-prop\";\nexport function getOgcAggregationQueryParams(_query, options) {\n    // TODO: use options.aggLimit once the OGC API supports it\n    const aggregations = `terms(fields=(${options.aggFields.join()}))`;\n    // TODO: Use `query` to filter aggregations once the OGC API supports it\n    const token = getProp(options, \"requestOptions.authentication.token\");\n    return { aggregations, token };\n}\n//# sourceMappingURL=getOgcAggregationQueryParams.js.map","export function getQueryString(queryParams) {\n    const result = Object.entries(queryParams)\n        .filter(([_key, value]) => !!value)\n        .map(([key, value]) => `${key}=${value}`)\n        .join(\"&\");\n    return result && `?${result}`;\n}\n//# sourceMappingURL=getQueryString.js.map","import { RemoteServerError } from \"../../../request\";\nimport { getQueryString } from \"./getQueryString\";\nexport async function ogcApiRequest(url, queryParams, options) {\n    var _a;\n    // use fetch override if any\n    const _fetch = ((_a = options.requestOptions) === null || _a === void 0 ? void 0 : _a.fetch) || fetch;\n    const withQueryString = url + getQueryString(queryParams);\n    const response = await _fetch(withQueryString, { method: \"GET\" });\n    if (!response.ok) {\n        throw new RemoteServerError(response.statusText, withQueryString, response.status);\n    }\n    return response.json();\n}\n//# sourceMappingURL=ogcApiRequest.js.map","import { formatOgcAggregationsResponse } from \"./formatOgcAggregationsResponse\";\nimport { getOgcAggregationQueryParams } from \"./getOgcAggregationQueryParams\";\nimport { ogcApiRequest } from \"./ogcApiRequest\";\nexport async function searchOgcAggregations(query, options) {\n    const apiDefinition = options.api;\n    const url = `${apiDefinition.url}/aggregations`;\n    const queryParams = getOgcAggregationQueryParams(query, options);\n    const rawResponse = await ogcApiRequest(url, queryParams, options);\n    return formatOgcAggregationsResponse(rawResponse);\n}\n//# sourceMappingURL=searchOgcAggregations.js.map","import { searchOgcItems } from \"./searchOgcItems\";\nexport function getNextOgcCallback(response, originalQuery, originalOptions) {\n    const nextLink = response.links.find((l) => l.rel === \"next\");\n    let callback = () => null;\n    if (nextLink) {\n        callback = () => {\n            const nextUrl = new URL(nextLink.href);\n            const start = +nextUrl.searchParams.get(\"startindex\");\n            const nextOptions = Object.assign(Object.assign({}, originalOptions), { start });\n            return searchOgcItems(originalQuery, nextOptions);\n        };\n    }\n    return callback;\n}\n//# sourceMappingURL=getNextOgcCallback.js.map","import { itemToSearchResult } from \"../portalSearchItems\";\nexport function ogcItemToSearchResult(ogcItem, includes, requestOptions) {\n    // OGC Api stuffs the item wholesale in  `.properties`\n    // NOTE: the properties hash may also have some extraneous members such\n    // as `license` and `source` if the OgcItem came from the index.\n    const pseudoItem = ogcItem.properties;\n    return itemToSearchResult(pseudoItem, includes, requestOptions);\n}\n//# sourceMappingURL=ogcItemToSearchResult.js.map","import { getNextOgcCallback } from \"./getNextOgcCallback\";\nimport { ogcItemToSearchResult } from \"./ogcItemToSearchResult\";\nexport async function formatOgcItemsResponse(response, originalQuery, originalOptions) {\n    const formattedResults = await Promise.all(response.features.map((f) => ogcItemToSearchResult(f, originalOptions.include, originalOptions.requestOptions)));\n    const next = getNextOgcCallback(response, originalQuery, originalOptions);\n    const nextLink = response.links.find((l) => l.rel === \"next\");\n    return {\n        total: response.numberMatched,\n        results: formattedResults,\n        hasNext: !!nextLink,\n        next,\n    };\n}\n//# sourceMappingURL=formatOgcItemsResponse.js.map","export function getFilterQueryParam(query) {\n    return (query.filters\n        .map(formatFilterBlock)\n        // TODO: this a bandaid fix, remove once q can be passed into the filter query string\n        .filter((f) => f !== \"()\")\n        .join(\" AND \"));\n}\nexport function formatFilterBlock(filter) {\n    const operation = filter.operation || \"OR\";\n    const formatted = filter.predicates\n        .map(formatPredicate)\n        // TODO: this a bandaid fix, remove once q can be passed into the filter query string\n        .filter((p) => p !== \"()\")\n        .join(` ${operation} `);\n    return `(${formatted})`;\n}\nexport function formatPredicate(predicate) {\n    const formatted = Object.entries(predicate)\n        // Remove predicates that use `term` (handled in `getQQueryParam`) and undefined entries\n        .filter(([field, value]) => field !== \"term\" && !!value)\n        // Create sections for each field\n        .reduce((acc, [field, value]) => {\n        let section;\n        if (typeof value === \"string\") {\n            section = formatSimpleComparison(field, value);\n        }\n        else if (Array.isArray(value)) {\n            section = formatMultiStringPredicate(field, value);\n        }\n        else if (isDateRange(value)) {\n            section = formatDateRangePredicate(field, value);\n        }\n        else {\n            section = formatComplexPredicate(field, value);\n        }\n        acc.push(section);\n        return acc;\n    }, [])\n        // AND together all field requirements\n        .join(\" AND \");\n    return `(${formatted})`;\n}\nfunction isDateRange(x) {\n    return Number.isInteger(x.from) && Number.isInteger(x.to);\n}\nfunction formatDateRangePredicate(field, value) {\n    return `${field} BETWEEN ${value.from} AND ${value.to}`;\n}\nfunction formatSimpleComparison(field, value) {\n    return `${field}=${maybeAddSingleQuotes(value)}`;\n}\nfunction formatMultiStringPredicate(field, values) {\n    const wrappedValues = values.map(maybeAddSingleQuotes);\n    return `${field} IN (${wrappedValues.join(\", \")})`;\n}\nfunction formatComplexPredicate(field, value) {\n    const anys = formatAnys(field, value.any);\n    const alls = formatAlls(field, value.all);\n    const nots = formatNots(field, value.not);\n    return [anys, alls, nots].filter((subsection) => !!subsection).join(\" AND \");\n}\nfunction formatAnys(field, value) {\n    let result;\n    if (Array.isArray(value)) {\n        const wrappedValues = value.map(maybeAddSingleQuotes);\n        result = `${field} IN (${wrappedValues.join(\", \")})`;\n    }\n    else if (value) {\n        result = formatSimpleComparison(field, value);\n    }\n    return result;\n}\nfunction formatAlls(field, value) {\n    let result;\n    if (Array.isArray(value)) {\n        result = value\n            .map((v) => formatSimpleComparison(field, v))\n            .join(\" AND \");\n    }\n    else if (value) {\n        result = formatSimpleComparison(field, value);\n    }\n    return result;\n}\nfunction formatNots(field, value) {\n    let result;\n    if (value) {\n        const valueAsArray = Array.isArray(value) ? value : [value];\n        const wrappedValues = valueAsArray.map(maybeAddSingleQuotes);\n        result = `${field} NOT IN (${wrappedValues.join(\", \")})`;\n    }\n    return result;\n}\nfunction maybeAddSingleQuotes(value) {\n    const whitespaceRegex = /\\s/;\n    return whitespaceRegex.test(value) ? `'${value}'` : value;\n}\n//# sourceMappingURL=getFilterQueryParam.js.map","// TODO: the 'q' query param logic is only here because the\n// OGC API currently has a bug where 'q' cannot be included\n// in the 'filter' string. Once that bug is resolved, rip this\n// logic out and let predicates with 'term' to be processed\n// normally\nexport function getQQueryParam(query) {\n    const qFilters = query.filters.filter((f) => {\n        return f.predicates.find((p) => !!p.term);\n    });\n    const qPredicate = getQPredicate(qFilters);\n    return qPredicate === null || qPredicate === void 0 ? void 0 : qPredicate.term;\n}\nexport function getQPredicate(filters) {\n    let result;\n    if (filters.length > 1) {\n        throw new Error(`IQuery can only have 1 IFilter with a 'term' predicate but ${filters.length} were detected`);\n    }\n    if (filters.length) {\n        const filter = filters[0];\n        const qPredicates = filter.predicates.filter((p) => !!p.term);\n        if (qPredicates.length > 1) {\n            throw new Error(`IQuery can only have 1 'term' predicate but ${qPredicates.length} were detected`);\n        }\n        if (filter.operation !== \"AND\" && filter.predicates.length > 1) {\n            throw new Error(`'term' predicates cannot be OR'd to other predicates`);\n        }\n        const qPredicate = qPredicates[0];\n        if (typeof qPredicate.term !== \"string\") {\n            throw new Error(`'term' predicate must have a string value, string[] and IMatchOptions are not allowed.`);\n        }\n        result = qPredicate;\n    }\n    return result;\n}\n//# sourceMappingURL=getQQueryParam.js.map","import { getProp } from \"../../../objects/get-prop\";\nimport { getFilterQueryParam } from \"./getFilterQueryParam\";\nimport { getQQueryParam } from \"./getQQueryParam\";\nexport function getOgcItemQueryParams(query, options) {\n    const filter = getFilterQueryParam(query);\n    const token = getProp(options, \"requestOptions.authentication.token\");\n    const limit = options.num;\n    // API requires the param name be all lowercase\n    const startindex = options.start;\n    const q = getQQueryParam(query);\n    return { filter, token, limit, startindex, q };\n}\n//# sourceMappingURL=getOgcItemQueryParams.js.map","import { formatOgcItemsResponse } from \"./formatOgcItemsResponse\";\nimport { getOgcItemQueryParams } from \"./getOgcItemQueryParams\";\nimport { ogcApiRequest } from \"./ogcApiRequest\";\nexport async function searchOgcItems(query, options) {\n    const apiDefinition = options.api;\n    const url = `${apiDefinition.url}/items`;\n    const queryParams = getOgcItemQueryParams(query, options);\n    const rawResponse = await ogcApiRequest(url, queryParams, options);\n    return formatOgcItemsResponse(rawResponse, query, options);\n}\n//# sourceMappingURL=searchOgcItems.js.map","import { searchOgcAggregations } from \"./hubSearchItemsHelpers/searchOgcAggregations\";\nimport { searchOgcItems } from \"./hubSearchItemsHelpers/searchOgcItems\";\n/**\n * @private\n * Execute item search against the Hub API\n * @param query\n * @param options\n * @returns\n */\nexport async function hubSearchItems(query, options) {\n    var _a;\n    if (!options.useBeta) {\n        throw new Error(\"Not implemented\");\n    }\n    return ((_a = options.aggFields) === null || _a === void 0 ? void 0 : _a.length) ? searchOgcAggregations(query, options)\n        : searchOgcItems(query, options);\n}\n//# sourceMappingURL=hubSearchItems.js.map","import { searchGroups } from \"@esri/arcgis-rest-portal\";\nimport { enrichGroupSearchResult } from \"../../groups/HubGroups\";\nimport HubError from \"../../HubError\";\nimport { serializeQueryForPortal } from \"../serializeQueryForPortal\";\nimport { getNextFunction } from \"../utils\";\nimport { expandPredicate } from \"./expandPredicate\";\n/**\n * @private\n * Portal Search Implementation for Groups\n * @param query\n * @param options\n * @returns\n */\nexport async function portalSearchGroups(query, options) {\n    if (!options.requestOptions) {\n        throw new HubError(\"portalSearchGroups\", \"options.requestOptions is required.\");\n    }\n    // Expand the individual predicates in each filter\n    query.filters = query.filters.map((filter) => {\n        filter.predicates = filter.predicates.map(expandPredicate);\n        return filter;\n    });\n    // Serialize the all the groups for portal\n    const so = serializeQueryForPortal(query);\n    // Array of properties we want to copy from IHubSearchOptions to the ISearchOptions\n    const props = [\n        \"num\",\n        \"sortField\",\n        \"sortOrder\",\n        \"include\",\n        \"start\",\n        \"requestOptions\",\n    ];\n    // copy the props over\n    props.forEach((prop) => {\n        if (options.hasOwnProperty(prop)) {\n            so[prop] = options[prop];\n        }\n    });\n    // If we don't have auth, ensure we have .portal\n    if (options.requestOptions.authentication) {\n        so.authentication = options.requestOptions.authentication;\n    }\n    else {\n        so.portal = options.requestOptions.portal;\n    }\n    return searchPortal(so);\n}\n/**\n * Internal portal search, which then converts `IGroup`s to `IHubSearchResult`s\n * handling enrichments & includes along the way\n *\n * @param searchOptions\n * @returns\n */\nasync function searchPortal(searchOptions) {\n    // Execute portal search\n    const resp = await searchGroups(searchOptions);\n    // create mappable fn that will close\n    // over the includes and requestOptions\n    const fn = (item) => {\n        return groupToSearchResult(item, searchOptions.include, searchOptions.requestOptions);\n    };\n    // map over results\n    const results = await Promise.all(resp.results.map(fn));\n    // Group Search does not support aggregations\n    // Construct the return\n    return {\n        total: resp.total,\n        results,\n        hasNext: resp.nextStart > -1,\n        next: getNextFunction(searchOptions, resp.nextStart, resp.total, searchPortal),\n    };\n}\n/**\n * Convert an Item to a IHubSearchResult\n * Fetches the includes and attaches them to the item\n * @param item\n * @param includes\n * @param requestOptions\n * @returns\n */\nasync function groupToSearchResult(group, includes = [], requestOptions) {\n    // Delegate to HubGroups module\n    // This layer of indirection is not necessary but\n    // aligns with how the items search works and\n    // allows for future specialization\n    return enrichGroupSearchResult(group, includes, requestOptions);\n}\n//# sourceMappingURL=portalSearchGroups.js.map","import { fetchOrg } from \"../../org/fetch-org\";\nimport { getEnrichmentErrors } from \"../../items/_enrichments\";\nimport OperationStack from \"../../OperationStack\";\nimport { getPortalBaseFromOrgUrl } from \"../../urls\";\nimport { createOperationPipeline } from \"../../utils\";\nconst enrichUserOrg = (input) => {\n    const { data, stack, requestOptions } = input;\n    const opId = stack.start(\"enrichUserOrg\");\n    const options = Object.assign(Object.assign({}, requestOptions), { \n        // In order to get the correct response, we must pass options.portal\n        // as a base portal url (e.g., www.arcgis.com, qaext.arcgis.com, etc)\n        // **not** an org portal (i.e. org.maps.arcgis.com).\n        portal: `${getPortalBaseFromOrgUrl(requestOptions.portal)}/sharing/rest` });\n    // TODO: Add Caching\n    // Had implemented a simple caching system, but it leads to unstable\n    // tests because we can't deterministically clear it\n    // if (!orgCache[data.user.orgId]) {\n    //   orgCache[data.user.orgId] = fetchOrg(data.user.orgId, options);\n    // }\n    // return (orgCache[data.user.orgId] as Promise<IPortal>)\n    return fetchOrg(data.user.orgId, options)\n        .then((results) => {\n        stack.finish(opId);\n        return {\n            data: Object.assign(Object.assign({}, data), {\n                org: results,\n            }),\n            stack,\n            requestOptions,\n        };\n    })\n        .catch((error) => handleEnrichmentError(error, input, opId));\n};\n/**\n * Simple cache for user org's. This does not expire\n * but that seems reasonable as Org props rarely change\n */\n// This works find at run-time, but it's a problem in tests\n// where we are validating calls. Will work with Randy to\n// create something that's more robust\n// const orgCache: Record<string, any> = {};\n// add the error to the content.errors,\n// log current stack operation as finished with an error\n// and return output that can be piped into the next operation\nconst handleEnrichmentError = (error, input, opId) => {\n    const { data, stack, requestOptions } = input;\n    stack.finish(opId, { error });\n    return {\n        data: Object.assign(Object.assign({}, data), { errors: getEnrichmentErrors(error, data.errors) }),\n        stack,\n        requestOptions,\n    };\n};\n/**\n * Available enrichments for Groups\n */\nconst groupEnrichementOperations = {\n    org: enrichUserOrg,\n};\n/**\n * Fetch enrichments for Users\n * @param group\n * @param enrichments\n * @param requestOptions\n * @returns\n */\nexport function fetchUserEnrichments(user, enrichments, requestOptions) {\n    // create a pipeline of enrichment operations\n    const operations = enrichments.reduce((ops, enrichment) => {\n        const operation = groupEnrichementOperations[enrichment];\n        // only include the enrichments that we know how to fetch\n        operation && ops.push(operation);\n        return ops;\n    }, []);\n    const pipeline = createOperationPipeline(operations);\n    // execute pipeline and return the item and enrichments\n    return pipeline({\n        data: { user },\n        stack: new OperationStack(),\n        requestOptions,\n    }).then((output) => {\n        // TODO: send telemetry so we have info on what enrichments are requested and possible errors\n        return output.data;\n    });\n}\n//# sourceMappingURL=enrichments.js.map","import { fetchUserEnrichments } from \"./_internal/enrichments\";\nimport { getProp } from \"../objects\";\nimport { getUserThumbnailUrl } from \"../search\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { getUserHomeUrl } from \"../urls\";\nimport { unique } from \"../util\";\nimport { mapBy } from \"../utils\";\n/**\n * Enrich a User object\n * @param user\n * @param includes\n * @param requestOptions\n * @returns\n */\nexport async function enrichUserSearchResult(user, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: user.access,\n        id: user.username,\n        type: \"User\",\n        name: user.fullName,\n        owner: user.username,\n        summary: user.description,\n        createdDate: new Date(user.created),\n        createdDateSource: \"user.created\",\n        updatedDate: new Date(user.modified),\n        updatedDateSource: \"user.modified\",\n        family: \"people\",\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // Informal Enrichments - basically adding type-specific props\n    // derived directly from the entity\n    // default includes\n    const DEFAULTS = [\"org.name AS orgName\"];\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    // Ignoring the else, because we currently have defaults, but want the guards\n    // so if we remove that in the future, we don't call the fn\n    /* istanbul ignore else */\n    if (enrichments.length) {\n        enriched = await fetchUserEnrichments(user, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    const token = requestOptions.authentication.token;\n    // Handle links\n    result.links.thumbnail = getUserThumbnailUrl(requestOptions.portal, user, token);\n    result.links.self = getUserHomeUrl(result.id, requestOptions);\n    result.links.siteRelative = `/people/${result.id}`;\n    return result;\n}\n//# sourceMappingURL=HubUsers.js.map","import { searchUsers, } from \"@esri/arcgis-rest-portal\";\nimport { enrichUserSearchResult } from \"../../users\";\nimport { serializeQueryForPortal } from \"../serializeQueryForPortal\";\nimport HubError from \"../../HubError\";\nimport { getNextFunction } from \"../utils\";\nimport { expandPredicate } from \"./expandPredicate\";\n/**\n * @private\n * Portal Search Implementation for Users\n * @param filterGroups\n * @param options\n * @returns\n */\nexport async function portalSearchUsers(query, options) {\n    // requestOptions is always required and user must be authd\n    if (!options.requestOptions) {\n        throw new HubError(\"portalSearchUsers\", \"requestOptions: IHubRequestOptions is required.\");\n    }\n    if (!options.requestOptions.authentication) {\n        throw new HubError(\"portalSearchUsers\", \"requestOptions must pass authentication.\");\n    }\n    // Expand the individual predicates in each filter\n    query.filters = query.filters.map((filter) => {\n        filter.predicates = filter.predicates.map(expandPredicate);\n        return filter;\n    });\n    // Serialize the all the groups for portal\n    const so = serializeQueryForPortal(query);\n    // Array of properties we want to copy from IHubSearchOptions to the ISearchOptions\n    const props = [\n        \"num\",\n        \"sortField\",\n        \"sortOrder\",\n        \"include\",\n        \"start\",\n        \"requestOptions\",\n    ];\n    // copy the props over\n    props.forEach((prop) => {\n        if (options.hasOwnProperty(prop)) {\n            so[prop] = options[prop];\n        }\n    });\n    // Unlike Groups and Item, the Users api *requires* authentication\n    // so we set it directly\n    so.authentication = options.requestOptions.authentication;\n    // Execute search\n    return searchPortal(so);\n}\n/**\n * Internal portal search, which then converts `IGroup`s to `IHubSearchResult`s\n * handling enrichments & includes along the way\n *\n * @param searchOptions\n * @returns\n */\nasync function searchPortal(searchOptions) {\n    // Execute portal search\n    const resp = await searchUsers(searchOptions);\n    // create mappable fn that will close\n    // over the includes and requestOptions\n    const fn = (user) => {\n        return userToSearchResult(user, searchOptions.include, searchOptions.requestOptions);\n    };\n    // map over results\n    const results = await Promise.all(resp.results.map(fn));\n    // Group Search does not support aggregations\n    // Construct the return\n    return {\n        total: resp.total,\n        results,\n        hasNext: resp.nextStart > -1,\n        next: getNextFunction(searchOptions, resp.nextStart, resp.total, searchPortal),\n    };\n}\n/**\n * Convert an Item to a IHubSearchResult\n * Fetches the includes and attaches them to the item\n * @param item\n * @param include\n * @param requestOptions\n * @returns\n */\nasync function userToSearchResult(user, include = [], requestOptions) {\n    // Delegate to HubGroups module\n    // This layer of indirection is not necessary but\n    // aligns with how the items search works and\n    // allows for future specialization\n    return enrichUserSearchResult(user, include, requestOptions);\n}\n//# sourceMappingURL=portalSearchUsers.js.map","import HubError from \"../HubError\";\nimport { getProp } from \"../objects\";\nimport { cloneObject } from \"../util\";\nimport { expandApi } from \"./utils\";\nimport { hubSearchItems, portalSearchItems, portalSearchGroups, portalSearchUsers, } from \"./_internal\";\n/**\n * Main entrypoint for searching via Hub\n *\n * Default's to search ArcGIS Portal but can delegate\n * to Hub API when it's available.\n * @param query\n * @param options\n * @returns\n */\nexport async function hubSearch(query, options) {\n    // Validate inputs\n    if (!query) {\n        throw new HubError(\"hubSearch\", \"Query is required.\");\n    }\n    if (!query.filters || !query.filters.length) {\n        throw new HubError(\"hubSearch\", \"Query must contain at least one Filter.\");\n    }\n    if (!options.requestOptions) {\n        throw new HubError(\"hubSearch\", \"requestOptions: IHubRequestOptions is required.\");\n    }\n    // Ensure includes is an array\n    if (!options.include) {\n        options.include = [];\n    }\n    // Get the type of the first filterGroup\n    const filterType = query.targetEntity;\n    // get the API\n    const apiType = expandApi(options.api || \"arcgis\").type;\n    const fnHash = {\n        arcgis: {\n            item: portalSearchItems,\n            group: portalSearchGroups,\n            user: portalSearchUsers,\n        },\n        \"arcgis-hub\": {\n            item: hubSearchItems,\n        },\n    };\n    const fn = getProp(fnHash, `${apiType}.${filterType}`);\n    if (!fn) {\n        throw new HubError(`hubSearch`, `Search via \"${filterType}\" filter against \"${apiType}\" api is not implemented. Please ensure \"targetEntity\" is defined on the query.`);\n    }\n    return fn(cloneObject(query), options);\n}\n//# sourceMappingURL=hubSearch.js.map","import { fetchGroupEnrichments } from \"./_internal/enrichments\";\nimport { getProp } from \"../objects\";\nimport { getGroupThumbnailUrl } from \"../search\";\nimport { parseInclude } from \"../search/_internal/parseInclude\";\nimport { getGroupHomeUrl } from \"../urls\";\nimport { unique } from \"../util\";\nimport { mapBy } from \"../utils\";\n/**\n * Enrich a generic search result\n * @param group\n * @param includes\n * @param requestOptions\n * @returns\n */\nexport async function enrichGroupSearchResult(group, include, requestOptions) {\n    // Create the basic structure\n    const result = {\n        access: group.access,\n        id: group.id,\n        type: \"Group\",\n        name: group.title,\n        owner: group.owner,\n        summary: group.snippet || group.description,\n        createdDate: new Date(group.created),\n        createdDateSource: \"group.created\",\n        updatedDate: new Date(group.modified),\n        updatedDateSource: \"group.modified\",\n        family: \"team\",\n        links: {\n            self: \"not-implemented\",\n            siteRelative: \"not-implemented\",\n            thumbnail: \"not-implemented\",\n        },\n    };\n    // Informal Enrichments - basically adding type-specific props\n    // derived directly from the entity\n    result.isSharedUpdate = (group.capabilities || []).includes(\"updateitemcontrol\");\n    result.membershipAccess = group.membershipAccess;\n    result.isOpenData = !!group.isOpenData;\n    // default includes\n    const DEFAULTS = [];\n    // merge includes\n    include = [...DEFAULTS, ...include].filter(unique);\n    // Parse the includes into a valid set of enrichments\n    const specs = include.map(parseInclude);\n    // Extract out the low-level enrichments needed\n    const enrichments = mapBy(\"enrichment\", specs).filter(unique);\n    // fetch the enrichments\n    let enriched = {};\n    if (enrichments.length) {\n        enriched = await fetchGroupEnrichments(group, enrichments, requestOptions);\n    }\n    // map the enriched props onto the result\n    specs.forEach((spec) => {\n        result[spec.prop] = getProp(enriched, spec.path);\n    });\n    // Handle links\n    result.links.thumbnail = getGroupThumbnailUrl(requestOptions.portal, group);\n    result.links.self = getGroupHomeUrl(result.id, requestOptions);\n    result.links.siteRelative = `/teams/${result.id}`;\n    return result;\n}\n//# sourceMappingURL=HubGroups.js.map","import { RemoteServerError as _RemoteServerError, buildUrl, } from \"@esri/hub-common\";\nexport class RemoteServerError extends _RemoteServerError {\n    constructor(message, url, status, error) {\n        super(message, url, status);\n        this.error = error;\n    }\n}\n/**\n * returns Promise that resolves token to use in Discussions API requests\n *\n * @export\n * @param {IDiscussionsRequestOptions} options\n * @return {*}  {Promise<string>}\n */\nexport function authenticateRequest(options) {\n    const { token, authentication } = options;\n    let tokenPromise = () => {\n        return Promise.resolve(token);\n    };\n    if (authentication) {\n        tokenPromise = authentication.getToken.bind(authentication, authentication.portal);\n    }\n    return tokenPromise();\n}\n/**\n * parses IHubRequestOptions and makes request against Discussions API\n *\n * @export\n * @template T\n * @param {string} route\n * @param {IDiscussionsRequestOptions} options\n * @param {string} [token]\n * @return {*}  {Promise<T>}\n */\nexport function apiRequest(route, options, token) {\n    const headers = new Headers(options.headers);\n    headers.append(\"Content-Type\", \"application/json\");\n    if (token) {\n        headers.append(\"Authorization\", `Bearer ${token}`);\n    }\n    const opts = {\n        headers,\n        method: options.httpMethod || \"GET\",\n        mode: options.mode,\n        cache: options.cache,\n        credentials: options.credentials,\n    };\n    const apiBase = buildUrl({\n        // TODO: we _want_ to use getHubApiUrl(),\n        // but have to deal w/ the fact that this package overwrites IHubRequestOptions\n        host: options.hubApiUrl || \"https://hub.arcgis.com\",\n        path: \"/api/discussions/v1\",\n    });\n    if (options.data) {\n        if (options.httpMethod === \"GET\") {\n            const queryParams = new URLSearchParams(options.data).toString();\n            route += `?${queryParams}`;\n        }\n        else {\n            opts.body = JSON.stringify(options.data);\n        }\n    }\n    const url = [apiBase.replace(/\\/$/, \"\"), route.replace(/^\\//, \"\")].join(\"/\");\n    return fetch(url, opts).then((res) => {\n        if (res.ok) {\n            return res.json();\n        }\n        else {\n            const { statusText, status } = res;\n            return res.json().then((err) => {\n                throw new RemoteServerError(statusText, url, status, JSON.stringify(err.message));\n            });\n        }\n    });\n}\n//# sourceMappingURL=request.js.map","import { apiRequest, authenticateRequest } from \"./utils/request\";\n/**\n * method that authenticates and makes requests to Discussions API\n *\n * @export\n * @template T\n * @param {string} url\n * @param {IDiscussionsRequestOptions} options\n * @return {*}  {Promise<T>}\n */\n// NOTE: feasibly this could be replaced with @esi/hub-common hubApiRequest,\n// if that method didn't prepend `/api/v3` to the supplied path. Additionally,\n// there is the difference that hubApiRequest sets Authorization header without `Bearer`\n// https://github.com/Esri/hub.js/blob/f35b1a0a868916bd07e1dfd84cb084bc2c876267/packages/common/src/request.ts#L62\nexport function request(url, options) {\n    return authenticateRequest(options).then((token) => {\n        return apiRequest(url, options, token);\n    });\n}\n//# sourceMappingURL=request.js.map","import { __rest } from \"tslib\";\n/* tslint:disable unified-signatures */\nimport { request } from \"../request\";\n/**\n * search posts\n *\n * @export\n * @param {ISearchPostsParams} options\n * @return {*}  {Promise<IPagedResponse<IPost>>}\n */\nexport function searchPosts(options) {\n    const url = `/posts`;\n    options.httpMethod = \"GET\";\n    return request(url, options);\n}\n/**\n * create post\n *\n * @export\n * @param {ICreatePostParams} options\n * @return {*}  {Promise<IPost>}\n */\nexport function createPost(options) {\n    const url = `/posts`;\n    return request(url, Object.assign({ httpMethod: \"POST\" }, getCreateUpdateRequestParams(options)));\n}\n/**\n * create reply to post\n *\n * @export\n * @param {string} parentId\n * @param {ICreateReplyParams} options\n * @return {*}  {Promise<IPost>}\n */\nexport function createReply(options) {\n    const url = `/posts/${options.postId}/reply`;\n    return request(url, Object.assign({ httpMethod: \"POST\" }, getCreateUpdateRequestParams(options)));\n}\n/**\n * fetch post\n *\n * @export\n * @param {IFetchPostParams} params\n * @return {*}  {Promise<IPost>}\n */\nexport function fetchPost(params) {\n    const url = `/posts/${params.postId}`;\n    params.httpMethod = \"GET\";\n    return request(url, params);\n}\n/**\n * remove post\n *\n * @export\n * @param {IRemovePostParams} options\n * @return {*}  {Promise<IRemovePostResponse>}\n */\nexport function removePost(options) {\n    const url = `/posts/${options.postId}`;\n    options.httpMethod = \"DELETE\";\n    return request(url, options);\n}\n/**\n * update post\n * NOTE: this method currently only update post.title and post.body\n *\n * @export\n * @param {IUpdatePostParams} options\n * @return {*}  {Promise<IPost>}\n */\nexport function updatePost(options) {\n    const url = `/posts/${options.postId}`;\n    return request(url, Object.assign({ httpMethod: \"PATCH\" }, getCreateUpdateRequestParams(options)));\n}\n/**\n * update post channel\n * NOTE: this method will change the channel a post belongs to\n *\n * @export\n * @param {IUpdatePostSharingParams} options\n * @return {*}  {Promise<IPost>}\n */\nexport function updatePostSharing(options) {\n    const url = `/posts/${options.postId}/sharing`;\n    options.httpMethod = \"PATCH\";\n    return request(url, options);\n}\n/**\n * update post status\n * NOTE: this method will only update a post's status\n *\n * @export\n * @param {IUpdatePostStatusParams} options\n * @return {*}  {Promise<IPost>}\n */\nexport function updatePostStatus(options) {\n    const url = `/posts/${options.postId}/status`;\n    options.httpMethod = \"PATCH\";\n    return request(url, options);\n}\n/**\n * Builds the necessary request options for post/reply create/update requests\n * @param mentionUrl\n */\nfunction getCreateUpdateRequestParams(params) {\n    const { mentionUrl } = params, requestOptions = __rest(params, [\"mentionUrl\"]);\n    if (mentionUrl) {\n        requestOptions.headers = Object.assign(Object.assign({}, requestOptions.headers), { \"mention-url\": mentionUrl });\n    }\n    return requestOptions;\n}\n//# sourceMappingURL=posts.js.map","import { request } from \"../request\";\n/**\n * search channels\n *\n * @export\n * @param {ISearchChannelsParams} options\n * @return {*}  {Promise<IPagedResponse<IChannel>>}\n */\nexport function searchChannels(options) {\n    options.httpMethod = \"GET\";\n    return request(`/channels`, options);\n}\n/**\n * create channel\n *\n * @export\n * @param {ICreateChannelParams} options\n * @return {*}  {Promise<IChannel>}\n */\nexport function createChannel(options) {\n    options.httpMethod = \"POST\";\n    return request(`/channels`, options);\n}\n/**\n * fetch channel\n *\n * @export\n * @param {IFetchChannelParams} options\n * @return {*}  {Promise<IChannel>}\n */\nexport function fetchChannel(options) {\n    options.httpMethod = \"GET\";\n    return request(`/channels/${options.channelId}`, options);\n}\n/**\n * update channel\n * NOTE: only updates channel settings properties (softDelete, allowedReactions, etc). A Channel's\n * access and groups cannot be updated.\n *\n * @export\n * @param {IUpdateChannelParams} options\n * @return {*}  {Promise<IChannel>}\n */\nexport function updateChannel(options) {\n    options.httpMethod = \"PATCH\";\n    return request(`/channels/${options.channelId}`, options);\n}\n/**\n * remove channel\n *\n * @export\n * @param {IRemoveChannelParams} options\n * @return {*}\n */\nexport function removeChannel(options) {\n    options.httpMethod = \"DELETE\";\n    return request(`/channels/${options.channelId}`, options);\n}\n/**\n * get channel opt out status\n *\n * @export\n * @param {IFetchChannelNotificationOptOutParams} options\n * @return {*}\n */\nexport function fetchChannelNotifcationOptOut(options) {\n    options.httpMethod = \"GET\";\n    return request(`/channels/${options.channelId}/notifications/opt-out`, options);\n}\n/**\n * opt out of channel notifs\n *\n * @export\n * @param {ICreateChannelNotificationOptOutParams} options\n * @return {*}\n */\nexport function createChannelNotificationOptOut(options) {\n    options.httpMethod = \"POST\";\n    return request(`/channels/${options.channelId}/notifications/opt-out`, options);\n}\n/**\n * opt in to channel notifs\n *\n * @export\n * @param {IRemoveChannelNotificationOptOutParams} options\n * @return {*}\n */\nexport function removeChannelNotificationOptOut(options) {\n    options.httpMethod = \"DELETE\";\n    return request(`/channels/${options.channelId}/notifications/opt-out`, options);\n}\n/**\n * remove all posts in a channel\n *\n * @export\n * @param {IRemoveChannelActivityParams} options\n * @return {*}\n */\nexport function removeChannelActivity(options) {\n    options.httpMethod = \"DELETE\";\n    return request(`/channels/${options.channelId}/activity`, options);\n}\n//# sourceMappingURL=channels.js.map","/**\n * sort orders\n *\n * @export\n * @enum {string}\n */\nexport var SortOrder;\n(function (SortOrder) {\n    SortOrder[\"ASC\"] = \"ASC\";\n    SortOrder[\"DESC\"] = \"DESC\";\n})(SortOrder || (SortOrder = {}));\n/**\n * reactions to posts\n *\n * @export\n * @enum {string}\n */\nexport var PostReaction;\n(function (PostReaction) {\n    PostReaction[\"THUMBS_UP\"] = \"thumbs_up\";\n    PostReaction[\"THUMBS_DOWN\"] = \"thumbs_down\";\n    PostReaction[\"THINKING\"] = \"thinking\";\n    PostReaction[\"HEART\"] = \"heart\";\n    PostReaction[\"ONE_HUNDRED\"] = \"one_hundred\";\n    PostReaction[\"SAD\"] = \"sad\";\n    PostReaction[\"LAUGH\"] = \"laugh\";\n    PostReaction[\"SURPRISED\"] = \"surprised\";\n})(PostReaction || (PostReaction = {}));\n/**\n * platform sharing access values\n *\n * @export\n * @enum {string}\n */\nexport var SharingAccess;\n(function (SharingAccess) {\n    SharingAccess[\"PUBLIC\"] = \"public\";\n    SharingAccess[\"ORG\"] = \"org\";\n    SharingAccess[\"PRIVATE\"] = \"private\";\n})(SharingAccess || (SharingAccess = {}));\n/**\n * possible statuses of a post\n *\n * @export\n * @enum {string}\n */\nexport var PostStatus;\n(function (PostStatus) {\n    PostStatus[\"PENDING\"] = \"pending\";\n    PostStatus[\"APPROVED\"] = \"approved\";\n    PostStatus[\"REJECTED\"] = \"rejected\";\n    PostStatus[\"DELETED\"] = \"deleted\";\n    PostStatus[\"HIDDEN\"] = \"hidden\";\n})(PostStatus || (PostStatus = {}));\n/**\n * possible discussionn content types, i.e. a post can be about an item, dataset, or group\n *\n * @export\n * @enum {string}\n */\nexport var DiscussionType;\n(function (DiscussionType) {\n    DiscussionType[\"GROUP\"] = \"group\";\n    DiscussionType[\"CONTENT\"] = \"content\";\n})(DiscussionType || (DiscussionType = {}));\n/**\n * source of a post, i.e. app context\n *\n * @export\n * @enum {string}\n */\nexport var DiscussionSource;\n(function (DiscussionSource) {\n    DiscussionSource[\"HUB\"] = \"hub\";\n    DiscussionSource[\"AGO\"] = \"ago\";\n    DiscussionSource[\"URBAN\"] = \"urban\";\n})(DiscussionSource || (DiscussionSource = {}));\n/**\n * relations of post entity\n *\n * @export\n * @enum {string}\n */\nexport var PostRelation;\n(function (PostRelation) {\n    PostRelation[\"REPLIES\"] = \"replies\";\n    PostRelation[\"REACTIONS\"] = \"reactions\";\n    PostRelation[\"PARENT\"] = \"parent\";\n    PostRelation[\"CHANNEL\"] = \"channel\";\n})(PostRelation || (PostRelation = {}));\n/**\n * relations of reaction entity\n *\n * @export\n * @enum {string}\n */\nexport var ReactionRelation;\n(function (ReactionRelation) {\n    ReactionRelation[\"POST\"] = \"post\";\n})(ReactionRelation || (ReactionRelation = {}));\n/**\n * filters of channel entity\n *\n * @export\n * @enum {string}\n */\nexport var ChannelFilter;\n(function (ChannelFilter) {\n    ChannelFilter[\"HAS_USER_POSTS\"] = \"has_user_posts\";\n})(ChannelFilter || (ChannelFilter = {}));\n// sorting\n/**\n * Common sorting fields\n */\nexport var CommonSort;\n(function (CommonSort) {\n    CommonSort[\"CREATED_AT\"] = \"createdAt\";\n    CommonSort[\"CREATOR\"] = \"creator\";\n    CommonSort[\"EDITOR\"] = \"editor\";\n    CommonSort[\"ID\"] = \"id\";\n    CommonSort[\"UPDATED_AT\"] = \"updatedAt\";\n})(CommonSort || (CommonSort = {}));\n/**\n * Role types\n *\n * @export\n * @enum {string}\n */\nexport var Role;\n(function (Role) {\n    Role[\"READ\"] = \"read\";\n    Role[\"WRITE\"] = \"write\";\n    Role[\"READWRITE\"] = \"readWrite\";\n    Role[\"MODERATE\"] = \"moderate\";\n    Role[\"MANAGE\"] = \"manage\";\n    Role[\"OWNER\"] = \"owner\";\n})(Role || (Role = {}));\n/**\n * Post sorting fields\n *\n * @enum {string}\n */\nexport var PostSort;\n(function (PostSort) {\n    PostSort[\"BODY\"] = \"body\";\n    PostSort[\"CHANNEL_ID\"] = \"channelId\";\n    PostSort[\"CREATED_AT\"] = \"createdAt\";\n    PostSort[\"CREATOR\"] = \"creator\";\n    PostSort[\"DISCUSSION\"] = \"discussion\";\n    PostSort[\"EDITOR\"] = \"editor\";\n    PostSort[\"ID\"] = \"id\";\n    PostSort[\"PARENT_ID\"] = \"parentId\";\n    PostSort[\"STATUS\"] = \"status\";\n    PostSort[\"TITLE\"] = \"title\";\n    PostSort[\"UPDATED_AT\"] = \"updatedAt\";\n})(PostSort || (PostSort = {}));\n/**\n * Post types\n *\n * @enum{string}\n */\nexport var PostType;\n(function (PostType) {\n    PostType[\"Text\"] = \"text\";\n    PostType[\"Announcement\"] = \"announcement\";\n    PostType[\"Poll\"] = \"poll\";\n    PostType[\"Question\"] = \"question\";\n})(PostType || (PostType = {}));\n/**\n * Channel sorting fields\n *\n * @export\n * @enum {string}\n */\nexport var ChannelSort;\n(function (ChannelSort) {\n    ChannelSort[\"ACCESS\"] = \"access\";\n    ChannelSort[\"CREATED_AT\"] = \"createdAt\";\n    ChannelSort[\"CREATOR\"] = \"creator\";\n    ChannelSort[\"EDITOR\"] = \"editor\";\n    ChannelSort[\"ID\"] = \"id\";\n    ChannelSort[\"LAST_ACTIVITY\"] = \"last_activity\";\n    ChannelSort[\"UPDATED_AT\"] = \"updatedAt\";\n})(ChannelSort || (ChannelSort = {}));\n/**\n * relations of channel entity\n *\n * @export\n * @enum {string}\n */\nexport var ChannelRelation;\n(function (ChannelRelation) {\n    ChannelRelation[\"SETTINGS\"] = \"settings\";\n    ChannelRelation[\"CHANNEL_ACL\"] = \"channelAcl\";\n})(ChannelRelation || (ChannelRelation = {}));\nexport var AclCategory;\n(function (AclCategory) {\n    AclCategory[\"GROUP\"] = \"group\";\n    AclCategory[\"ORG\"] = \"org\";\n    AclCategory[\"USER\"] = \"user\";\n    AclCategory[\"ANONYMOUS_USER\"] = \"anonymousUser\";\n    AclCategory[\"AUTHENTICATED_USER\"] = \"authenticatedUser\";\n})(AclCategory || (AclCategory = {}));\nexport var AclSubCategory;\n(function (AclSubCategory) {\n    AclSubCategory[\"ADMIN\"] = \"admin\";\n    AclSubCategory[\"MEMBER\"] = \"member\";\n})(AclSubCategory || (AclSubCategory = {}));\n//# sourceMappingURL=types.js.map",":host {\n  display: block;\n}\n","import { Component, Host, State, h } from '@stencil/core';\nimport state from '../../utils/state';\nimport { searchGroups, SearchQueryBuilder } from \"@esri/arcgis-rest-portal\";\nimport { ICreateChannel, PostStatus, SharingAccess, createChannel } from '@esri/hub-discussions';\n\n@Component({\n  tag: 'hub-collaborations',\n  styleUrl: 'hub-collaborations.css',\n  shadow: true,\n})\nexport class HubCollaborations {\n\n  @State() groups = [];\n\n  async componentWillRender() {\n    this.groups = await this.getGroups(state.user);\n\n  }\n  async getGroups(user) {\n    if(!user) {\n      return [];\n    }\n    \n    const groupsQuery = new SearchQueryBuilder()\n      .match( user.username )\n      .in(\"owner\")\n    const groups = await searchGroups( {\n      q: groupsQuery,\n      portal: `${state.app.portal}/sharing`\n    });\n    console.log({groups})\n    return groups.results;\n  }\n\n  // This won't work until I can figure out how to use QA discussions\n  async requestChannel(groupId) {\n    const createOptions:ICreateChannel = {\n      access: SharingAccess.PRIVATE,\n      groups: [groupId],\n      defaultPostStatus: PostStatus.APPROVED\n    }\n\n    console.debug(\"createChannel\", {createOptions})\n    const response = createChannel({\n      data: createOptions,\n      ...state.context.hubRequestOptions\n    });\n\n    console.debug(\"createChannel\", {response});\n  }\n\n  render() {\n\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list>\n        {this.groups.map((group) => {\n          return (\n          <calcite-list-item label={group.title} description={group.snippet}>\n            <calcite-avatar\n              scale=\"m\"\n              slot=\"content-start\"\n              thumbnail=\"https://www.seekpng.com/png/detail/90-906849_89kib-1024x631-finn-finn-adventure-time-face.png\"\n            ></calcite-avatar>\n            <calcite-dropdown\n              scale=\"m\"\n              slot=\"actions-end\"\n            >\n              <calcite-action icon=\"ellipsis\" label=\"menu\" slot=\"dropdown-trigger\"></calcite-action>\n              <calcite-dropdown-group>\n                <calcite-dropdown-item\n                  id={`group-${group.id}`}\n                  onclick={() => {this.requestChannel(group.id)}}\n                >\n                  Create Channel\n                </calcite-dropdown-item>\n              </calcite-dropdown-group>\n            </calcite-dropdown>\n            {/* <calcite-action icon=\"ellipsis\" label=\"menu\" slot=\"actions-end\"></calcite-action> */}\n            {/* <calcite-action icon=\"x\" label=\"remove\" slot=\"actions-end\"></calcite-action> */}\n          </calcite-list-item>\n          )\n        })}\n        </calcite-list>\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n}\n","import { IChannel, ISearchChannels, searchChannels } from '@esri/hub-discussions';\nimport { Component, Host, State, h } from '@stencil/core';\nimport state from '../../utils/state';\n\n@Component({\n  tag: 'hub-discussions-channels',\n  styleUrl: 'hub-discussions-channels.css',\n  shadow: true,\n})\nexport class HubDiscussionsChannels {\n\n  @State() channels:IChannel[] = [];\n\n  async componentWillLoad() {\n    this.channels = await this.getChannels();\n  }\n\n  async getChannels() {\n    const channelQuery:ISearchChannels = {\n      // access: [],\n      // groups: [ this.channelId ],\n    }\n    const results = await searchChannels({\n      data: channelQuery,\n      ...state.context.hubRequestOptions\n    });\n    // this.channels = results.items;\n    return results.items;\n\n    // return this.channels;\n  }\n\n\n  render() {\n    console.log(\"Render channels\", this.channels)\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list>\n        {this.channels.map((channel) => {\n          return (\n            <calcite-list-item label={channel.id} description={`Channel creator: ${channel.creator}`}>\n              <calcite-icon scale=\"s\" icon=\"speech-bubble\" slot=\"content-start\"></calcite-icon>\n            </calcite-list-item>\n          )\n        })}\n        </calcite-list>\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n}\n#posts {\n  min-height: calc(100vh-70px);\n  overflow-y: scroll;\n}\n#editor {\n  height: 70px;\n  bottom: 0px;\n  position: sticky;\n  background-color: white;\n}","import { IPost, ISearchPosts, searchPosts } from '@esri/hub-discussions';\nimport { Component, Host, Prop, h } from '@stencil/core';\nimport state from '../../utils/state';\nimport { timeAgo } from '../../utils/time';\n\n@Component({\n  tag: 'hub-discussions-moderation',\n  styleUrl: 'hub-discussions-moderation.css',\n  shadow: true,\n})\nexport class HubDiscussionsModeration {\n\n  @Prop() channelId:string = null;\n  @Prop({ mutable: true, reflect: true }) posts:IPost[] = [];\n\n  async componentWillLoad() {\n    this.posts = await this.getChannelPosts(this.channelId);\n  }\n\n  async getChannelPosts(channel:string) {\n    console.debug(\"getChannelPosts\", {channel})\n\n    const postsQuery:ISearchPosts = {\n      // access: [],\n      channels: [ this.channelId ],\n    }\n    const results = await searchPosts({\n      data: postsQuery,\n      ...state.context.hubRequestOptions\n    });\n    // this.channels = results.items;\n    return results.items;\n\n    // return this.channels;\n  }\n\n\n  render() {\n    console.log(\"Render posts\", this.posts)\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list id=\"posts\">\n        {this.posts.map((post) => {\n          return (\n            <calcite-list-item description={post.creator} label={post.body}>\n              <calcite-icon scale=\"s\" icon=\"speech-bubble\" slot=\"content-start\"></calcite-icon>\n              <div slot=\"content-end\">\n                {timeAgo(post.createdAt)}\n                <calcite-chip class=\"list-chip\" icon=\"organization\" scale=\"s\">Staff</calcite-chip>\n              </div>\n            </calcite-list-item>\n          )\n        })}\n        </calcite-list>\n        \n        <hub-discussions-post-editor id=\"editor\" channel-id={this.channelId}></hub-discussions-post-editor>\n\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n  padding: 0.2rem;\n}\n#prompt {\n  \n  font-weight: 400;\n  font-style: italic;\n}","import { Component, Host, Prop, h } from '@stencil/core';\nimport state from '../../utils/state';\nimport { ICreatePost, createPost } from '@esri/hub-discussions';\n\n@Component({\n  tag: 'hub-discussions-post-editor',\n  styleUrl: 'hub-discussions-post-editor.css',\n  shadow: true,\n})\nexport class HubDiscussionsPostEditor {\n\n  @Prop() channelId:string = null;\n  postBodyInput:HTMLInputElement;\n\n  componentDidRender() {\n    console.log('postEditor did render', this.postBodyInput)\n  }\n  postSubmitted(_evt) {\n    console.log(\"postSubmitted\", {\n      // el: this.postBodyInput,\n      value: this.postBodyInput.value,\n      _evt\n    })\n    this.createPost(\n      this.postBodyInput.value\n    )\n  }\n  async createPost(body: string) {\n    const data:ICreatePost = {\n      channelId: this.channelId,\n      body: body\n    }\n    const postResult = createPost({\n      data,\n      ...state.context.hubRequestOptions\n    })\n    return postResult;\n  }\n\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-label>\n          <span id=\"prompt\">What's on your mind?</span>\n          <calcite-input\n              id=\"input-with-text-area\"\n              type=\"input\"\n              value=\"\"\n              placeholder=\"Write your discussion post.\"\n              alignment=\"start\"\n              number-button-type=\"vertical\"\n              scale=\"m\"\n              status=\"idle\"\n              ref={el => this.postBodyInput = el}\n          >\n            <calcite-button slot=\"action\"\n              onclick={this.postSubmitted.bind(this)}\n            >post</calcite-button>\n\n          </calcite-input>\n          <calcite-input-message status=\"idle\" scale=\"m\">\n            help\n          </calcite-input-message>        \n\n        </calcite-label>\n\n      </Host>\n    );\n  }\n\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { searchItems } from \"@esri/arcgis-rest-portal\";\nimport { getHubApiUrl } from \"@esri/hub-common\";\n/**\n * ```js\n * import { request } from \"@esri/arcgis-rest-request\";\n * import { getEventServiceUrl } from \"@esri/hub-events\";\n * // org ids can be retrieved via a call to portals/self\n * request(\"http://custom.maps.arcgis.com/sharing/rest/portals/self\")\n *   .then(response => {\n *     getEventServiceUrl(response.id)\n *       .then(url)\n *          // \"https://hub.arcgis.com/api/v3/events/<orgId>...\"\n *   })\n * ```\n * Get the Hub REST API endpoint to use for an organization's events\n * @param orgId - Identifier of the ArcGIS Online Organization\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with the events API url for a Hub enabled ArcGIS Online organization.\n */\nexport function getEventServiceUrl(orgId, requestOptions) {\n    return getEventServiceItem(orgId, requestOptions).then(response => {\n        const host = getHubApiUrl(requestOptions);\n        // Extract the Event service's view name; the view returned depends\n        // on permission level of request user\n        const view = response.url.match(/services\\/(.*?)\\/FeatureServer/);\n        // Generate a root url for the hub-indexer event routes\n        /* istanbul ignore else */\n        if (view[1]) {\n            return `${host}/api/v3/events/${orgId}/${view[1]}/FeatureServer/0`;\n        }\n    });\n}\n/**\n * ```js\n * import { request } from \"@esri/arcgis-rest-request\";\n * import { getEventFeatureServiceUrl } from \"@esri/hub-events\";\n * // org ids can be retrieved via a call to portals/self\n * request(\"http://custom.maps.arcgis.com/sharing/rest/portals/self\")\n *   .then(response => {\n *     getEventFeatureServiceUrl(response.id)\n *       .then(url)\n *         // \"https://services.arcgis.com/<orgId>/arcgis/rest/services/...\"\n *   })\n * ```\n * Fetch the events feature service/view for the Hub organization and given authorization.\n * @param orgId - Identifier of the ArcGIS Online Organization\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with the events feature service url for a Hub enabled ArcGIS Online organization.\n */\nexport function getEventFeatureServiceUrl(orgId, requestOptions) {\n    return getEventServiceItem(orgId, requestOptions).then(response => {\n        // single-layer service\n        let url = `${response.url}/0`;\n        // force https\n        url = url.replace(/^http:/gi, \"https:\");\n        return url;\n    });\n}\n/**\n * Get the events query based on type.\n * @param type - string to indicate event type with the options `upcoming`, `past`, `cancelled` and `draft`\n * @param options - query features request options\n * @returns an IQueryFeaturesOptions that has the same values as `options` but for the modified Where and OrderBy properties\n */\nexport function getEventQueryFromType(type, options) {\n    // this allows us to ask for type === upcoming | past | cancelled | draft\n    // and get an appropriate `where` and `orderByFields`\n    let typeWhere;\n    const newOptions = Object.assign({}, options);\n    if (type === \"cancelled\") {\n        if (!options.orderByFields) {\n            // if orderByFields was passed in, use it, otherwise use appropriate one for cancelled\n            newOptions.orderByFields = \"EditDate DESC\";\n        }\n        typeWhere = `isCancelled=1 AND status<>'draft'`;\n    }\n    else if (type === \"draft\") {\n        if (!options.orderByFields) {\n            newOptions.orderByFields = \"EditDate DESC\";\n        }\n        const session = options.authentication;\n        const user = session ? session.username : null;\n        typeWhere = `Creator = '${user}' AND status = 'draft'`;\n    }\n    else {\n        if (!options.orderByFields) {\n            // if orderByFields was passed in, use it, otherwise use appropriate one for type\n            newOptions.orderByFields =\n                type === \"upcoming\" ? \"startDate ASC\" : \"startDate DESC\";\n        }\n        const operator = type === \"upcoming\" ? \">\" : \"<=\";\n        typeWhere = `endDate${operator}CURRENT_TIMESTAMP AND (isCancelled<>1 OR isCancelled IS NULL) AND status<>'draft'`;\n    }\n    if (options.where) {\n        newOptions.where = `${options.where} AND ${typeWhere}`;\n    }\n    else {\n        newOptions.where = typeWhere;\n    }\n    return newOptions;\n}\n/**\n * ```js\n * import { request } from \"@esri/arcgis-rest-request\";\n * import { getEventServiceItem } from \"@esri/hub-events\";\n * // org ids can be retrieved via a call to portals/self\n * request(\"http://custom.maps.arcgis.com/sharing/rest/portals/self\")\n *   .then(response => {\n *     getEventServiceItem(response.id)\n *       .then(itemResponse)\n *   })\n * ```\n * Fetch the events service associated with a Hub Site.\n * @param orgId - Identifier of the ArcGIS Online Organization\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with the events item for a Hub enabled ArcGIS Online organization.\n */\nexport function getEventServiceItem(orgId, requestOptions) {\n    return searchItems(Object.assign({ q: `typekeywords:hubEventsLayer AND orgid:${orgId}` }, requestOptions)).then(response => {\n        const eventResponse = response;\n        if (eventResponse.results && eventResponse.results.length > 0) {\n            let result;\n            /* istanbul ignore else  */\n            if (eventResponse.results.length === 1) {\n                // user only has access to the public view\n                result = eventResponse.results[0];\n            }\n            else if (eventResponse.results.length > 1) {\n                // the user has access to the org view and/or the admin view\n                // identify which is which\n                const obj = eventResponse.results.reduce((acc, item) => {\n                    if (!item.typeKeywords.includes(\"View Service\")) {\n                        acc.admin = item;\n                    }\n                    else {\n                        if (item.access === \"public\") {\n                            acc.public = item;\n                        }\n                        else {\n                            acc.org = item;\n                        }\n                    }\n                    return acc;\n                }, {});\n                // pick the highest access level that this user has access to\n                result = obj.admin || obj.org || /* istanbul ignore next */ obj.public;\n            }\n            return result;\n        }\n        else {\n            throw Error(\"No events service found. Events are likely not enabled.\");\n        }\n    });\n}\n//# sourceMappingURL=util.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { queryFeatures } from \"@esri/arcgis-rest-feature-layer\";\nimport { searchItems } from \"@esri/arcgis-rest-portal\";\n/**\n * ```js\n * import { getEventQueryFromType, searchEvents } from \"@esri/hub-events\";\n * // event types are \"upcoming\" | \"past\" | \"cancelled\" | \"draft\"\n * const searchOptions: IQueryFeaturesOptions = getEventQueryFromType(\"upcoming\", {\n *   url: eventsUrl,\n *   authentication\n * });\n * searchEvents(searchOptions)\n *   .then(response => {\n *     // {\n *     //   data: [{\n *     //     id: \"4\",\n *     //     type: \"events\",\n *     //     attributes: {title: \"Vision Zero\", siteId: \"CityofX\", ...},\n *     //     geometry: {\n *     //       \"x\": -74.310680054965559,\n *     //       \"y\": 40.723010058860787\n *     //     }\n *     //   }],\n *     //   included: [{\n *     //     id: \"CityofX\",\n *     //     type: \"sites\",\n *     //     attributes: { id: \"CityofX\", url: \"https://foo/bar\"}\n *     //   }]\n *     // }\n *   });\n * ```\n * Query for events from ArcGIS Hub.\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with decorated features from the event feature service for a Hub enabled ArcGIS Online organization.\n */\nexport function searchEvents(requestOptions) {\n    const queryOptions = Object.assign({ returnGeometry: true }, requestOptions);\n    return queryFeatures(queryOptions).then(response => {\n        if (response.features.length <= 0) {\n            return {\n                data: [],\n                included: []\n            };\n        }\n        // if authentication is passed, get a reference to the token to tack onto image urls\n        if (queryOptions.authentication) {\n            return queryOptions.authentication\n                .getToken(queryOptions.url)\n                .then(token => {\n                return buildEventResponse(response.features, queryOptions.url, requestOptions, token);\n            });\n        }\n        else {\n            return buildEventResponse(response.features, queryOptions.url, requestOptions);\n        }\n    });\n}\nfunction buildEventResponse(features, url, requestOptions, token) {\n    const siteIds = [];\n    const data = [];\n    const included = [];\n    const cacheBust = new Date().getTime();\n    let siteSearchQuery = \"\";\n    features.forEach(function (event) {\n        const attributes = event.attributes;\n        const geometry = event.geometry;\n        let imageUrl = null;\n        if (attributes.imageAttributes) {\n            const imageAttributes = JSON.parse(attributes.imageAttributes);\n            if (imageAttributes.crop) {\n                imageUrl = `${url}/${attributes.OBJECTID}/attachments/${imageAttributes.crop}?v=${cacheBust}`;\n                if (token) {\n                    imageUrl += `&token=${token}`;\n                }\n            }\n        }\n        data.push({\n            id: attributes.OBJECTID,\n            type: \"events\",\n            imageUrl,\n            attributes,\n            geometry\n        });\n        const currentEventSiteId = attributes.siteId;\n        if (currentEventSiteId != null &&\n            siteIds.indexOf(currentEventSiteId) === -1) {\n            siteIds.push(currentEventSiteId);\n            siteSearchQuery += siteSearchQuery.length > 0 ? \" OR id:\" : \"id:\";\n            siteSearchQuery += currentEventSiteId;\n        }\n    });\n    if (siteIds.length === 0) {\n        return { included, data };\n    }\n    // search for site items and include those in the response\n    const searchRequestOptions = requestOptions;\n    searchRequestOptions.q = siteSearchQuery;\n    return searchItems(searchRequestOptions).then(function (siteInfo) {\n        siteInfo.results.forEach(siteItem => {\n            included.push({\n                id: siteItem.id,\n                type: `sites`,\n                // passing along all the site item information would be overkill\n                attributes: {\n                    id: siteItem.id,\n                    url: siteItem.url\n                }\n            });\n        });\n        return { included, data };\n    });\n}\n//# sourceMappingURL=search.js.map","import { searchGroups } from \"@esri/arcgis-rest-portal\";\nimport { getItem } from \"@esri/arcgis-rest-portal\";\nimport { IArcGISContext } from \"@esri/hub-common\";\n// import * as HubTypes from './hub-types'\nimport { getEventQueryFromType, searchEvents } from \"@esri/hub-events\";\nimport { IQueryFeaturesOptions } from \"@esri/arcgis-rest-feature-layer\";\n\nexport async function getMemberEvents(context: IArcGISContext): Promise<any> {\n    // Process:\n    // 1. Find Portal eventGroups=Portal.search where(type=event && members.include?(user))\n    // 2. Query Events Service where(groupId.include?(eventGroups)) && other filters (e.g. upcoming/nearby)\n    // 3. Convert Group+Features into IHubEvent\n    let events = [];\n    let groups = await searchGroups({ \n        q: \"tags:Hub Event Group\", \n        params: { searchUserAccess: \"groupMember\", num: 100 }, \n        ...context.requestOptions \n    });\n    \n    let eventGroups = groups.results.reduce((teamResults, group) => {\n        teamResults.push(`groupId = '${group.id}'`) // TODO: build this array elsewhere\n        return teamResults;\n    }, []); \n\n\n  \n    try {\n        \n      // @esri/hub-events directly calls Feature Service instead of using the Hub API proxy.\n      const item = await getItem(\n        context.eventsConfig.publicViewId,\n        {...context.requestOptions}\n      );\n      // TODO - get deterministic layer index\n      const eventServiceUrl = `${item.url}/0`;\n\n      // TODO: add support for all vs. upcoming events\n      const searchOptions: IQueryFeaturesOptions = getEventQueryFromType(\"upcoming\", {\n        url: eventServiceUrl,\n        authentication: context.session\n      });\n\n      if(!!eventGroups) {\n        searchOptions.where += ` AND (${eventGroups.join(' OR ')})`\n      }\n\n      console.debug(\"getMemberEvents: getEventQueryFromType\", {searchOptions});\n\n      let eventFeatures = await searchEvents( searchOptions );\n      console.debug(\"getMemberEvents: searchEvents\", [searchOptions, eventFeatures]);\n  \n      events = eventFeatures.data.reduce((eventResults, event) => {\n        // eventResults.push({\n        //   id: event.id,\n        //   name: event.attributes.title,\n        //   summary: event.attributes.venue,\n        //   description: event.attributes.description,\n        //   hubtype: HubTypes.HubType.event\n        // })\n        eventResults.push( event.attributes )\n        return eventResults;\n      }, [])\n    } catch(error) {\n        console.error(\"Error in getMemberEvents\", {\n            error,\n            context,\n            portalUrl: context.portalUrl\n        })\n    }\n\n    console.debug(\"getEvents 1\", {\n        events,\n        groups,\n        eventGroups\n    })    \n    // EventGroups are all events the user has registered, and events are matches for upcoming.\n    return { results: events, meta: {total: eventGroups.length, count: events.length, start: 1 } };\n  }",":host {\n  display: block;\n}\n","import { Component, Host, State, h } from '@stencil/core';\nimport state from '../../utils/state';\nimport { IHubEvent } from '@esri/hub-common';\nimport { getMemberEvents } from '../../utils/events';\n\n@Component({\n  tag: 'hub-events',\n  styleUrl: 'hub-events.css',\n  shadow: true,\n})\nexport class HubEvents {\n  @State() events: IHubEvent[] = [];\n\n  componentWillLoad() {\n    this.getEvents();\n  }\n\n  /**\n   * Full event\n    {\n      \"attributes\": {\n        \"OBJECTID\": 43854,\n        \"title\": \"Esri DevSummit 2023\",\n        \"location\": \"\",\n        \"description\": \"Meet us at DevSummit in Palm Springs!\",\n        \"startDate\": 1678086000000,\n        \"endDate\": 1678431600000,\n        \"organizerId\": null,\n        \"organizerName\": null,\n        \"organizerEmail\": null,\n        \"url\": \"esri-dev-summit-2023\",\n        \"pageId\": \"0\",\n        \"capacity\": null,\n        \"attendance\": 0,\n        \"status\": \"public\",\n        \"isCancelled\": null,\n        \"groupId\": \"166531dc429c462a89b81f5ffc5e26cc\",\n        \"siteId\": \"2b50a7e59f2045a097c58ab397ccf1d5\",\n        \"initiativeId\": \"bb0e6da747f8447aa616705a8313d8a4\",\n        \"surveyId\": null,\n        \"CreationDate\": 1677126846839,\n        \"Creator\": \"aturner_dcqa\",\n        \"EditDate\": 1677126863068,\n        \"Editor\": \"aturner_dcqa\",\n        \"schemaVersion\": 2,\n        \"organizers\": \"[{\\\"name\\\":\\\"Esri\\\",\\\"contact\\\":\\\"devsummit@esri.com\\\",\\\"username\\\":\\\"aturner_dcqa\\\"}]\",\n        \"sponsors\": \"[]\",\n        \"onlineLocation\": \"\",\n        \"venue\": \"Renaissance-Palm Springs\",\n        \"address1\": \"888 E Tahquitz Canyon Way, Palm Springs, California, 92262\",\n        \"address2\": \"\",\n        \"isAllDay\": 1,\n        \"timeZone\": null,\n        \"appIds\": null,\n        \"imageAttributes\": null,\n        \"videoUrl\": null\n      },\n      \"geometry\": { \"x\": -116.53831999999994, \"y\": 33.823210000000074 }\n    }\n   */\n  async getEvents() {\n    const results = await getMemberEvents(state.context);\n\n    console.debug('getEvents', {\n      results,\n    });\n    this.events = results.results;\n  }\n\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list id=\"posts\">\n          {this.events.map(event => {\n            return (\n              <calcite-list-item label={event['title']} description={event['description']}>\n                <calcite-icon scale=\"s\" icon=\"event\" slot=\"content-start\"></calcite-icon>\n                <div slot=\"content-end\">{/* {timeAgo(event.received)} */}</div>\n              </calcite-list-item>\n            );\n          })}\n        </calcite-list>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n\n.entry {\n  display: block;\n  border-bottom: 1px solid gray;\n  padding: 0.5rem 0.2rem;\n}\n.title {\n  font-weight: 500;\n}\n.timestamp {\n  font-size: 0.6rem;\n  font-weight: 300;\n  margin-left: 0.2rem;\n}","import { IHubCollection, IHubSearchOptions, IQuery, hubSearch } from '@esri/hub-common';\nimport { Component, Host, Prop, State, h } from '@stencil/core';\nimport { timeAgo } from '../../utils/time';\nimport state from '../../utils/state';\n// import { UserSession } from '@esri/arcgis-rest-auth';\n\n@Component({\n  tag: 'hub-feed',\n  styleUrl: 'hub-feed.css',\n  shadow: true,\n})\nexport class HubFeed {\n\n  /**\n   * Definition of feed parameters\n   */\n  @Prop() collection:IHubCollection = null;\n  \n  /**\n   * internal entries array\n   */\n  @State() entries:Array<any> = [];\n\n  async componentWillRender() {\n    await this.fetchResults();\n  }\n  async fetchResults() {\n    if(!!this.collection?.scope) {\n      const query:IQuery = this.collection?.scope;\n\n      // Feed defaults to reverse chronological\n      const options:IHubSearchOptions = {\n        sortOrder: 'desc',\n        sortField: 'modified',\n        requestOptions: state.context.hubRequestOptions\n      };\n\n      const results = await hubSearch(query, options)\n      this.entries = results.results;\n    }\n  }\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list>\n          {this.entries?.map((entry) => {\n            return (\n              <calcite-list-item label={entry.name} description={timeAgo(entry.updatedDate)}>\n                <calcite-icon scale=\"s\" icon=\"files\" slot=\"content-start\"></calcite-icon>\n                <calcite-dropdown scale=\"m\" slot=\"actions-end\">\n                  <calcite-action icon=\"ellipsis\" label=\"menu\"  slot=\"dropdown-trigger\"></calcite-action>\n                  <calcite-dropdown-group>\n                  <calcite-dropdown-item\n                    onclick={() => { window.open( `${state.context.hubUrl}/content/${entry.id}` , '_blank'); }}\n                  >\n                    View Item\n                  </calcite-dropdown-item>\n                </calcite-dropdown-group>\n              </calcite-dropdown>\n                {/* <calcite-action icon=\"x\" label=\"remove\" slot=\"actions-end\"></calcite-action> */}\n              </calcite-list-item>\n            )\n          })}\n        </calcite-list>\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, h, Prop, State } from '@stencil/core';\n\n@Component({\n  tag: 'hub-status',\n  styleUrl: 'hub-status.css',\n  shadow: true,\n})\nexport class HubStatus {\n\n  @Prop() statusUrl:string = 'https://arcgis.github.io/hub-status/status.json';\n\n  statusTypes = {\n    'normal': {icon: 'thumbs-up', color: 'green'},\n    'degraded': {icon: 'exclamation-mark-circle', color: 'yellow'},\n    'down': {icon: 'x-octagon-f', color: 'red'}\n  }\n\n  /**\n   * \n  \"overview\": {\n    \"status\": \"normal\",\n    \"message\": \"Hub sites operating normally.\"\n  },\n  \"services\": [\n    {\n      \"Service Name\": \"Hub Sites\",\n      \"Status\": \"normal\"\n    },\n    {\n      \"Service Name\": \"Search API\",\n      \"Status\": \"normal\"\n    },\n    {\n      \"Service Name\": \"Content Indexer\",\n      \"Status\": \"normal\"\n    },\n    {\n      \"Service Name\": \"Downloads\",\n      \"Status\": \"normal\"\n    },\n    {\n      \"Service Name\": \"Discussions\",\n      \"Status\": \"normal\"\n    }\n  ],\n   */\n  @State() status:any = {};\n\n  componentDidLoad() {\n    this.fetchStatus()\n  }\n\n  async fetchStatus() {\n    let data = await fetch(this.statusUrl);\n    let statusData = await data.json();\n    this.status = statusData;\n  }\n\n  render() {\n    return (\n      <Host>\n        <calcite-list id=\"status\">\n          <calcite-list-item \n            label=\"Overall\" \n            description={this.status?.overview?.status}\n          >\n          </calcite-list-item>\n          \n          {this.status?.services?.map((s) => {\n            return (\n              <calcite-list-item \n                label={s['Service Name']}\n                description={this.status?.overview?.status}\n              >\n                <calcite-chip\n                  icon={this.statusTypes[s['Status']].icon}\n                  slot=\"content-end\"\n                >\n                  {s['Status']}\n                </calcite-chip>\n              </calcite-list-item>\n            )\n          })}\n          \n        </calcite-list>\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n  padding: 0.5rem;\n}\n","import { Component, Host, h } from '@stencil/core';\n\n@Component({\n  tag: 'hub-text',\n  styleUrl: 'hub-text.css',\n  shadow: true,\n})\nexport class HubText {\n\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n      </Host>\n    );\n  }\n\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, State, h } from '@stencil/core';\nimport { getUserNotifications, INotification } from '@esri/arcgis-rest-portal';\nimport state from '../../utils/state';\nimport { timeAgo } from '../../utils/time';\n\n@Component({\n  tag: 'hub-user-notifications',\n  styleUrl: 'hub-user-notifications.css',\n  shadow: true,\n})\nexport class HubUserNotifications {\n\n  @State() notifications:INotification[] = [];\n\n  componentWillLoad() {\n    this.getNotifications();\n  }\n\n  async getNotifications() {\n    const results = await getUserNotifications({\n      ...state.context.requestOptions\n    })\n    this.notifications = results.notifications;\n  }\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <calcite-list id=\"posts\">\n        {this.notifications.map((notification) => {\n          return (\n            <calcite-list-item label={notification.type} description={notification.data.groupTitle}>\n              <calcite-icon scale=\"s\" icon=\"envelope\" slot=\"content-start\"></calcite-icon>\n              <div slot=\"content-end\">\n                {timeAgo(notification.received)}\n              </div>\n            </calcite-list-item>\n          )\n        })}\n        </calcite-list>\n      </Host>\n    );\n  }\n\n}\n","import { IHubCollection } from '@esri/hub-common';\n\nexport function buildCollection(options) {\n  const collection = {\n    key: 'collection',\n    label: 'collection',\n    targetEntity: options.type ?? 'item',\n    scope: {\n      targetEntity: options.type ?? 'item',\n      filters: [\n        {\n          predicates: [],\n        },\n      ],\n    },\n  };\n  if(!!options.query) {\n    collection.scope.filters[0].predicates.push({\n      term: options.query\n    })\n  }\n  if(!!options.groups) {\n    collection.scope.filters[0].predicates.push({\n      group: options.groups\n    })\n  }\n    // const collection = guideCollection;\n  return collection;\n}\n\nexport const guideCollection: IHubCollection = {\n  key: 'hubGuides',\n  label: 'Hub Guides',\n  targetEntity: 'item',\n  scope: {\n    targetEntity: 'item',\n    filters: [\n      {\n        predicates: [\n          {\n            tags: {\n              all: ['hubguide'],\n            },\n          },\n        ],\n      },\n    ],\n  },\n};\n",":host {\n  display: block;\n  overflow: scroll;\n  width: 100vw;\n  height: 100vh;\n}\n.workspace {\n  display: grid;\n  grid-template-columns: 10rem auto;\n  grid-template-rows: auto;\n  grid-template-areas: \n    \"global global\"\n    \"header header\"\n    \"navigation panel\"\n    \"footer footer\";  \n}\n#global {\n  grid-area: global;\n  background-color: #4e4e4e;\n}\n#header {\n  grid-area: header;\n  border-bottom: 1px solid gray;\n  display: none;\n}\n#navigation {\n  grid-area: navigation;\n  border-right: 1px solid gray;\n}\n#footer {\n  grid-area: footer;\n  border-top: 1px solid gray;\n  background-color: #fefefe;\n  padding: 2rem;\n  margin-top: 1rem;\n}\n#panel {\n  grid-area: panel;\n}\n.space {\n  /* background-color: blue; */\n  display: grid;\n  grid-template-columns: repeat( auto-fit, minmax(300px, 1fr) );\n  gap: 10px;\n  grid-auto-rows: minmax(100px, auto);  \n  padding: 1rem;\n}\n\n","import { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { buildCollection } from '../../utils/feeds';\nimport state from '../../utils/state';\nimport { adlib }  from 'adlib'\n\n@Component({\n  tag: 'hub-user-workspace',\n  styleUrl: 'hub-user-workspace.css',\n  shadow: true,\n})\nexport class HubUserWorkspace {\n\n  @Prop({ mutable: true }) client:string = null;\n  @Prop({ mutable: true }) redirect:string = null;\n  @Prop({ mutable: true }) portal:string = \"https://www.arcgis.com\";\n\n  /** \n   * Default workspace config if the user doesn't have a saved config\n   */\n  @Prop() defaultConfig:string = \"./data/default.json\"\n\n  // Loaded workspace configuration\n  @State() config: any = null;\n\n  componentWillLoad() {\n    // the redirect may be set after loading based on deploy host\n    state.app = {\n      client: this.client,\n      redirect: this.redirect,\n      portal: this.portal\n    }    \n  }\n  async loadConfiguration() {\n    // Fetch workspace configuration properties\n    let result = await fetch(`./data/${state.user.username}.json`);\n    console.debug(\"loadConfiguration: result\", {\n      result\n    });\n    if(result.status === 404) {\n\n      result = await fetch(`./${this.defaultConfig}`);\n    }\n    const data = await result.json();\n    this.config = data;\n  }\n\n  @Watch('redirect')\n  updateAppState(redirectUpdate:string) {\n    // the redirect may be set after loading based on deploy host\n    state.app.redirect = redirectUpdate;\n  }\n\n  componentDidLoad() {\n    if(!!state.user) {\n      this.loadConfiguration();\n    }\n  }\n  render() {\n    return (\n      <Host>\n        <div class=\"workspace\">\n          <div id=\"global\">\n            <workspace-navigation></workspace-navigation>\n          </div>\n          <div id=\"header\">\n            <slot name=\"header\"></slot>\n          </div>\n          <div id=\"navigation\">navigation</div>\n          <div id=\"panel\">\n          \n            {/* {this.renderWorkspace(this.config)} */}\n            {!!state.user ? this.renderWorkspace(this.config) : <span>Sign in with AGO QA account.</span>}\n          </div>\n          {/* <arcgis-hub-workspace\n            type=\"project\" \n          ></arcgis-hub-workspace> */}\n\n          <div id=\"footer\">\n            <em>footer...</em>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n\n  renderWorkspace(config:any) {\n    let spaceNav = [];\n    let spacePanels = [];\n\n    console.debug(\"Rendering workspaces\");\n    if(!!config) {\n      config.spaces.map((space, _spaceIndex) => {\n        // Build up panel nav sections\n        spaceNav.push(\n          <calcite-tab-title \n            // tab={`space${spaceIndex}`}\n            selected={space.title === config.default}\n          >{space.title}</calcite-tab-title>\n        )\n        let spacePanel = [];\n\n        // Fill out the space panel \n        space.layout.cards.map((card) => {\n          // TODO: wrap in function like https://medium.com/@Carmichaelize/dynamic-tag-names-in-react-and-jsx-17e366a684e9\n          const CardTag = `${card.type}`;\n          const settings = {\n            user: state.user\n          };\n          \n          const cardProps = adlib(card.values, settings);\n          const cardText = adlib(card.text, settings)\n          \n          Object.keys(cardProps).map((key) => {\n            // Collections need catalogs\n            if(key === 'collection') {\n              cardProps[key] = buildCollection( cardProps[key] );\n            }\n          })\n          \n          spacePanel.push(\n            <workspace-card>\n              <span slot=\"title\">{card.title}</span>\n              <CardTag {...cardProps}>\n                {cardText}\n              </CardTag>\n            </workspace-card>\n          )\n        }) // space[].layout.cards\n        spacePanels.push(\n          <calcite-tab \n            // tab={`space${spaceIndex}`}\n            selected={space.title === config.default}\n          >\n            <div class=\"space\">\n              {spacePanel}\n            </div>\n          </calcite-tab>\n        )\n      })\n    } else {\n      // return this.renderDefaultWorkspace();\n    }\n    // wrapped in div because default workspace?\n\n    const output = (\n      <calcite-tabs>\n        {/* TODO: tab-nav changes to title-nav in newer calcie */}\n        <calcite-tab-nav slot=\"tab-nav\">\n          {spaceNav}\n          <calcite-button\n            appearance=\"transparent\"\n            icon-start=\"plus\"\n            onclick={(_ev) => {alert(\"This will create a new space\")}}\n          >\n            Create Space\n          </calcite-button>\n        </calcite-tab-nav>\n        {spacePanels}\n      </calcite-tabs>\n    )\n    return output;\n  }\n  renderDefaultWorkspace() {\n    return (\n      <div>\n        <workspace-card>\n          <span slot=\"title\">About this Workspace</span>\n          <hub-text>\n            Personalized workspace for <a href={`${state.context.hubUrl}/people/${state.user.username}`}>{state.user.fullName}</a>. \n            <br /><br />\n            There is quick access to my favorites, specific project discussions, and recent content.\n          </hub-text>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Project Discussion</span>\n          <hub-discussions-moderation channel-id={'0311a680ff1b44389ad0392f94d5bbbb'}></hub-discussions-moderation>\n        </workspace-card>\n\n        {/*       // Demo using Gallery card - but needs a \"table\" layout\n            <workspace-card>\n              <span slot=\"title\">Recent Updates</span>\n              <arcgis-hub-gallery\n                  gallery-type=\"item\"\n                  query=\"Escondido\"\n                  layout=\"list\"\n              />\n            </workspace-card> */}\n\n        <workspace-card>\n          <span slot=\"title\">Recent Updates</span>\n          <hub-feed collection={buildCollection({ query: ['Initiative'], type: 'item' })} />\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Notifications</span>\n          <hub-user-notifications></hub-user-notifications>\n        </workspace-card>        \n\n        <workspace-card>\n          <span slot=\"title\">Favorites</span>\n          <hub-feed collection={buildCollection({ groups: [state.user.favGroupId], type: 'item' })} />\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Upcoming Events</span>\n          <hub-events></hub-events>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Collaborations</span>\n          <hub-collaborations></hub-collaborations>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Channels</span>\n          <hub-discussions-channels></hub-discussions-channels>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Hub Changelog</span>\n          <hub-changelog></hub-changelog>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Hub Status</span>\n          <hub-status></hub-status>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Work in Progress</span>\n          <hub-text>\n            Todo:\n            <ol>\n              <li>Make Engagement Stats dynamic</li>\n              <li>Add Nearby based on User places of interest</li>\n            </ol>\n          </hub-text>\n        </workspace-card>\n\n        <workspace-card>\n          <span slot=\"title\">Engagement Stats</span>\n          <hub-activity-stats></hub-activity-stats>\n        </workspace-card>\n\n        {/* <workspace-card>\n              <span slot=\"title\">Recent Activity</span>\n              {this.renderList()}\n            </workspace-card> */}\n\n        <workspace-card>\n          <span slot=\"title\">Nearby</span>\n          <em>map coming...</em>\n        </workspace-card>\n\n        {/* <workspace-card>\n              <span slot=\"title\">Hub Guides</span>\n              <hub-feed\n                collection={guideCollection}\n              ></hub-feed>\n            </workspace-card> */}\n      </div>\n    );\n  }\n}\n",":host {\n  display: block;\n  width: auto;\n  height: 300px;\n  border: 1px solid rgb(161, 161, 161);\n  position: relative;\n  overflow: auto;\n\n}\n.title {\n  font-weight: 600;\n  width: 100%;\n  display: block;\n  border-bottom: 1px solid #888;\n  background-color: #f0f0f0;\n  padding: 0.5rem;\n  height: 20px;\n  position: sticky;\n  top: 0px;\n  z-index: 100;\n}\n.tab {\n  line-height: 3em;\n  display: none;\n  cursor: pointer;\n\n}\n:host(:hover) .tab {\n  display: block;\n  position: absolute;\n  cursor: pointer;\n  top: -10px;\n  border: 1px solid #AAA;\n  background-color: #DDD;\n}","import { Component, Host, h } from '@stencil/core';\n\n@Component({\n  tag: 'workspace-card',\n  styleUrl: 'workspace-card.css',\n  shadow: true,\n})\nexport class WorkspaceCard {\n\n  render() {\n    return (\n      <Host>\n        <div class=\"tab\">\n          {this.renderTab()}\n        </div>\n        <div class=\"tab-content\">\n          <span class=\"title\">\n            <slot name=\"title\"></slot>\n          </span>\n          <span class=\"body\">\n            <slot></slot>\n          </span>\n        </div>\n      </Host>\n    );\n  }\n  \n  renderTab() {\n    return (\n      <calcite-list>\n        <calcite-list-item label=\"Card\" description=\"\">\n          <calcite-action icon=\"drag\" label=\"drag\" scale=\"s\" slot=\"actions-start\"></calcite-action>\n          <calcite-action icon=\"pencil\" label=\"edit\" slot=\"actions-end\"></calcite-action>\n          <calcite-action icon=\"x\" label=\"delete\" slot=\"actions-end\"></calcite-action>\n          <calcite-action icon=\"ellipsis\" label=\"menu\" slot=\"actions-end\"></calcite-action>\n        </calcite-list-item>\n      </calcite-list>      \n    )\n  }\n}\n",":host {\n  display: block;\n}\n#title {\n  color: white;\n  font-size: 500;\n  padding: auto 0;\n}\n#profile {\n  float: right;\n}\n","import { Component, Host, Listen, h } from '@stencil/core';\nimport state from \"../../utils/state\";\n\n@Component({\n  tag: 'workspace-navigation',\n  styleUrl: 'workspace-navigation.css',\n  shadow: true,\n})\nexport class WorkspaceNavigation {\n  \n  /**\n   * reference to sign-in button for onclick events\n   */\n  signinButton:HTMLButtonElement;\n\n  signinClick() {\n    const evt = new CustomEvent('arcgisAppIdentityStartSignIn');\n    document.dispatchEvent(evt);    \n  }\n  signoutClick() {\n    const evt = new CustomEvent('arcgisAppIdentityStartSignOut');\n    document.dispatchEvent(evt);    \n  }\n  @Listen('arcgisAppIdentitySignedIn')\n  signedinEvent(evt) {\n    state.context = evt.detail;\n  }\n  @Listen('arcgisAppIdentitySignedOut')\n  signedoutEvent(_evt) {\n    state.context = null;\n  }\n\n  render() {\n    return (\n      <Host>\n        <slot></slot>\n        <span id=\"title\">\n          ArcGIS Hub\n        </span>\n          <span id=\"profile\">\n          <arcgis-app-identity \n            client-id={state.app.client}\n            redirect-uri={state.app.redirect}\n            portal={state.app.portal}\n          >  \n          </arcgis-app-identity>\n\n          \n          {this.renderIdentity()}\n        </span>\n      </Host>\n    );\n  }\n\n  renderIdentity() {\n    if(!!state.user) {\n      return (\n        <calcite-dropdown>\n          <calcite-button slot=\"dropdown-trigger\">{state.user?.fullName}</calcite-button>\n          <calcite-dropdown-group>\n            <calcite-dropdown-item\n              onclick={this.signoutClick}\n            >Sign Out</calcite-dropdown-item>\n          </calcite-dropdown-group>\n        </calcite-dropdown>\n      )\n    } else {\n      return (\n        <calcite-button\n          ref={el => this.signinButton = el}\n          onclick={this.signinClick}\n        >\n          Sign In\n        </calcite-button>\n      )\n    }\n\n          \n  }\n\n}\n"],"mappings":"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"}